<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Reghype</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500&family=Roboto&display=swap" rel="stylesheet">
<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<style>
/* –û–°–ù–û–í–ù–´–ï –°–¢–ò–õ–ò */
body {
  margin:0;
  font-family:'Roboto',sans-serif;
  background: linear-gradient(135deg,#0d0d0d,#1a1a1a);
  color:#fff;
  text-align:center;
  overflow-x:hidden;
}
h1 {
  font-family:'Orbitron',sans-serif;
  color:#ffcc00;
  margin:20px 0;
  cursor:pointer;
  text-shadow:0 0 10px #ffcc00;
}
button {
  padding:12px 25px;
  margin:10px;
  border:none;
  border-radius:12px;
  background: linear-gradient(45deg,#ff6600,#ffcc00);
  font-weight:bold;
  color:#000;
  font-size:18px;
  cursor:pointer;
  transition:0.3s;
}
button:hover{
  transform:scale(1.05);
}
#currency{
  font-size:22px;
  margin:10px;
  color:#00ff99;
  font-weight:bold;
}
/* –ü–†–û–§–ò–õ–¨ –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø */
.profile-info {
  display: flex;
  align-items: center;
  justify-content: center;
  margin: 20px 0;
  gap: 15px;
}
.profile-avatar {
  width: 60px;
  height: 60px;
  border-radius: 50%;
  border: 3px solid #ffcc00;
  object-fit: cover;
  cursor: pointer;
  transition: 0.3s;
}
.profile-avatar:hover {
  transform: scale(1.1);
  box-shadow: 0 0 15px rgba(255, 204, 0, 0.7);
}
.profile-name {
  font-size: 20px;
  color: #00ff99;
  font-weight: bold;
  cursor: pointer;
  transition: 0.3s;
}
.profile-name:hover {
  color: #ffcc00;
  text-shadow: 0 0 10px #ffcc00;
}
/* –ö–ê–†–¢–û–ß–ö–ò */
#lastCard .card {
  max-width: 150px;
  font-size: 16px;
  margin: 12px auto;
}
#lastCard .card img {
  max-width: 100%;
  height: auto;
  border-radius: 14px;
}
.card{
  display:inline-block;
  margin:10px;
  text-align:center;
  transition:0.5s;
  border-radius:12px;
  padding:5px;
  position:relative;
}
.card img{
  max-width:150px;
  border-radius:12px;
  transition:0.5s;
}
/* –†–ï–î–ö–û–°–¢–ò –ö–ê–†–¢–û–ß–ï–ö */
.rarity-Common{
  border:3px solid gray;
  box-shadow:0 0 15px gray;
}
.rarity-Rare{
  border:3px solid #3399ff;
  box-shadow:0 0 15px #3399ff;
  animation:glowBlue 2s infinite alternate;
}
.rarity-Special{
  border:3px solid #cc33ff;
  box-shadow:0 0 20px #cc33ff;
  animation:glowPurple 2s infinite alternate;
}
.rarity-Legendary{
  border:3px solid gold;
  box-shadow:0 0 25px gold;
  animation:glowGold 2s infinite alternate;
}
@keyframes glowBlue{
  0%{box-shadow:0 0 15px #3399ff;}
  100%{box-shadow:0 0 30px #33f;}
}
@keyframes glowPurple{
  0%{box-shadow:0 0 15px #cc33ff;}
  100%{box-shadow:0 0 35px #f3f;}
}
@keyframes glowGold{
  0%{box-shadow:0 0 20px gold;}
  100%{box-shadow:0 0 40px #ff0;}
}
.animate-card{
  transform:scale(0) rotateY(0deg);
  animation:popCard 0.8s forwards;
}
@keyframes popCard{
  0%{transform:scale(0) rotateY(0deg);opacity:0;}
  50%{transform:scale(1.3) rotateY(180deg);opacity:1;}
  100%{transform:scale(1) rotateY(360deg);opacity:1;}
}
.timer{
  font-size:16px;
  color:#ff6666;
  margin:10px;
}
#collection {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  margin-bottom: 80px;
  margin-top: 20px;
}
h2 {
  margin-top: 40px;
  margin-bottom: 25px;
  font-size: 24px;
  text-align: center;
}
/* –ê–î–ú–ò–ù –ü–ê–ù–ï–õ–¨ */
#adminPanel{
  position: fixed;
  top: 0;
  right: -500px;
  width: 480px;
  height: 100vh;
  background: linear-gradient(135deg, rgba(10, 10, 10, 0.98), rgba(30, 30, 30, 0.98));
  border-left: 3px solid transparent;
  backdrop-filter: blur(15px);
  transition: all 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  z-index: 10000;
  overflow-y: auto;
  box-shadow: -10px 0 30px rgba(0, 0, 0, 0.5);
}
#adminPanel::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(45deg,
    rgba(255, 0, 0, 0.1),
    rgba(255, 102, 0, 0.05),
    rgba(255, 204, 0, 0.1),
    rgba(255, 0, 0, 0.1)
  );
  background-size: 400% 400%;
  animation: adminGlow 4s ease infinite;
  z-index: -1;
}
@keyframes adminGlow {
  0%, 100% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
}
#adminPanel.show{
  right: 0;
  border-left-color: #ff3333;
}
.admin-header {
  padding: 20px;
  border-bottom: 2px solid rgba(255, 51, 51, 0.3);
  background: linear-gradient(135deg, rgba(255, 0, 0, 0.1), rgba(255, 51, 51, 0.05));
}
.admin-header h2 {
  color: #ff3333;
  margin: 0;
  font-family: 'Orbitron', sans-serif;
  font-size: 24px;
  text-shadow: 0 0 10px rgba(255, 51, 51, 0.5);
  display: flex;
  align-items: center;
  gap: 10px;
}
.admin-close-btn {
  position: absolute;
  top: 15px;
  right: 15px;
  background: rgba(255, 51, 51, 0.2);
  border: 1px solid #ff3333;
  color: #ff3333;
  border-radius: 50%;
  width: 35px;
  height: 35px;
  cursor: pointer;
  transition: 0.3s;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 18px;
}
.admin-close-btn:hover {
  background: rgba(255, 51, 51, 0.4);
  transform: rotate(90deg);
}
.admin-section {
  padding: 20px;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}
.admin-section h3 {
  color: #ffcc00;
  font-family: 'Orbitron', sans-serif;
  font-size: 16px;
  margin: 0 0 15px 0;
  text-transform: uppercase;
  letter-spacing: 1px;
}
.admin-input-group {
  display: flex;
  gap: 10px;
  margin-bottom: 15px;
  align-items: center;
}
.admin-input {
  flex: 1;
  padding: 8px 12px;
  border: 1px solid rgba(255, 204, 0, 0.3);
  border-radius: 6px;
  background: rgba(0, 0, 0, 0.5);
  color: white;
  font-size: 14px;
  outline: none;
  transition: 0.3s;
}
.admin-input:focus {
  border-color: #ffcc00;
  box-shadow: 0 0 10px rgba(255, 204, 0, 0.3);
}
.admin-select {
  padding: 8px 12px;
  border: 1px solid rgba(255, 204, 0, 0.3);
  border-radius: 6px;
  background: rgba(0, 0, 0, 0.7);
  color: white;
  font-size: 14px;
  outline: none;
  cursor: pointer;
}
.admin-button {
  padding: 10px 15px;
  border: none;
  border-radius: 8px;
  background: linear-gradient(45deg, #ff3333, #ff6666);
  color: white;
  font-weight: bold;
  cursor: pointer;
  transition: 0.3s;
  font-size: 12px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin: 2px;
}
.admin-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 5px 15px rgba(255, 51, 51, 0.4);
}
.admin-button.danger {
  background: linear-gradient(45deg, #cc0000, #ff3333);
}
.admin-button.warning {
  background: linear-gradient(45deg, #ff6600, #ffaa00);
}
.admin-button.success {
  background: linear-gradient(45deg, #00cc66, #00ff99);
}
.admin-log {
  background: rgba(0, 0, 0, 0.7);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 8px;
  padding: 10px;
  height: 150px;
  overflow-y: auto;
  font-family: monospace;
  font-size: 12px;
  color: #ccc;
  margin-top: 10px;
}
.log-entry {
  margin-bottom: 5px;
  padding: 2px 5px;
  border-radius: 3px;
}
.log-entry.success {
  background: rgba(0, 255, 0, 0.1);
  color: #00ff00;
}
.log-entry.error {
  background: rgba(255, 0, 0, 0.1);
  color: #ff6666;
}
.log-entry.warning {
  background: rgba(255, 165, 0, 0.1);
  color: #ffaa00;
}
.player-search-list {
  max-height: 200px;
  overflow-y: auto;
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 6px;
  background: rgba(0, 0, 0, 0.7);
}
.player-search-item {
  padding: 8px 12px;
  cursor: pointer;
  transition: 0.3s;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}
.player-search-item:hover {
  background: rgba(255, 204, 0, 0.2);
}
.player-search-item:last-child {
  border-bottom: none;
}
.admin-warning {
  background: rgba(255, 165, 0, 0.2);
  border: 1px solid #ffaa00;
  border-radius: 8px;
  padding: 15px;
  margin: 15px 0;
  color: #ffaa00;
  font-size: 14px;
  text-align: center;
}
.admin-danger-zone {
  background: rgba(255, 0, 0, 0.1);
  border: 2px solid rgba(255, 51, 51, 0.5);
  border-radius: 10px;
  padding: 20px;
  margin: 20px 0;
}
.admin-danger-zone h3 {
  color: #ff3333;
  text-align: center;
  margin-bottom: 15px;
}
.card-preview {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 5px;
  background: rgba(255, 255, 255, 0.05);
  border-radius: 6px;
  margin: 5px 0;
}
.card-preview img {
  width: 30px;
  height: 40px;
  object-fit: cover;
  border-radius: 3px;
}
/* –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –ö–ê–†–¢–û–ß–ö–ò */
#cardModal{
  display:none;
  position:fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  background:rgba(0,0,0,0.85);
  justify-content:center;
  align-items:center;
  z-index:2000;
}
#cardContent {
  background: #111;
  padding: 15px;
  border: 2px solid #ffcc00;
  border-radius: 12px;
  text-align: center;
  position: relative;
  max-width: 240px;
  transform: scale(0.9);
  animation: modalPop 0.4s forwards;
}
#cardContent img{
  max-width:100%;
  border-radius:12px;
  box-shadow:0 0 20px gold;
  margin-bottom:10px;
}
@keyframes modalPop{
  0%{transform:scale(0);}
  60%{transform:scale(1.2);}
  100%{transform:scale(1);}
}
#cardContent button{
  padding:8px 15px;
  margin-top:10px;
  border:none;
  border-radius:8px;
  background:#ff3333;
  color:#fff;
  cursor:pointer;
  transition:0.3s;
}
#cardContent button:hover{
  transform:scale(1.05);
}
/* –ù–ê–í–ë–ê–† */
#navbar {
  display: flex;
  justify-content: space-around;
  background: #111;
  padding: 15px 10px;
  border-top: 2px solid #ffcc00;
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  z-index: 3000;
}
#navbar button {
  flex: 1;
  margin: 0 5px;
  padding: 12px 10px;
  background: linear-gradient(45deg,#ff6600,#ffcc00);
  border: none;
  border-radius: 8px;
  font-weight: bold;
  cursor: pointer;
  transition: 0.3s;
}
#navbar button:hover {
  transform: scale(1.05);
}
#navbar button.active {
  background: linear-gradient(45deg,#00ff99,#ffcc00);
  box-shadow: 0 0 15px rgba(0, 255, 153, 0.5);
}
/* –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê –ú–ï–ù–Æ */
.menu-modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.8);
  backdrop-filter: blur(5px);
  z-index: 4000;
  animation: fadeIn 0.3s ease-out;
}
.menu-content {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: linear-gradient(135deg, #1a1a1a, #2d2d2d);
  border: 3px solid #ffcc00;
  border-radius: 20px;
  padding: 30px;
  width: 90vw;
  max-width: 600px;
  max-height: 80vh;
  overflow-y: auto;
  box-shadow: 0 0 50px rgba(255, 204, 0, 0.3);
  animation: slideIn 0.4s ease-out;
}
.menu-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 25px;
  border-bottom: 2px solid #ffcc00;
  padding-bottom: 15px;
}
.menu-title {
  font-family: 'Orbitron', sans-serif;
  color: #ffcc00;
  font-size: 28px;
  text-shadow: 0 0 10px #ffcc00;
  margin: 0;
}
.close-btn {
  background: none;
  border: none;
  color: #ff3333;
  font-size: 32px;
  cursor: pointer;
  transition: 0.3s;
  padding: 5px 10px;
  border-radius: 50%;
}
.close-btn:hover {
  background: rgba(255, 51, 51, 0.2);
  transform: rotate(90deg);
}
@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}
@keyframes slideIn {
  from {
    opacity: 0;
    transform: translate(-50%, -60%);
  }
  to {
    opacity: 1;
    transform: translate(-50%, -50%);
  }
}
/* –°–¢–ò–õ–ò –î–õ–Ø –ö–û–¢–ò–ö–ê */
.cat-container {
  display: inline-block;
  margin: 20px;
  cursor: pointer;
  transition: transform 0.2s;
}
.cat-container:hover {
  transform: scale(1.05);
}
.cat-container:active {
  transform: scale(0.95);
}
#catVideo {
  width: 200px;
  height: 200px;
  border-radius: 15px;
  border: 3px solid #ffcc00;
  box-shadow: 0 0 20px rgba(255, 204, 0, 0.5);
  object-fit: cover;
}
.click-effect {
  animation: clickPulse 0.3s ease-out;
}
@keyframes clickPulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.1); }
  100% { transform: scale(1); }
}
/* –°–¢–ò–õ–ò –ü–†–û–§–ò–õ–Ø */
.profile-section {
  background: linear-gradient(135deg, #2a2a2a, #1a1a1a);
  border: 2px solid #ffcc00;
  border-radius: 15px;
  padding: 20px;
  margin: 20px;
  max-width: 500px;
  margin: 20px auto;
}
.profile-header {
  display: flex;
  align-items: center;
  gap: 20px;
  margin-bottom: 20px;
}
.profile-avatar-large {
  width: 100px;
  height: 100px;
  border-radius: 50%;
  border: 3px solid #ffcc00;
  object-fit: cover;
  cursor: pointer;
  transition: 0.3s;
}
.profile-avatar-large:hover {
  transform: scale(1.1);
  box-shadow: 0 0 20px rgba(255, 204, 0, 0.7);
}
.profile-details h3 {
  color: #ffcc00;
  margin: 0 0 10px 0;
  font-family: 'Orbitron', sans-serif;
}
.profile-stats {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 15px;
  text-align: center;
}
.stat-item {
  background: rgba(255, 204, 0, 0.1);
  padding: 15px;
  border-radius: 10px;
  border: 1px solid rgba(255, 204, 0, 0.3);
}
.stat-value {
  font-size: 24px;
  font-weight: bold;
  color: #00ff99;
  display: block;
}
.stat-label {
  color: #ccc;
  font-size: 14px;
}
.profile-actions {
  display: flex;
  gap: 10px;
  justify-content: center;
  margin-top: 20px;
}
.profile-actions button {
  padding: 10px 20px;
  font-size: 14px;
}
/* –°–∫—Ä—ã—Ç—ã–π input –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤ */
#avatarInput {
  display: none;
}
/* –ö–æ–ª–ª–µ–∫—Ü–∏—è –≤ –ø—Ä–æ—Ñ–∏–ª–µ */
.profile-collection {
  margin-top: 30px;
  border-top: 2px solid #ffcc00;
  padding-top: 20px;
}
.collection-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
  gap: 10px;
  max-height: 400px;
  overflow-y: auto;
}
.collection-card {
  aspect-ratio: 1;
  border: 2px solid #666;
  border-radius: 8px;
  overflow: hidden;
  transition: 0.3s;
  cursor: pointer;
}
.collection-card:hover {
  transform: scale(1.05);
}
.collection-card img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}
/* –ö–ê–°–¢–û–ú–ù–´–ô –ú–û–î–ê–õ–¨–ù–´–ô –î–ò–ê–õ–û–ì –î–õ–Ø –°–ú–ï–ù–´ –ò–ú–ï–ù–ò */
#nameModal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.8);
  justify-content: center;
  align-items: center;
  z-index: 5000;
}
.name-content {
  background: linear-gradient(135deg, #1a1a1a, #2d2d2d);
  border: 3px solid #ffcc00;
  border-radius: 15px;
  padding: 25px;
  text-align: center;
  max-width: 400px;
  animation: modalPop 0.4s forwards;
}
.name-content h3 {
  color: #ffcc00;
  margin-bottom: 20px;
  font-family: 'Orbitron', sans-serif;
}
.name-content input {
  width: 100%;
  padding: 12px;
  border: 2px solid #ffcc00;
  border-radius: 8px;
  background: #111;
  color: #fff;
  font-size: 16px;
  margin-bottom: 20px;
  box-sizing: border-box;
}
.name-content input:focus {
  outline: none;
  box-shadow: 0 0 10px rgba(255, 204, 0, 0.5);
}
.name-actions {
  display: flex;
  gap: 10px;
  justify-content: center;
}
.name-actions button {
  padding: 10px 20px;
  margin: 0;
}
/* –õ–ò–î–ï–†–ë–û–†–î –° –ü–†–û–ö–†–£–¢–ö–û–ô */
.leaderboard-container {
  max-height: 400px;
  overflow-y: auto;
  padding-right: 10px;
}
.leader-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 15px;
  margin: 10px 0;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 10px;
  border: 1px solid #333;
  cursor: pointer;
  transition: 0.3s;
}
.leader-item:hover {
  background: rgba(255, 204, 0, 0.1);
  border-color: #ffcc00;
  transform: translateX(5px);
}
.leader-item.current-player {
  background: rgba(255, 204, 0, 0.2);
  border-color: #ffcc00;
}
.leader-info {
  text-align: left;
  flex: 1;
}
.leader-name {
  font-weight: bold;
  color: #fff;
  margin-bottom: 5px;
  display: flex;
  align-items: center;
  gap: 10px;
}
.leader-stats {
  font-size: 14px;
  color: #ccc;
}
.leader-rank {
  font-size: 24px;
  margin-right: 10px;
}
.last-online {
  font-size: 12px;
  color: #888;
  margin-top: 3px;
}
.online-status {
  width: 12px;
  height: 12px;
  border-radius: 50%;
  display: inline-block;
  margin-left: 5px;
}
.online-status.online {
  background: #00ff99;
  box-shadow: 0 0 6px #00ff99;
}
.online-status.offline {
  background: #666;
}
/* –ü–†–û–§–ò–õ–¨ –î–†–£–ì–û–ì–û –ò–ì–†–û–ö–ê */
.other-profile-section {
  background: linear-gradient(135deg, #2a2a2a, #1a1a1a);
  border: 2px solid #00ff99;
  border-radius: 15px;
  padding: 20px;
  margin: 20px auto;
  max-width: 500px;
}
/* –ü–ï–†–í–û–ù–ê–ß–ê–õ–¨–ù–ê–Ø –ù–ê–°–¢–†–û–ô–ö–ê */
#initialSetup {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(135deg, #0a0a0a, #1a1a2e, #16213e);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 9999;
  backdrop-filter: blur(10px);
}
.setup-content {
  background: linear-gradient(135deg, rgba(26, 26, 26, 0.95), rgba(45, 45, 45, 0.95));
  border: 2px solid transparent;
  background-clip: padding-box;
  border-radius: 25px;
  padding: 50px;
  text-align: center;
  max-width: 600px;
  width: 90%;
  position: relative;
  overflow: hidden;
  box-shadow:
    0 25px 50px rgba(0, 0, 0, 0.5),
    0 0 0 1px rgba(255, 204, 0, 0.2),
    inset 0 1px 0 rgba(255, 255, 255, 0.1);
  animation: setupAppear 0.8s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
}
.setup-content::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(45deg,
    rgba(255, 204, 0, 0.1) 0%,
    rgba(255, 102, 0, 0.05) 25%,
    rgba(0, 255, 153, 0.05) 50%,
    rgba(255, 204, 0, 0.1) 75%,
    rgba(255, 204, 0, 0.1) 100%
  );
  background-size: 400% 400%;
  animation: gradientShift 6s ease infinite;
  border-radius: 25px;
  z-index: -1;
}
.setup-content::after {
  content: '';
  position: absolute;
  top: -2px;
  left: -2px;
  right: -2px;
  bottom: -2px;
  background: linear-gradient(45deg, #ffcc00, #ff6600, #00ff99, #ffcc00);
  background-size: 400% 400%;
  animation: borderGlow 3s ease infinite;
  border-radius: 25px;
  z-index: -2;
}
@keyframes setupAppear {
  0% {
    opacity: 0;
    transform: scale(0.8) rotateY(-15deg);
    filter: blur(10px);
  }
  100% {
    opacity: 1;
    transform: scale(1) rotateY(0deg);
    filter: blur(0px);
  }
}
@keyframes gradientShift {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}
@keyframes borderGlow {
  0%, 100% {
    background-position: 0% 50%;
    opacity: 0.8;
  }
  50% {
    background-position: 100% 50%;
    opacity: 1;
  }
}
.setup-content h2 {
  color: #ffcc00;
  font-family: 'Orbitron', sans-serif;
  font-size: 32px;
  margin-bottom: 20px;
  text-shadow:
    0 0 20px rgba(255, 204, 0, 0.8),
    0 0 40px rgba(255, 204, 0, 0.4);
  animation: titlePulse 2s ease-in-out infinite alternate;
  position: relative;
}
.setup-content h2::after {
  content: '‚ú®';
  position: absolute;
  right: -40px;
  top: 50%;
  transform: translateY(-50%);
  animation: sparkle 1.5s ease-in-out infinite;
}
@keyframes titlePulse {
  0% { text-shadow: 0 0 20px rgba(255, 204, 0, 0.8), 0 0 40px rgba(255, 204, 0, 0.4); }
  100% { text-shadow: 0 0 30px rgba(255, 204, 0, 1), 0 0 60px rgba(255, 204, 0, 0.6); }
}
@keyframes sparkle {
  0%, 100% {
    opacity: 0.5;
    transform: translateY(-50%) scale(1) rotate(0deg);
  }
  50% {
    opacity: 1;
    transform: translateY(-50%) scale(1.2) rotate(180deg);
  }
}
.setup-content p {
  color: rgba(255, 255, 255, 0.8);
  margin-bottom: 35px;
  line-height: 1.6;
  font-size: 16px;
  font-weight: 300;
  letter-spacing: 0.5px;
}
.nickname-input-container {
  position: relative;
  margin: 30px 0;
}
.nickname-input-container input {
  width: 100%;
  max-width: 350px;
  padding: 18px 25px;
  border: 2px solid rgba(255, 204, 0, 0.3);
  border-radius: 15px;
  background: linear-gradient(135deg, rgba(20, 20, 20, 0.95), rgba(40, 40, 40, 0.95));
  color: #ffffff;
  font-size: 18px;
  font-weight: 500;
  text-align: center;
  transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  box-shadow:
    inset 0 3px 8px rgba(0, 0, 0, 0.4),
    0 0 0 1px rgba(255, 204, 0, 0.2),
    0 4px 15px rgba(255, 204, 0, 0.1);
  outline: none;
  position: relative;
  z-index: 1;
  box-sizing: border-box;
  backdrop-filter: blur(10px);
}
.nickname-input-container input::placeholder {
  color: rgba(255, 204, 0, 0.4);
  font-weight: 300;
  letter-spacing: 1px;
}
.nickname-input-container input:focus {
  border-color: #ffcc00;
  background: linear-gradient(135deg, rgba(20, 20, 20, 1), rgba(40, 40, 40, 1));
  box-shadow:
    inset 0 3px 8px rgba(0, 0, 0, 0.4),
    0 0 0 3px rgba(255, 204, 0, 0.4),
    0 0 25px rgba(255, 204, 0, 0.3),
    0 4px 20px rgba(255, 204, 0, 0.2);
  transform: translateY(-3px) scale(1.02);
}
.nickname-input-container input:valid {
  border-color: #00ff99;
  box-shadow:
    inset 0 3px 8px rgba(0, 0, 0, 0.4),
    0 0 0 2px rgba(0, 255, 153, 0.4),
    0 0 20px rgba(0, 255, 153, 0.2),
    0 4px 15px rgba(0, 255, 153, 0.1);
}
.character-counter {
  position: absolute;
  bottom: -25px;
  right: 0;
  font-size: 12px;
  color: rgba(255, 255, 255, 0.5);
  transition: all 0.3s ease;
}
.character-counter.warning {
  color: #ff6666;
  font-weight: bold;
}
.start-button {
  background: linear-gradient(135deg, #ff6600, #ffcc00, #ff6600);
  background-size: 200% 200%;
  border: none;
  border-radius: 15px;
  padding: 18px 40px;
  font-size: 18px;
  font-weight: bold;
  color: #000;
  cursor: pointer;
  transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  margin-top: 25px;
  position: relative;
  overflow: hidden;
  box-shadow:
    0 8px 25px rgba(255, 102, 0, 0.3),
    inset 0 1px 0 rgba(255, 255, 255, 0.2);
  animation: buttonGlow 2s ease-in-out infinite alternate;
}
.start-button::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
  transition: all 0.6s;
}
.start-button:hover::before {
  left: 100%;
}
.start-button:hover {
  background-position: 100% 100%;
  transform: translateY(-3px);
  box-shadow:
    0 12px 35px rgba(255, 102, 0, 0.4),
    inset 0 1px 0 rgba(255, 255, 255, 0.3);
}
.start-button:active {
  transform: translateY(-1px);
  box-shadow:
    0 6px 20px rgba(255, 102, 0, 0.3),
    inset 0 1px 0 rgba(255, 255, 255, 0.2);
}
.start-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
  animation: none;
}
@keyframes buttonGlow {
  0% { box-shadow: 0 8px 25px rgba(255, 102, 0, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.2); }
  100% { box-shadow: 0 8px 35px rgba(255, 102, 0, 0.5), inset 0 1px 0 rgba(255, 255, 255, 0.3); }
}
#gameContainer {
  display: none;
}
.loading-screen {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(135deg, #0d0d0d, #1a1a1a);
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  z-index: 10000;
}
.loading-spinner {
  width: 60px;
  height: 60px;
  border: 4px solid #333;
  border-top: 4px solid #ffcc00;
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin-bottom: 20px;
}
@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
.loading-text {
  color: #ffcc00;
  font-family: 'Orbitron', sans-serif;
  font-size: 18px;
  text-shadow: 0 0 10px #ffcc00;
}
@keyframes slideDown {
  from { transform: translateX(-50%) translateY(-100px); opacity: 0; }
  to { transform: translateX(-50%) translateY(0); opacity: 1; }
}
#adminAuthModal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.8);
  justify-content: center;
  align-items: center;
  z-index: 9998;
}
.admin-auth-content {
  background: linear-gradient(135deg, #1a1a1a, #2d2d2d);
  border: 3px solid #ff3333;
  border-radius: 15px;
  padding: 25px;
  text-align: center;
  max-width: 400px;
  animation: modalPop 0.4s forwards;
}
.admin-auth-content h3 {
  color: #ff3333;
  margin-bottom: 20px;
  font-family: 'Orbitron', sans-serif;
}
.admin-auth-content input {
  width: 100%;
  padding: 12px;
  border: 2px solid #ff3333;
  border-radius: 8px;
  background: #111;
  color: #fff;
  font-size: 16px;
  margin-bottom: 20px;
  box-sizing: border-box;
  type: password;
}
.admin-auth-content input:focus {
  outline: none;
  box-shadow: 0 0 10px rgba(255, 51, 51, 0.5);
}
.admin-auth-actions {
  display: flex;
  gap: 10px;
  justify-content: center;
}
.admin-auth-actions button {
  padding: 10px 20px;
  margin: 0;
}
.admin-section select {
  flex: 1;
}
</style>
</head>
<body>
<!-- –≠–ö–†–ê–ù –ó–ê–ì–†–£–ó–ö–ò -->
<div id="loadingScreen" class="loading-screen">
  <div class="loading-spinner"></div>
  <div class="loading-text">–ó–∞–≥—Ä—É–∑–∫–∞ Reghype...</div>
</div>
<!-- –ü–ï–†–í–û–ù–ê–ß–ê–õ–¨–ù–ê–Ø –ù–ê–°–¢–†–û–ô–ö–ê -->
<div id="initialSetup" style="display: none;">
  <div class="setup-content">
    <h2>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Reghype!</h2>
    <p>–ü—Ä–∏–¥—É–º–∞–π—Ç–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –Ω–∏–∫–Ω–µ–π–º –¥–ª—è –Ω–∞—á–∞–ª–∞ –∏–≥—Ä—ã:</p>
    <div class="nickname-input-container">
      <input type="text" id="initialNameInput" placeholder="–í–∞—à –Ω–∏–∫–Ω–µ–π–º" maxlength="12" autocomplete="off" spellcheck="false">
      <div class="character-counter" id="characterCounter">0/12</div>
    </div>
    <p>–í—ã–±–µ—Ä–∏—Ç–µ –∞–≤–∞—Ç–∞—Ä–∫—É (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):</p>
    <input type="file" id="initialAvatarInput" accept="image/*" onchange="handleInitialAvatarUpload(event)">
    <img id="initialAvatarPreview" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMzAiIGN5PSIzMCIgcj0iMzAiIGZpbGw9IiNmZmNjMDAiLz4KPGZ0ZXh0IHg9IjMwIiB5PSI0MCIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjI0IiBmaWxsPSIjMDAwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj7wn5CCPC90ZXh0Pgo8L3N2Zz4K" alt="–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∞–≤–∞—Ç–∞—Ä–∫–∏" style="width: 100px; height: 100px; border-radius: 50%; border: 3px solid #ffcc00; margin: 10px 0;">
    <button class="start-button" id="startGameButton" disabled>üöÄ –ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
  </div>
</div>
<!-- –û–°–ù–û–í–ù–ê–Ø –ò–ì–†–ê -->
<div id="gameContainer">
<h1 id="logo">Reghype</h1>
<!-- –ü–†–û–§–ò–õ–¨ –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø -->
<div class="profile-info">
  <img id="profileAvatar" class="profile-avatar" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMzAiIGN5PSIzMCIgcj0iMzAiIGZpbGw9IiNmZmNjMDAiLz4KPGZ0ZXh0IHg9IjMwIiB5PSI0MCIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjI0IiBmaWxsPSIjMDAwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj7wn5CCPC90ZXh0Pgo8L3N2Zz4K" alt="–ê–≤–∞—Ç–∞—Ä" onclick="openProfile()">
  <div class="profile-name" id="profileName" onclick="openProfile()">–ò–≥—Ä–æ–∫</div>
</div>
<div id="currency">üí∞ –í–∞–ª—é—Ç–∞: 100 –º–æ–Ω–µ—Ç</div>
<button onclick="openPack()">üéÅ –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –ø–∞–∫</button>
<button onclick="buyPack()">üíé –ö—É–ø–∏—Ç—å –ø–∞–∫ (50 –º–æ–Ω–µ—Ç)</button>
<p class="timer" id="timer"></p>
<div id="lastCard"></div>
<h2>–ú–æ—è –∫–æ–ª–ª–µ–∫—Ü–∏—è</h2>
<div id="collection"></div>
<!-- –°–ö–†–´–¢–´–ï –≠–õ–ï–ú–ï–ù–¢–´ -->
<input type="file" id="avatarInput" accept="image/*" onchange="handleAvatarUpload(event)">
<!-- –°–ß–ï–¢–ß–ò–ö –ö–õ–ò–ö–û–í –î–õ–Ø –ê–î–ú–ò–ù –ü–ê–ù–ï–õ–ò (—Å–∫—Ä—ã—Ç—ã–π) -->
<div id="adminClickCounter" style="display: none;"></div>
<!-- –ê–î–ú–ò–ù –ü–ê–ù–ï–õ–¨ -->
<div id="adminPanel">
  <div class="admin-header">
    <h2>üõ°Ô∏è –ê–î–ú–ò–ù-–ü–ê–ù–ï–õ–¨</h2>
    <button class="admin-close-btn" onclick="AdminManager.close()">&times;</button>
  </div>
 
  <div class="admin-section">
    <h3>üí∞ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∞–ª—é—Ç–æ–π</h3>
    <div class="admin-input-group">
      <input type="number" class="admin-input" id="adminCurrency" placeholder="–°—É–º–º–∞" min="0" max="999999">
      <button class="admin-button success" onclick="AdminManager.setCurrency()">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
      <button class="admin-button" onclick="AdminManager.addCurrency()">–î–æ–±–∞–≤–∏—Ç—å</button>
    </div>
  </div>
 
  <div class="admin-section">
    <h3>üÉè –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏</h3>
    <div class="admin-input-group">
      <select class="admin-select" id="adminCardSelect">
        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ä—Ç–æ—á–∫—É...</option>
      </select>
      <button class="admin-button success" onclick="AdminManager.giveCard()">–í—ã–¥–∞—Ç—å</button>
    </div>
    <div class="admin-input-group">
      <input type="number" class="admin-input" id="adminCardAmount" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ" min="1" max="50" value="1">
      <button class="admin-button" onclick="AdminManager.giveMultipleCards()">–í—ã–¥–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ</button>
    </div>
  </div>
 
  <div class="admin-section">
    <h3>üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞–º–∏</h3>
    <div class="admin-input-group">
      <input type="text" class="admin-input" id="playerSearch" placeholder="–ü–æ–∏—Å–∫ –∏–≥—Ä–æ–∫–∞..." onkeyup="AdminManager.searchPlayers(this.value)">
    </div>
    <div id="playerSearchResults" class="player-search-list" style="display: none;"></div>
    <div id="selectedPlayer" style="display: none;">
      <p>–í—ã–±—Ä–∞–Ω: <span id="selectedPlayerName"></span></p>
      <div class="admin-input-group">
        <input type="number" class="admin-input" id="playerCurrency" placeholder="–í–∞–ª—é—Ç–∞">
        <button class="admin-button" onclick="AdminManager.setPlayerCurrency()">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–µ–Ω—å–≥–∏</button>
      </div>
      <div class="admin-input-group">
        <select class="admin-select" id="playerCardSelect">
          <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ä—Ç–æ—á–∫—É...</option>
        </select>
        <button class="admin-button" onclick="AdminManager.givePlayerCard()">–í—ã–¥–∞—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É</button>
      </div>
      <div class="admin-input-group">
        <select class="admin-select" id="playerRoleSelect">
          <option value="user">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</option>
          <option value="moder">–ú–æ–¥–µ—Ä–∞—Ç–æ—Ä</option>
          <option value="admin">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</option>
          <option value="banned">–ó–∞–±–∞–Ω–µ–Ω</option>
        </select>
        <button class="admin-button warning" onclick="AdminManager.setPlayerRole()">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ä–æ–ª—å</button>
      </div>
      <button class="admin-button danger" onclick="AdminManager.banPlayer()">–ó–∞–±–∞–Ω–∏—Ç—å –∏–≥—Ä–æ–∫–∞</button>
    </div>
  </div>
 
  <div class="admin-section">
    <h3>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞</h3>
    <div id="serverStats">
      <p>–í—Å–µ–≥–æ –∏–≥—Ä–æ–∫–æ–≤: <span id="totalPlayers">–ó–∞–≥—Ä—É–∑–∫–∞...</span></p>
      <p>–û–Ω–ª–∞–π–Ω –∏–≥—Ä–æ–∫–æ–≤: <span id="onlinePlayers">–ó–∞–≥—Ä—É–∑–∫–∞...</span></p>
      <p>–í—Å–µ–≥–æ –∫–∞—Ä—Ç–æ—á–µ–∫: <span id="totalCards">–ó–∞–≥—Ä—É–∑–∫–∞...</span></p>
    </div>
    <button class="admin-button" onclick="AdminManager.refreshStats()">–û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É</button>
  </div>
 
  <div class="admin-section">
    <h3>üîß –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h3>
    <button class="admin-button" onclick="AdminManager.resetTimer()">–°–±—Ä–æ—Å–∏—Ç—å —Ç–∞–π–º–µ—Ä</button>
    <button class="admin-button warning" onclick="AdminManager.clearCollection()">–û—á–∏—Å—Ç–∏—Ç—å –º–æ–∏ –∫–∞—Ä—Ç–æ—á–∫–∏</button>
    <button class="admin-button" onclick="AdminManager.maxEnergy()">–ú–∞–∫—Å —ç–Ω–µ—Ä–≥–∏—è</button>
    <button class="admin-button success" onclick="AdminManager.giveRandomLegendary()">–í—ã–¥–∞—Ç—å –ª–µ–≥–µ–Ω–¥–∞—Ä–∫—É</button>
  </div>
 
  <div class="admin-danger-zone">
    <h3>‚ö†Ô∏è –û–ü–ê–°–ù–ê–Ø –ó–û–ù–ê</h3>
    <div class="admin-warning">
      –≠—Ç–∏ –¥–µ–π—Å—Ç–≤–∏—è –Ω–µ–æ–±—Ä–∞—Ç–∏–º—ã –∏ –∑–∞—Ç—Ä–∞–≥–∏–≤–∞—é—Ç –í–°–ï–• –∏–≥—Ä–æ–∫–æ–≤!
    </div>
    <button class="admin-button danger" onclick="AdminManager.resetAllPlayers()">üîÑ –°–ë–†–û–°–ò–¢–¨ –í–°–ï –ê–ö–ö–ê–£–ù–¢–´</button>
    <button class="admin-button danger" onclick="AdminManager.clearAllData()">üí• –°–¢–ï–†–ï–¢–¨ –ë–ê–ó–£ –î–ê–ù–ù–´–•</button>
    <button class="admin-button danger" onclick="AdminManager.shutdownServer()">üõë –†–ï–ñ–ò–ú –û–ë–°–õ–£–ñ–ò–í–ê–ù–ò–Ø</button>
  </div>
 
  <div class="admin-section">
    <h3>üìù –õ–æ–≥ –∞–¥–º–∏–Ω–∞</h3>
    <div id="adminLog" class="admin-log">
      <div class="log-entry">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞...</div>
    </div>
    <button class="admin-button" onclick="AdminManager.clearLog()">–û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥</button>
  </div>
</div>
<!-- –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –ê–£–¢–ï–ù–¢–ò–§–ò–ö–ê–¶–ò–ò –ê–î–ú–ò–ù–ê -->
<div id="adminAuthModal">
  <div class="admin-auth-content">
    <h3>–ê–¥–º–∏–Ω –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è</h3>
    <input type="password" id="adminPasswordInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å">
    <div class="admin-auth-actions">
      <button onclick="AdminManager.verifyPassword()">‚úÖ –í–æ–π—Ç–∏</button>
      <button onclick="AdminManager.cancelAuth()" style="background: linear-gradient(45deg,#ff3333,#ff6666);">‚ùå –û—Ç–º–µ–Ω–∞</button>
    </div>
  </div>
</div>
<!-- –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –ö–ê–†–¢–û–ß–ö–ò -->
<div id="cardModal">
  <div id="cardContent">
    <img id="modalImage" src="">
    <h2 id="modalName"></h2>
    <p id="modalRarity"></p>
    <p id="modalType"></p>
    <button id="sellCardBtn">üí∞ –ü—Ä–æ–¥–∞—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É</button>
  </div>
</div>
<!-- –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –°–ú–ï–ù–´ –ò–ú–ï–ù–ò -->
<div id="nameModal">
  <div class="name-content">
    <h3>–°–º–µ–Ω–∞ –∏–º–µ–Ω–∏</h3>
    <input type="text" id="nameInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤–æ–µ –∏–º—è" maxlength="20">
    <div class="name-actions">
      <button onclick="confirmNameChange()">‚úÖ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      <button onclick="closeNameModal()" style="background: linear-gradient(45deg,#ff3333,#ff6666);">‚ùå –û—Ç–º–µ–Ω–∞</button>
    </div>
  </div>
</div>
<!-- –ù–ê–í–ë–ê–† -->
<div id="navbar">
  <button onclick="MenuManager.toggle('profile')">üë§ –ü—Ä–æ—Ñ–∏–ª—å</button>
  <button onclick="MenuManager.toggle('clicker')">üñ± –ö–ª–∏–∫–∞–ª–∫–∞</button>
  <button onclick="MenuManager.toggle('packs')">üéÅ –ü–∞–∫–∏</button>
  <button onclick="MenuManager.toggle('leaderboard')">üèÜ –¢–æ–ø</button>
</div>
<!-- –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê –ú–ï–ù–Æ -->
<div id="profileModal" class="menu-modal">
  <div class="menu-content">
    <div class="menu-header">
      <h2 class="menu-title">üë§ –ü—Ä–æ—Ñ–∏–ª—å</h2>
      <button class="close-btn" onclick="MenuManager.close('profile')">&times;</button>
    </div>
    <div class="profile-section" id="currentPlayerProfile">
      <div class="profile-header">
        <img id="profileAvatarLarge" class="profile-avatar-large" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMzAiIGN5PSIzMCIgcj0iMzAiIGZpbGw9IiNmZmNjMDAiLz4KPGZ0ZXh0IHg9IjMwIiB5PSI0MCIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjI0IiBmaWxsPSIjMDAwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj7wn5CCPC90ZXh0Pgo8L3N2Zz4K" alt="–ê–≤–∞—Ç–∞—Ä" onclick="changeAvatar()">
        <div class="profile-details">
          <h3 id="profileNameLarge">–ò–≥—Ä–æ–∫</h3>
          <div class="profile-stats">
            <div class="stat-item">
              <span class="stat-value" id="profileCurrency">100</span>
              <span class="stat-label">–ú–æ–Ω–µ—Ç</span>
            </div>
            <div class="stat-item">
              <span class="stat-value" id="profileCards">0</span>
              <span class="stat-label">–ö–∞—Ä—Ç–æ—á–µ–∫</span>
            </div>
          </div>
        </div>
      </div>
     
      <div class="profile-actions">
        <button onclick="showNameModal()">‚úèÔ∏è –°–º–µ–Ω–∏—Ç—å –∏–º—è</button>
        <button onclick="changeAvatar()">üñºÔ∏è –°–º–µ–Ω–∏—Ç—å –∞–≤–∞—Ç–∞—Ä</button>
      </div>
     
      <div class="profile-collection">
        <h3>–ö–æ–ª–ª–µ–∫—Ü–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫</h3>
        <div id="profileCollectionGrid" class="collection-grid"></div>
      </div>
    </div>
   
    <!-- –ü—Ä–æ—Ñ–∏–ª—å –¥—Ä—É–≥–æ–≥–æ –∏–≥—Ä–æ–∫–∞ -->
    <div class="other-profile-section" id="otherPlayerProfile" style="display: none;">
      <button onclick="showCurrentProfile()" style="margin-bottom: 15px;">üîô –ù–∞–∑–∞–¥ –∫ –º–æ–µ–º—É –ø—Ä–æ—Ñ–∏–ª—é</button>
      <div class="profile-header">
        <img id="otherProfileAvatar" class="profile-avatar-large" src="" alt="–ê–≤–∞—Ç–∞—Ä">
        <div class="profile-details">
          <h3 id="otherProfileName">–ò–≥—Ä–æ–∫</h3>
          <div class="last-online" id="otherProfileLastOnline">–ë—ã–ª –≤ —Å–µ—Ç–∏ –Ω–µ–¥–∞–≤–Ω–æ</div>
          <div class="profile-stats">
            <div class="stat-item">
              <span class="stat-value" id="otherProfileCurrency">0</span>
              <span class="stat-label">–ú–æ–Ω–µ—Ç</span>
            </div>
            <div class="stat-item">
              <span class="stat-value" id="otherProfileCards">0</span>
              <span class="stat-label">–ö–∞—Ä—Ç–æ—á–µ–∫</span>
            </div>
          </div>
        </div>
      </div>
     
      <div class="profile-collection">
        <h3>–ö–æ–ª–ª–µ–∫—Ü–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫</h3>
        <div id="otherProfileCollectionGrid" class="collection-grid"></div>
      </div>
    </div>
  </div>
</div>
<div id="clickerModal" class="menu-modal">
  <div class="menu-content">
    <div class="menu-header">
      <h2 class="menu-title">üñ± –ö–ª–∏–∫–∞–ª–∫–∞</h2>
      <button class="close-btn" onclick="MenuManager.close('clicker')">&times;</button>
    </div>
    <p>–ù–∞–∂–∏–º–∞–π –Ω–∞ –∫–æ—Ç–∏–∫–∞ –∏ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π –º–æ–Ω–µ—Ç—ã!</p>
    <div class="cat-container" onclick="ClickerManager.earnClick()">
      <video id="catVideo" muted preload="auto">
        <source src="cat_petting.mp4" type="video/mp4">
        –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–∏–¥–µ–æ.
      </video>
    </div>
    <p id="energyDisplay">‚ö° –≠–Ω–µ—Ä–≥–∏—è: 50/50</p>
  </div>
</div>
<div id="packsModal" class="menu-modal">
  <div class="menu-content">
    <div class="menu-header">
      <h2 class="menu-title">üéÅ –ú–∞–≥–∞–∑–∏–Ω –ø–∞–∫–æ–≤</h2>
      <button class="close-btn" onclick="MenuManager.close('packs')">&times;</button>
    </div>
    <button onclick="PackManager.buyCommonPack()" style="width: 100%; margin: 10px 0; padding: 15px;">üü¶ –û–±—ã—á–Ω—ã–π –ø–∞–∫ (30 –º–æ–Ω–µ—Ç)</button>
    <button onclick="PackManager.buyRarePack()" style="width: 100%; margin: 10px 0; padding: 15px;">üü© –†–µ–¥–∫–∏–π –ø–∞–∫ (100 –º–æ–Ω–µ—Ç)</button>
    <button onclick="PackManager.buyLegendaryPack()" style="width: 100%; margin: 10px 0; padding: 15px;">üü® –õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π –ø–∞–∫ (300 –º–æ–Ω–µ—Ç)</button>
  </div>
</div>
<div id="leaderboardModal" class="menu-modal">
  <div class="menu-content">
    <div class="menu-header">
      <h2 class="menu-title">üèÜ –¢–æ–ø –∏–≥—Ä–æ–∫–æ–≤</h2>
      <button class="close-btn" onclick="MenuManager.close('leaderboard')">&times;</button>
    </div>
    <div id="leaderboardContent" class="leaderboard-container"></div>
  </div>
</div>
</div>
<script>
// FIREBASE –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø
const firebaseConfig = {
  apiKey: "AIzaSyBIPugjKSmRvbDNFS_7ClFkbjlb8zfugXM",
  authDomain: "regcandy-74da6.firebaseapp.com",
  databaseURL: "https://regcandy-74da6-default-rtdb.firebaseio.com",
  projectId: "regcandy-74da6",
  storageBucket: "regcandy-74da6.appspot.com",
  messagingSenderId: "486732872284",
  appId: "1:486732872284:web:9621ddfb253c03ccd98499"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
// –ö–ê–†–¢–û–ß–ö–ò
const cards=[
  {name:"Reghype",rarity:"Special",type:"Twitch",image:"cards/Regcandy.png", tgLink:"https://t.me/reghypearchive/2"},
  {name:"DistrsAI",rarity:"Special",type:"Twitch",image:"cards/DistrsAI.png", tgLink:"https://t.me/reghypearchive/3"},
  {name:"Demogorgon",rarity:"Legendary",type:"Moder",image:"cards/Demogorgon.png", tgLink:"https://t.me/reghypearchive/4"},
  {name:"Apelsinka",rarity:"Legendary",type:"Moder",image:"cards/Apelsinka.png", tgLink:"https://t.me/reghypearchive/5"},
  {name:"Freddy Fuzbear",rarity:"Rare",type:"Chaters",image:"cards/Freddy.png", tgLink:"https://t.me/reghypearchive/6"},
  {name:"Bonnie",rarity:"Rare",type:"Chaters",image:"cards/Bonnie.png", tgLink:"https://t.me/reghypearchive/7"},
  {name:"Mark",rarity:"Rare",type:"Chaters",image:"cards/Mark.png", tgLink:"https://t.me/reghypearchive/8"},
  {name:"Anton Fazbear",rarity:"Common",type:"Chaters",image:"cards/Anton.png", tgLink:"https://t.me/reghypearchive/9"},
  {name:"–†–æ–Ω–∏",rarity:"Common",type:"Chaters",image:"cards/Roni.png", tgLink:"https://t.me/reghypearchive/10"},
  {name:"Neatexq",rarity:"Rare",type:"Chaters",image:"cards/Neatexq.png", tgLink:"https://t.me/reghypearchive/11"},
  {name:"Foxy",rarity:"Rare",type:"Chaters",image:"cards/Foxy.png", tgLink:"https://t.me/reghypearchive/12"},
  {name:"Andrew",rarity:"Common",type:"Chaters",image:"cards/Andrew.png", tgLink:"https://t.me/reghypearchive/13"},
  {name:"Che–±—Én–µ–ª—è",rarity:"Common",type:"Chaters",image:"cards/Chebunela.png", tgLink:"https://t.me/reghypearchive/14"},
  {name:"–ê–ª—ç—Ö",rarity:"Rare",type:"Chaters",image:"cards/Alex.png", tgLink:"https://t.me/reghypearchive/15"},
  {name:"Foxy Skin",rarity:"Special",type:"Skin",image:"cards/Foxy-Skin.png", tgLink:"https://t.me/reghypearchive/16"},
  {name:"Demogorgon Skin",rarity:"Special",type:"Skin",image:"cards/Demogorgon-Skin.png", tgLink:"https://t.me/reghypearchive/17"},
  {name:"Freddy Skin",rarity:"Special",type:"Skin",image:"cards/Freddy-Skin.png", tgLink:"https://t.me/reghypearchive/18"},
  {name:"X06R",rarity:"Common",type:"Chaters",image:"cards/X06R.png", tgLink:"https://t.me/reghypearchive/19"}
];
// –°–õ–£–ß–ê–ô–ù–´–ï –ò–ú–ï–ù–ê –î–õ–Ø –ù–ü–°
const randomNames = [
  "–ö—Ä—É—Ç–æ–π–ò–≥—Ä–æ–∫", "–ú–µ–≥–∞–ì–µ–π–º–µ—Ä", "–õ–µ–≥–µ–Ω–¥–∞–ü–∞–∫–æ–≤", "–ö–∞—Ä—Ç–æ–†—ã—Ü–∞—Ä—å", "–°—É–ø–µ—Ä–ö–æ–ª–ª–µ–∫—Ç–æ—Ä",
  "–ü–∞–∫–æ–ú–∞–Ω", "–ö–∞—Ä—Ç–æ—á–Ω—ã–π–ö–æ—Ä–æ–ª—å", "–ì—Ä–æ–∑–∞–ü–∞–∫–æ–≤", "–ú–∞—Å—Ç–µ—Ä–ö–∞—Ä—Ç", "–õ—É—á—à–∏–π–ò–≥—Ä–æ–∫",
  "–§–∞–Ω—Ç–∞—Å—Ç–∏–∫–ì–µ–π–º–µ—Ä", "–ö—Ä—É—Ç–æ–π–î–∂–æ–∫–µ—Ä", "–ü—Ä–æ—Ñ–∏–ü–∞–∫–µ—Ä", "–ö–æ—Ä–æ–ª–µ–≤—Å–∫–∏–π–ò–≥—Ä–æ–∫", "–£–ª—å—Ç—Ä–∞–ö–æ–ª–ª–µ–∫—Ç–æ—Ä"
];
// –û–°–ù–û–í–ù–û–ô –ú–ï–ù–ï–î–ñ–ï–† –ò–ì–†–´
class GameManager {
  constructor() {
    this.playerId = null;
    this.data = {
      collection: [],
      currency: 100,
      lastFreePack: 0,
      playerName: null,
      playerAvatar: this.getDefaultAvatar(),
      energy: 50,
      lastOnline: Date.now(),
      role: 'user'
    };
   
    this.constants = {
      packCooldown: 4 * 3600 * 1000,
      maxEnergy: 50,
      regenTime: 5000
    };
    // –î–ª—è –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏
    this.adminClickSequence = [];
    this.adminSequence = ['ArrowUp', 'ArrowUp', 'ArrowDown', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'ArrowLeft', 'ArrowRight', 'KeyB', 'KeyA'];
   
    this.isInitialized = false;
    this.leaderboardCache = [];
  }
 
  async init() {
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
    const loadingScreen = document.getElementById('loadingScreen');
    if (loadingScreen) loadingScreen.style.display = 'flex';
   
    try {
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø–µ—Ä–≤—ã–π –ª–∏ —ç—Ç–æ –∑–∞–ø—É—Å–∫
      const savedPlayerId = localStorage.getItem('playerId');
     
      if (!savedPlayerId) {
        // –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫—É
        if (loadingScreen) loadingScreen.style.display = 'none';
        const initialSetup = document.getElementById('initialSetup');
        if (initialSetup) initialSetup.style.display = 'flex';
        this.setupEventListeners();
        return;
      }
     
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ Firebase
      this.playerId = savedPlayerId;
      const snapshot = await db.ref(`players/${this.playerId}`).once('value');
      if (!snapshot.val()) {
        // –î–∞–Ω–Ω—ã–µ –≤ Firebase –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—É—é –Ω–∞—Å—Ç—Ä–æ–π–∫—É –∑–∞–Ω–æ–≤–æ
        localStorage.clear();
        if (loadingScreen) loadingScreen.style.display = 'none';
        const initialSetup = document.getElementById('initialSetup');
        if (initialSetup) initialSetup.style.display = 'flex';
        this.setupEventListeners();
        return;
      }
     
      // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–≥—Ä–æ–∫–∞
      await this.loadPlayerData();
     
      // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–≥—Ä—É
      this.startGame();
     
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', error);
      this.showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö');
      // –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫—É
      if (loadingScreen) loadingScreen.style.display = 'none';
      const initialSetup = document.getElementById('initialSetup');
      if (initialSetup) initialSetup.style.display = 'flex';
      this.setupEventListeners();
    }
  }
 
  cleanup() {
    // –û—á–∏—â–∞–µ–º –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏
    if (this.onlineInterval) {
      clearInterval(this.onlineInterval);
    }
  }
 
  async completeInitialSetup(playerName, avatarDataUrl = null) {
    try {
      const loadingScreen = document.getElementById('loadingScreen');
      if (loadingScreen) loadingScreen.style.display = 'flex';
      const initialSetup = document.getElementById('initialSetup');
      if (initialSetup) initialSetup.style.display = 'none';
     
      // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –∏–≥—Ä–æ–∫–∞
      this.playerId = 'player_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
     
      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ
      this.data.playerName = playerName;
      if (avatarDataUrl) {
        this.data.playerAvatar = avatarDataUrl;
      }
      this.data.lastOnline = Date.now();
     
      // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
      localStorage.setItem('playerId', this.playerId);
     
      // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ Firebase
      await this.savePlayerData();
     
      // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–≥—Ä—É
      this.startGame();
     
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è:', error);
      this.showNotification('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è');
    }
  }
 
  startGame() {
    const loadingScreen = document.getElementById('loadingScreen');
    if (loadingScreen) loadingScreen.style.display = 'none';
    const gameContainer = document.getElementById('gameContainer');
    if (gameContainer) gameContainer.style.display = 'block';
   
    this.isInitialized = true;
    this.setupEventListeners();
    this.updateUI();
    this.startTimer();
    this.startEnergyRegen();
    this.startOnlineStatusUpdate();
   
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –ª–∏–¥–µ—Ä–±–æ—Ä–¥
    this.loadLeaderboard();
   
    console.log('üéÆ Reghype Card Game –∑–∞–≥—Ä—É–∂–µ–Ω!');
    console.log('üÜî ID –∏–≥—Ä–æ–∫–∞:', this.playerId);
    console.log('üë§ –ò–º—è –∏–≥—Ä–æ–∫–∞:', this.data.playerName);
  }
 
  setupEventListeners() {
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
    document.addEventListener('click', (e) => {
      if (e.target.id === 'cardModal') {
        this.closeCardModal();
      }
    });
    // –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å —á–µ—Ä–µ–∑ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É (Konami Code)
    document.addEventListener('keydown', (e) => {
      this.adminClickSequence.push(e.code);
      if (this.adminClickSequence.length > this.adminSequence.length) {
        this.adminClickSequence.shift();
      }
     
      if (JSON.stringify(this.adminClickSequence) === JSON.stringify(this.adminSequence)) {
        AdminManager.showAuthModal();
        this.adminClickSequence = [];
      }
    });
   
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è Enter –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞ –∏–º–µ–Ω–∏
    const nameInput = document.getElementById('nameInput');
    if (nameInput) {
      nameInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          confirmNameChange();
        }
      });
    }
   
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–≥–æ –≤–≤–æ–¥–∞ –Ω–∏–∫–Ω–µ–π–º–∞
    const initialNameInput = document.getElementById('initialNameInput');
    const characterCounter = document.getElementById('characterCounter');
    const startButton = document.getElementById('startGameButton');
   
    if (initialNameInput && characterCounter && startButton) {
      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤–≤–æ–¥–∞ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
      initialNameInput.addEventListener('input', (e) => {
        const value = e.target.value;
        const length = value.length;
       
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ —Å–∏–º–≤–æ–ª–æ–≤
        characterCounter.textContent = `${length}/12`;
       
        // –ú–µ–Ω—è–µ–º —Ü–≤–µ—Ç –µ—Å–ª–∏ –ø—Ä–∏–±–ª–∏–∂–∞–µ—Ç—Å—è –∫ –ª–∏–º–∏—Ç—É
        if (length >= 10) {
          characterCounter.classList.add('warning');
        } else {
          characterCounter.classList.remove('warning');
        }
       
        // –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–ª—è –∫–Ω–æ–ø–∫–∏
        const isValid = value.trim().length >= 2 && value.trim().length <= 12;
        startButton.disabled = !isValid;
       
        // –í–∏–∑—É–∞–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å
        if (isValid) {
          initialNameInput.style.borderColor = '#00ff99';
        } else if (length > 0) {
          initialNameInput.style.borderColor = '#ff6666';
        } else {
          initialNameInput.style.borderColor = 'transparent';
        }
      });
     
      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ Enter
      initialNameInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter' && !startButton.disabled) {
          completeInitialSetup();
        }
      });
     
      // –§–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –ø—Ä–∏ –ø–æ—è–≤–ª–µ–Ω–∏–∏
      setTimeout(() => {
        const initialSetup = document.getElementById('initialSetup');
        if (initialSetup && initialSetup.style.display === 'flex') {
          initialNameInput.focus();
        }
      }, 500);
     
      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏
      startButton.onclick = () => completeInitialSetup();
    }
   
    // –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞ (–∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É)
    setInterval(() => {
      if (MenuManager.activeMenu === 'leaderboard') {
        this.loadLeaderboard();
      }
    }, 60000);
  }
 
  async loadPlayerData() {
    try {
      const snapshot = await db.ref(`players/${this.playerId}`).once('value');
      const playerData = snapshot.val();
     
      if (playerData) {
        this.data = { ...this.data, ...playerData };
      } else {
        // –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç –≤ Firebase, –∏—Å–ø–æ–ª—å–∑—É–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∫–∞–∫ fallback
        const localData = {
          collection: JSON.parse(localStorage.getItem('collection')) || [],
          currency: parseInt(localStorage.getItem('currency')) || 100,
          lastFreePack: parseInt(localStorage.getItem('lastFreePack')) || 0,
          playerName: localStorage.getItem('playerName'),
          playerAvatar: localStorage.getItem('playerAvatar') || this.getDefaultAvatar(),
          energy: parseInt(localStorage.getItem('energy')) || 50,
          role: localStorage.getItem('role') || 'user'
        };
       
        if (localData.playerName) {
          this.data = { ...this.data, ...localData };
          await this.savePlayerData();
        }
      }
      // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞ –±–∞–Ω
      if (this.data.role === 'banned') {
        this.showNotification('–í–∞—à –∞–∫–∫–∞—É–Ω—Ç –∑–∞–±–∞–Ω–µ–Ω!');
        // –ë–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∏–ª–∏ logout
      }
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏–≥—Ä–æ–∫–∞:', error);
    }
  }
 
  async savePlayerData() {
    if (!this.playerId || !this.isInitialized) return;
   
    try {
      this.data.lastOnline = Date.now();
     
      // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ Firebase
      await db.ref(`players/${this.playerId}`).set(this.data);
     
      // –¢–∞–∫–∂–µ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ –∫–∞–∫ backup
      Object.entries(this.data).forEach(([key, value]) => {
        localStorage.setItem(key, typeof value === 'object' ? JSON.stringify(value) : value);
      });
     
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö:', error);
    }
  }
 
  startOnlineStatusUpdate() {
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –æ–Ω–ª–∞–π–Ω –∫–∞–∂–¥—ã–µ 15 —Å–µ–∫—É–Ω–¥
    this.onlineInterval = setInterval(async () => {
      if (this.isInitialized && this.playerId) {
        try {
          await db.ref(`players/${this.playerId}/lastOnline`).set(Date.now());
        } catch (error) {
          console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –æ–Ω–ª–∞–π–Ω:', error);
        }
      }
    }, 15000);
   
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    window.addEventListener('beforeunload', async () => {
      if (this.playerId) {
        try {
          // –ò—Å–ø–æ–ª—å–∑—É–µ–º sendBeacon –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏
          const data = JSON.stringify({
            lastOnline: Date.now() - 60000 // –°—Ç–∞–≤–∏–º –≤—Ä–µ–º—è –Ω–∞ –º–∏–Ω—É—Ç—É –Ω–∞–∑–∞–¥ —á—Ç–æ–±—ã —Å—Ä–∞–∑—É –ø–æ–∫–∞–∑–∞—Ç—å –æ—Ñ–ª–∞–π–Ω
          });
         
          // –ü—ã—Ç–∞–µ–º—Å—è —á–µ—Ä–µ–∑ sendBeacon (–±–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω–æ)
          if (navigator.sendBeacon) {
            navigator.sendBeacon(`https://regcandy-74da6-default-rtdb.firebaseio.com/players/${this.playerId}/lastOnline.json`,
                                 JSON.stringify(Date.now() - 60000));
          }
         
          // –¢–∞–∫–∂–µ —á–µ—Ä–µ–∑ –æ–±—ã—á–Ω—ã–π –∑–∞–ø—Ä–æ—Å –∫–∞–∫ –∑–∞–ø–∞—Å–Ω–æ–π –≤–∞—Ä–∏–∞–Ω—Ç
          await db.ref(`players/${this.playerId}/lastOnline`).set(Date.now() - 60000);
        } catch (error) {
          console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏:', error);
        }
      }
    });
   
    // –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º –ø–æ—Ç–µ—Ä—é —Ñ–æ–∫—É—Å–∞ –æ–∫–Ω–∞ (–ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –¥—Ä—É–≥—É—é –≤–∫–ª–∞–¥–∫—É)
    document.addEventListener('visibilitychange', async () => {
      if (this.playerId) {
        try {
          if (document.hidden) {
            // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ–∫–ª—é—á–∏–ª—Å—è –Ω–∞ –¥—Ä—É–≥—É—é –≤–∫–ª–∞–¥–∫—É - —Å—á–∏—Ç–∞–µ–º –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–º
            await db.ref(`players/${this.playerId}/lastOnline`).set(Date.now() - 30000);
          } else {
            // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–µ—Ä–Ω—É–ª—Å—è - –æ–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
            await db.ref(`players/${this.playerId}/lastOnline`).set(Date.now());
          }
        } catch (error) {
          console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –≤–∏–¥–∏–º–æ—Å—Ç–∏:', error);
        }
      }
    });
   
    // –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    let lastActivity = Date.now();
    const updateActivity = () => {
      lastActivity = Date.now();
    };
   
    document.addEventListener('mousedown', updateActivity);
    document.addEventListener('mousemove', updateActivity);
    document.addEventListener('keydown', updateActivity);
    document.addEventListener('scroll', updateActivity);
    document.addEventListener('touchstart', updateActivity);
   
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
    setInterval(async () => {
      if (this.playerId && this.isInitialized) {
        const inactiveTime = Date.now() - lastActivity;
       
        // –ï—Å–ª–∏ –Ω–µ–∞–∫—Ç–∏–≤–µ–Ω –±–æ–ª–µ–µ 2 –º–∏–Ω—É—Ç, –ø–æ–º–µ—á–∞–µ–º –∫–∞–∫ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ–≥–æ
        if (inactiveTime > 2 * 60 * 1000) {
          try {
            await db.ref(`players/${this.playerId}/lastOnline`).set(Date.now() - inactiveTime);
          } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Å—Ç–∞—Ç—É—Å–∞:', error);
          }
        }
      }
    }, 30000);
  }
 
  async loadLeaderboard() {
    try {
      const snapshot = await db.ref('players').orderByChild('currency').limitToLast(50).once('value');
      const players = snapshot.val();
     
      if (players) {
        this.leaderboardCache = Object.entries(players)
          .map(([id, data]) => ({
            id,
            name: data.playerName || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∏–≥—Ä–æ–∫',
            cards: data.collection ? data.collection.length : 0,
            currency: data.currency || 0,
            avatar: data.playerAvatar || this.getDefaultAvatar(),
            lastOnline: data.lastOnline || 0,
            role: data.role || 'user',
            isCurrentPlayer: id === this.playerId
          }))
          .sort((a, b) => {
            // –°–Ω–∞—á–∞–ª–∞ –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –∫–∞—Ä—Ç–æ—á–µ–∫, –ø–æ—Ç–æ–º –ø–æ –≤–∞–ª—é—Ç–µ
            if (b.cards !== a.cards) return b.cards - a.cards;
            return b.currency - a.currency;
          });
      }
     
      this.displayLeaderboard();
     
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞:', error);
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ö–æ—Ç—è –±—ã —Ç–µ–∫—É—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞
      this.leaderboardCache = [{
        id: this.playerId,
        name: this.data.playerName || '–í—ã',
        cards: this.data.collection.length,
        currency: this.data.currency,
        avatar: this.data.playerAvatar,
        lastOnline: Date.now(),
        role: this.data.role,
        isCurrentPlayer: true
      }];
      this.displayLeaderboard();
    }
  }
 
  displayLeaderboard() {
    const content = document.getElementById('leaderboardContent');
    if (!content) return;
    content.innerHTML = this.leaderboardCache.map((player, index) => {
      const rankEmoji = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : 'üéñÔ∏è';
      const isOnline = this.isPlayerOnline(player.lastOnline);
      const lastOnlineText = this.getLastOnlineText(player.lastOnline);
      const roleBadge = player.role === 'admin' ? 'üëë' : player.role === 'moder' ? 'üõ°Ô∏è' : player.role === 'banned' ? 'üö´' : '';
     
      return `
        <div class="leader-item ${player.isCurrentPlayer ? 'current-player' : ''}"
             onclick="showPlayerProfile('${player.id}')"
             data-player-id="${player.id}"
             style="cursor: pointer;">
          <div class="leader-rank">${rankEmoji}</div>
          <div class="leader-info">
            <div class="leader-name">
              ${index + 1}. ${player.name} ${roleBadge}
              <div class="online-status ${isOnline ? 'online' : 'offline'}" title="${isOnline ? '–í —Å–µ—Ç–∏' : lastOnlineText}"></div>
            </div>
            <div class="leader-stats">–ö–∞—Ä—Ç–æ—á–µ–∫: ${player.cards} ‚Ä¢ –ú–æ–Ω–µ—Ç: ${player.currency}</div>
            <div class="last-online">${lastOnlineText}</div>
          </div>
        </div>
      `;
    }).join('');
   
    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞
    document.querySelectorAll('.leader-item').forEach(item => {
      item.addEventListener('click', (e) => {
        e.stopPropagation();
        const playerId = item.dataset.playerId;
        if (playerId) {
          showPlayerProfile(playerId);
        }
      });
    });
  }
 
  isPlayerOnline(lastOnline) {
    const now = Date.now();
    const diff = now - lastOnline;
    return diff < 45 * 1000; // –û–Ω–ª–∞–π–Ω –µ—Å–ª–∏ –±—ã–ª –∞–∫—Ç–∏–≤–µ–Ω –º–µ–Ω—å—à–µ 45 —Å–µ–∫—É–Ω–¥ –Ω–∞–∑–∞–¥
  }
 
  getLastOnlineText(lastOnline) {
    const now = Date.now();
    const diff = now - lastOnline;
   
    if (diff < 5 * 60 * 1000) return '–í —Å–µ—Ç–∏';
    if (diff < 60 * 60 * 1000) return `${Math.floor(diff / 60000)} –º–∏–Ω. –Ω–∞–∑–∞–¥`;
    if (diff < 24 * 60 * 60 * 1000) return `${Math.floor(diff / 3600000)} —á. –Ω–∞–∑–∞–¥`;
    return `${Math.floor(diff / 86400000)} –¥–Ω. –Ω–∞–∑–∞–¥`;
  }
 
  getDefaultAvatar() {
    return "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMzAiIGN5PSIzMCIgcj0iMzAiIGZpbGw9IiNmZmNjMDAiLz4KPGZ0ZXh0IHg9IjMwIiB5PSI0MCIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjI0IiBmaWxsPSIjMDAwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj7wn5CCPC90ZXh0Pgo8L3N2Zz4K";
  }
 
  updateUI() {
    if (!this.isInitialized) return;
   
    const currency = document.getElementById('currency');
    if (currency) currency.textContent = `üí∞ –í–∞–ª—é—Ç–∞: ${this.data.currency} –º–æ–Ω–µ—Ç`;
   
    const profileName = document.getElementById('profileName');
    if (profileName) profileName.textContent = this.data.playerName;
   
    const profileNameLarge = document.getElementById('profileNameLarge');
    if (profileNameLarge) profileNameLarge.textContent = this.data.playerName;
   
    const profileCurrency = document.getElementById('profileCurrency');
    if (profileCurrency) profileCurrency.textContent = this.data.currency;
   
    const profileCards = document.getElementById('profileCards');
    if (profileCards) profileCards.textContent = this.data.collection.length;
   
    const energyDisplay = document.getElementById('energyDisplay');
    if (energyDisplay) energyDisplay.textContent = `‚ö° –≠–Ω–µ—Ä–≥–∏—è: ${this.data.energy}/${this.constants.maxEnergy}`;
   
    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–≤–∞—Ç–∞—Ä–æ–≤
    const profileAvatar = document.getElementById('profileAvatar');
    if (profileAvatar) profileAvatar.src = this.data.playerAvatar;
   
    const profileAvatarLarge = document.getElementById('profileAvatarLarge');
    if (profileAvatarLarge) profileAvatarLarge.src = this.data.playerAvatar;
   
    this.displayCollection();
    this.displayProfileCollection();
  }
 
  displayCollection() {
    const collection = document.getElementById('collection');
    if (!collection) return;
    collection.innerHTML = '';
   
    this.data.collection.forEach((card, index) => {
      const cardDiv = document.createElement('div');
      cardDiv.className = `card rarity-${card.rarity}`;
      cardDiv.innerHTML = `
        <img src="${card.image}" alt="${card.name}" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTUwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDE1MCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxNTAiIGhlaWdodD0iMjAwIiBmaWxsPSIjMzMzIi8+Cjx0ZXh0IHg9Ijc1IiB5PSIxMDAiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxNCIgZmlsbD0iI2ZmZiIgdGV4dC1hbmNob3I9Im1pZGRsZSI+–ö–∞—Ä—Ç–æ—á–∫–∞</text+Cjwvc3ZnPgo='">
        <div>${card.name}</div>
      `;
      cardDiv.addEventListener('click', () => this.showCardModal(card, index));
      collection.appendChild(cardDiv);
    });
  }
 
  displayProfileCollection() {
    const grid = document.getElementById('profileCollectionGrid');
    if (!grid) return;
    grid.innerHTML = '';
   
    this.data.collection.forEach((card, index) => {
      const cardDiv = document.createElement('div');
      cardDiv.className = `collection-card rarity-${card.rarity}`;
      cardDiv.innerHTML = `<img src="${card.image}" alt="${card.name}" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiBmaWxsPSIjMzMzIi8+Cjx0ZXh0IHg9IjUwIiB5PSI1NSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjEwIiBmaWxsPSIjZmZmIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5–ö–∞—Ä—Ç–∞</text+Cjwvc3ZnPgo='">`;
     
      cardDiv.addEventListener('click', (e) => {
        e.stopPropagation();
        this.showCardModal(card, index);
      });
     
      grid.appendChild(cardDiv);
    });
  }
  async displayOtherPlayerCollection(player) {
    const grid = document.getElementById('otherProfileCollectionGrid');
    if (!grid) return;
    grid.innerHTML = '';
   
    try {
      // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ä–µ–∞–ª—å–Ω—É—é –∫–æ–ª–ª–µ–∫—Ü–∏—é –∏–≥—Ä–æ–∫–∞ –∏–∑ Firebase
      const snapshot = await db.ref(`players/${player.id}/collection`).once('value');
      const playerCards = snapshot.val() || [];
     
      playerCards.forEach((card, index) => {
        const cardDiv = document.createElement('div');
        cardDiv.className = `collection-card rarity-${card.rarity}`;
        cardDiv.innerHTML = `<img src="${card.image}" alt="${card.name}" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiBmaWxsPSIjMzMzIi8+Cjx0ZXh0IHg9IjUwIiB5PSI1NSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjEwIiBmaWxsPSIjZmZmIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5–ö–∞—Ä—Ç–∞</text+Cjwvc3ZnPgo='">`;
       
        // –î–ª—è —á—É–∂–∏—Ö –∫–∞—Ä—Ç–æ—á–µ–∫ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é (–±–µ–∑ –ø—Ä–æ–¥–∞–∂–∏)
        cardDiv.addEventListener('click', (e) => {
          e.stopPropagation();
          this.showCardModal(card, -1, true); // -1 –æ–∑–Ω–∞—á–∞–µ—Ç —á—Ç–æ –∫–∞—Ä—Ç–æ—á–∫–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–æ–¥–∞–Ω–∞
        });
       
        grid.appendChild(cardDiv);
      });
     
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –∏–≥—Ä–æ–∫–∞:', error);
      grid.innerHTML = '<p>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–ª–ª–µ–∫—Ü–∏–∏</p>';
    }
  }
 
  showCardModal(card, index, isOtherPlayer = false) {
    const modal = document.getElementById('cardModal');
    if (!modal) return;
    const modalImage = document.getElementById('modalImage');
    if (modalImage) modalImage.src = card.image;
    const modalName = document.getElementById('modalName');
    if (modalName) modalName.textContent = card.name;
    const modalRarity = document.getElementById('modalRarity');
    if (modalRarity) modalRarity.textContent = `–†–µ–¥–∫–æ—Å—Ç—å: ${card.rarity}`;
    const modalType = document.getElementById('modalType');
    if (modalType) modalType.textContent = `–¢–∏–ø: ${card.type}`;
   
    const sellBtn = document.getElementById('sellCardBtn');
    if (sellBtn) {
      if (isOtherPlayer || index === -1) {
        sellBtn.style.display = 'none';
      } else {
        sellBtn.style.display = 'block';
        sellBtn.onclick = () => this.sellCard(index);
      }
    }
   
    modal.style.display = 'flex';
  }
 
  closeCardModal() {
    const modal = document.getElementById('cardModal');
    if (modal) modal.style.display = 'none';
  }
 
  async sellCard(index) {
    const card = this.data.collection[index];
    const prices = { Common: 10, Rare: 30, Special: 75, Legendary: 150 };
    const price = prices[card.rarity] || 10;
   
    this.data.currency += price;
    this.data.collection.splice(index, 1);
    await this.savePlayerData();
    this.updateUI();
    this.closeCardModal();
   
    this.showNotification(`–ü—Ä–æ–¥–∞–Ω–æ –∑–∞ ${price} –º–æ–Ω–µ—Ç!`);
  }
 
  async openPack(packType = 'free') {
    if (packType === 'free') {
      const now = Date.now();
      if (now - this.data.lastFreePack < this.constants.packCooldown) {
        this.showNotification('–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –ø–∞–∫ –µ—â–µ –Ω–µ –≥–æ—Ç–æ–≤!');
        return;
      }
      this.data.lastFreePack = now;
    } else if (packType === 'paid') {
      if (this.data.currency < 50) {
        this.showNotification('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç!');
        return;
      }
      this.data.currency -= 50;
    }
   
    const newCard = this.generateRandomCard();
    this.data.collection.push(newCard);
    await this.savePlayerData();
    this.displayNewCard(newCard);
    this.updateUI();
  }
 
  generateRandomCard(rarityBonus = 0) {
    const rarityWeights = {
      Common: 60 - rarityBonus,
      Rare: 30,
      Special: 8 + rarityBonus / 2,
      Legendary: 2 + rarityBonus / 2
    };
   
    const totalWeight = Object.values(rarityWeights).reduce((a, b) => a + b, 0);
    let random = Math.random() * totalWeight;
   
    let selectedRarity = 'Common';
    for (const [rarity, weight] of Object.entries(rarityWeights)) {
      random -= weight;
      if (random <= 0) {
        selectedRarity = rarity;
        break;
      }
    }
   
    const cardsOfRarity = cards.filter(card => card.rarity === selectedRarity);
    return cardsOfRarity[Math.floor(Math.random() * cardsOfRarity.length)];
  }
 
  displayNewCard(card) {
    const lastCard = document.getElementById('lastCard');
    if (!lastCard) return;
    lastCard.innerHTML = `
      <div class="card rarity-${card.rarity} animate-card">
        <img src="${card.image}" alt="${card.name}" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTUwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDE1MCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxNTAiIGhlaWdodD0iMjAwIiBmaWxsPSIjMzMzIi8+Cjx0ZXh0IHg9Ijc1IiB5PSIxMDAiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxNCIgZmlsbD0iI2ZmZiIgdGV4dC1hbmNob3I9Im1pZGRsZSI+–ö–∞—Ä—Ç–æ—á–∫–∞</text+Cjwvc3ZnPgo='">
        <div>${card.name}</div>
      </div>
    `;
  }
 
  startTimer() {
    setInterval(() => {
      const now = Date.now();
      const timeLeft = this.constants.packCooldown - (now - this.data.lastFreePack);
     
      const timer = document.getElementById('timer');
      if (!timer) return;
      if (timeLeft <= 0) {
        timer.textContent = '–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –ø–∞–∫ –≥–æ—Ç–æ–≤!';
      } else {
        const hours = Math.floor(timeLeft / 3600000);
        const minutes = Math.floor((timeLeft % 3600000) / 60000);
        const seconds = Math.floor((timeLeft % 60000) / 1000);
        timer.textContent =
          `–î–æ –±–µ—Å–ø–ª–∞—Ç–Ω–æ–≥–æ –ø–∞–∫–∞: ${hours}:${minutes.toString().padStart(2,'0')}:${seconds.toString().padStart(2,'0')}`;
      }
    }, 1000);
  }
 
  startEnergyRegen() {
    setInterval(async () => {
      if (this.data.energy < this.constants.maxEnergy) {
        this.data.energy++;
        await this.savePlayerData();
        this.updateUI();
      }
    }, this.constants.regenTime);
  }
 
  showNotification(text) {
    const notification = document.createElement('div');
    notification.style.cssText = `
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: linear-gradient(45deg, #ff6600, #ffcc00);
      color: #000;
      padding: 15px 30px;
      border-radius: 10px;
      font-weight: bold;
      z-index: 5000;
      animation: slideDown 0.5s ease-out;
    `;
    notification.textContent = text;
    document.body.appendChild(notification);
   
    setTimeout(() => {
      notification.remove();
    }, 3000);
  }
}
// –ê–î–ú–ò–ù –ú–ï–ù–ï–î–ñ–ï–†
class AdminManager {
  static selectedPlayer = null;
  static isAuthenticated = false;
  static adminPassword = 'admin1337'; // –í —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ —Ö—Ä–∞–Ω–∏—Ç—å securely, –Ω–æ –¥–ª—è –ø—Ä–∏–º–µ—Ä–∞
  static adminSequence = ['KeyA', 'KeyD', 'KeyM', 'KeyI', 'KeyN', 'Digit1', 'Digit3', 'Digit3', 'Digit7'];
  static currentSequence = [];
 
  static showAuthModal() {
    const modal = document.getElementById('adminAuthModal');
    if (modal) modal.style.display = 'flex';
    const input = document.getElementById('adminPasswordInput');
    if (input) input.focus();
  }
  static verifyPassword() {
    const input = document.getElementById('adminPasswordInput');
    if (input && input.value === this.adminPassword) {
      this.authenticate();
      this.cancelAuth();
    } else {
      gameManager.showNotification('–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å!');
    }
  }
  static cancelAuth() {
    const modal = document.getElementById('adminAuthModal');
    if (modal) modal.style.display = 'none';
    const input = document.getElementById('adminPasswordInput');
    if (input) input.value = '';
  }
 
  static init() {
    this.populateCardSelects();
    this.refreshStats();
    this.log('–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –≥–æ—Ç–æ–≤–∞', 'success');
   
  }
 
  static authenticate() {
    this.isAuthenticated = true;
    const adminPanel = document.getElementById('adminPanel');
    if (adminPanel) adminPanel.classList.add('show');
    this.log('–ê–¥–º–∏–Ω —É—Å–ø–µ—à–Ω–æ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω', 'success');
    this.refreshStats();
  }
 
  static close() {
    const adminPanel = document.getElementById('adminPanel');
    if (adminPanel) adminPanel.classList.remove('show');
  }
 
  static log(message, type = 'info') {
    const logDiv = document.getElementById('adminLog');
    if (!logDiv) return;
    const timestamp = new Date().toLocaleTimeString();
    const entry = document.createElement('div');
    entry.className = `log-entry ${type}`;
    entry.textContent = `[${timestamp}] ${message}`;
    logDiv.appendChild(entry);
    logDiv.scrollTop = logDiv.scrollHeight;
  }
 
  static clearLog() {
    const logDiv = document.getElementById('adminLog');
    if (logDiv) logDiv.innerHTML = '<div class="log-entry">–õ–æ–≥ –æ—á–∏—â–µ–Ω...</div>';
  }
 
  static populateCardSelects() {
    const selects = [
      document.getElementById('adminCardSelect'),
      document.getElementById('playerCardSelect')
    ];
   
    selects.forEach(select => {
      if (select) {
        select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ä—Ç–æ—á–∫—É...</option>';
        cards.forEach((card, index) => {
          const option = document.createElement('option');
          option.value = index;
          option.textContent = `${card.name} (${card.rarity})`;
          select.appendChild(option);
        });
      }
    });
  }
 
  // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∞–ª—é—Ç–æ–π
  static async setCurrency() {
    const adminCurrency = document.getElementById('adminCurrency');
    if (!adminCurrency) return;
    const amount = parseInt(adminCurrency.value);
    if (isNaN(amount) || amount < 0) {
      this.log('–ù–µ–≤–µ—Ä–Ω–∞—è —Å—É–º–º–∞ –≤–∞–ª—é—Ç—ã', 'error');
      return;
    }
   
    try {
      gameManager.data.currency = amount;
      await gameManager.savePlayerData();
      gameManager.updateUI();
      this.log(`–í–∞–ª—é—Ç–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –Ω–∞ ${amount}`, 'success');
    } catch (error) {
      this.log(`–û—à–∏–±–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤–∞–ª—é—Ç—ã: ${error.message}`, 'error');
    }
  }
 
  static async addCurrency() {
    const adminCurrency = document.getElementById('adminCurrency');
    if (!adminCurrency) return;
    const amount = parseInt(adminCurrency.value);
    if (isNaN(amount) || amount < 0) {
      this.log('–ù–µ–≤–µ—Ä–Ω–∞—è —Å—É–º–º–∞ –≤–∞–ª—é—Ç—ã', 'error');
      return;
    }
   
    try {
      gameManager.data.currency += amount;
      await gameManager.savePlayerData();
      gameManager.updateUI();
      this.log(`–î–æ–±–∞–≤–ª–µ–Ω–æ ${amount} –≤–∞–ª—é—Ç—ã`, 'success');
    } catch (error) {
      this.log(`–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤–∞–ª—é—Ç—ã: ${error.message}`, 'error');
    }
  }
 
  // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏
  static async giveCard() {
    const adminCardSelect = document.getElementById('adminCardSelect');
    if (!adminCardSelect) return;
    const cardIndex = adminCardSelect.value;
    if (!cardIndex) {
      this.log('–ö–∞—Ä—Ç–æ—á–∫–∞ –Ω–µ –≤—ã–±—Ä–∞–Ω–∞', 'error');
      return;
    }
   
    try {
      const card = cards[parseInt(cardIndex)];
      gameManager.data.collection.push(card);
      await gameManager.savePlayerData();
      gameManager.updateUI();
      this.log(`–í—ã–¥–∞–Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–∞: ${card.name}`, 'success');
    } catch (error) {
      this.log(`–û—à–∏–±–∫–∞ –≤—ã–¥–∞—á–∏ –∫–∞—Ä—Ç–æ—á–∫–∏: ${error.message}`, 'error');
    }
  }
 
  static async giveMultipleCards() {
    const adminCardSelect = document.getElementById('adminCardSelect');
    if (!adminCardSelect) return;
    const cardIndex = adminCardSelect.value;
    const adminCardAmount = document.getElementById('adminCardAmount');
    if (!adminCardAmount) return;
    const amount = parseInt(adminCardAmount.value) || 1;
   
    if (!cardIndex) {
      this.log('–ö–∞—Ä—Ç–æ—á–∫–∞ –Ω–µ –≤—ã–±—Ä–∞–Ω–∞', 'error');
      return;
    }
   
    try {
      const card = cards[parseInt(cardIndex)];
      for (let i = 0; i < amount; i++) {
        gameManager.data.collection.push({...card});
      }
      await gameManager.savePlayerData();
      gameManager.updateUI();
      this.log(`–í—ã–¥–∞–Ω–æ ${amount} x ${card.name}`, 'success');
    } catch (error) {
      this.log(`–û—à–∏–±–∫–∞ –≤—ã–¥–∞—á–∏ –∫–∞—Ä—Ç–æ—á–µ–∫: ${error.message}`, 'error');
    }
  }
 
  // –ü–æ–∏—Å–∫ –∏–≥—Ä–æ–∫–æ–≤
  static async searchPlayers(query) {
    if (!query || query.length < 2) {
      const playerSearchResults = document.getElementById('playerSearchResults');
      if (playerSearchResults) playerSearchResults.style.display = 'none';
      return;
    }
   
    try {
      const snapshot = await db.ref('players').once('value');
      const players = snapshot.val() || {};
     
      const results = Object.entries(players)
        .filter(([id, data]) => data.playerName &&
                data.playerName.toLowerCase().includes(query.toLowerCase()))
        .slice(0, 10);
     
      const resultsDiv = document.getElementById('playerSearchResults');
      if (!resultsDiv) return;
      resultsDiv.innerHTML = '';
     
      results.forEach(([id, data]) => {
        const item = document.createElement('div');
        item.className = 'player-search-item';
        item.textContent = `${data.playerName} (${data.role || 'user'}) (${data.collection?.length || 0} cards, ${data.currency || 0} coins)`;
        item.onclick = () => this.selectPlayer(id, data);
        resultsDiv.appendChild(item);
      });
     
      resultsDiv.style.display = results.length > 0 ? 'block' : 'none';
     
    } catch (error) {
      this.log(`–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –∏–≥—Ä–æ–∫–æ–≤: ${error.message}`, 'error');
    }
  }
 
  static selectPlayer(id, data) {
    this.selectedPlayer = { id, data };
    const selectedPlayerName = document.getElementById('selectedPlayerName');
    if (selectedPlayerName) selectedPlayerName.textContent = data.playerName;
    const selectedPlayer = document.getElementById('selectedPlayer');
    if (selectedPlayer) selectedPlayer.style.display = 'block';
    const playerSearchResults = document.getElementById('playerSearchResults');
    if (playerSearchResults) playerSearchResults.style.display = 'none';
    const playerSearch = document.getElementById('playerSearch');
    if (playerSearch) playerSearch.value = data.playerName;
    const playerRoleSelect = document.getElementById('playerRoleSelect');
    if (playerRoleSelect) playerRoleSelect.value = data.role || 'user';
    this.log(`–í—ã–±—Ä–∞–Ω –∏–≥—Ä–æ–∫: ${data.playerName}`, 'info');
  }
 
  // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥—Ä—É–≥–∏–º–∏ –∏–≥—Ä–æ–∫–∞–º–∏
  static async setPlayerCurrency() {
    if (!this.selectedPlayer) {
      this.log('–ò–≥—Ä–æ–∫ –Ω–µ –≤—ã–±—Ä–∞–Ω', 'error');
      return;
    }
   
    const playerCurrency = document.getElementById('playerCurrency');
    if (!playerCurrency) return;
    const amount = parseInt(playerCurrency.value);
    if (isNaN(amount) || amount < 0) {
      this.log('–ù–µ–≤–µ—Ä–Ω–∞—è —Å—É–º–º–∞ –≤–∞–ª—é—Ç—ã', 'error');
      return;
    }
   
    try {
      await db.ref(`players/${this.selectedPlayer.id}/currency`).set(amount);
      this.log(`–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –≤–∞–ª—é—Ç–∞ ${this.selectedPlayer.data.playerName} –Ω–∞ ${amount}`, 'success');
    } catch (error) {
      this.log(`–û—à–∏–±–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤–∞–ª—é—Ç—ã –∏–≥—Ä–æ–∫–∞: ${error.message}`, 'error');
    }
  }
 
  static async givePlayerCard() {
    if (!this.selectedPlayer) {
      this.log('–ò–≥—Ä–æ–∫ –Ω–µ –≤—ã–±—Ä–∞–Ω', 'error');
      return;
    }
   
    const playerCardSelect = document.getElementById('playerCardSelect');
    if (!playerCardSelect) return;
    const cardIndex = playerCardSelect.value;
    if (!cardIndex) {
      this.log('–ö–∞—Ä—Ç–æ—á–∫–∞ –Ω–µ –≤—ã–±—Ä–∞–Ω–∞', 'error');
      return;
    }
   
    try {
      const card = cards[parseInt(cardIndex)];
      const playerRef = db.ref(`players/${this.selectedPlayer.id}/collection`);
      const snapshot = await playerRef.once('value');
      const collection = snapshot.val() || [];
      collection.push(card);
      await playerRef.set(collection);
      this.log(`–í—ã–¥–∞–Ω–∞ ${card.name} –∏–≥—Ä–æ–∫—É ${this.selectedPlayer.data.playerName}`, 'success');
    } catch (error) {
      this.log(`–û—à–∏–±–∫–∞ –≤—ã–¥–∞—á–∏ –∫–∞—Ä—Ç–æ—á–∫–∏ –∏–≥—Ä–æ–∫—É: ${error.message}`, 'error');
    }
  }
  static async setPlayerRole() {
    if (!this.selectedPlayer) {
      this.log('–ò–≥—Ä–æ–∫ –Ω–µ –≤—ã–±—Ä–∞–Ω', 'error');
      return;
    }
   
    const playerRoleSelect = document.getElementById('playerRoleSelect');
    if (!playerRoleSelect) return;
    const role = playerRoleSelect.value;
   
    try {
      await db.ref(`players/${this.selectedPlayer.id}/role`).set(role);
      this.selectedPlayer.data.role = role;
      this.log(`–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ —Ä–æ–ª—å ${role} –¥–ª—è ${this.selectedPlayer.data.playerName}`, 'success');
      if (this.selectedPlayer.id === gameManager.playerId) {
        gameManager.data.role = role;
      }
    } catch (error) {
      this.log(`–û—à–∏–±–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ä–æ–ª–∏ –∏–≥—Ä–æ–∫–∞: ${error.message}`, 'error');
    }
  }
  static async banPlayer() {
    if (!this.selectedPlayer) {
      this.log('–ò–≥—Ä–æ–∫ –Ω–µ –≤—ã–±—Ä–∞–Ω', 'error');
      return;
    }
   
    if (confirm(`–ó–∞–±–∞–Ω–∏—Ç—å ${this.selectedPlayer.data.playerName}?`)) {
      try {
        await db.ref(`players/${this.selectedPlayer.id}/role`).set('banned');
        this.log(`–ó–∞–±–∞–Ω–µ–Ω ${this.selectedPlayer.data.playerName}`, 'warning');
      } catch (error) {
        this.log(`–û—à–∏–±–∫–∞ –±–∞–Ω–∞ –∏–≥—Ä–æ–∫–∞: ${error.message}`, 'error');
      }
    }
  }
 
  // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞
  static async refreshStats() {
    try {
      const snapshot = await db.ref('players').once('value');
      const players = snapshot.val() || {};
     
      const playerCount = Object.keys(players).length;
      const onlineCount = Object.values(players)
        .filter(player => gameManager.isPlayerOnline(player.lastOnline || 0)).length;
      const totalCards = Object.values(players)
        .reduce((sum, player) => sum + (player.collection?.length || 0), 0);
     
      const totalPlayers = document.getElementById('totalPlayers');
      if (totalPlayers) totalPlayers.textContent = playerCount;
      const onlinePlayers = document.getElementById('onlinePlayers');
      if (onlinePlayers) onlinePlayers.textContent = onlineCount;
      const totalCardsElem = document.getElementById('totalCards');
      if (totalCardsElem) totalCardsElem.textContent = totalCards;
     
      this.log('–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞', 'info');
    } catch (error) {
      this.log(`–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏: ${error.message}`, 'error');
    }
  }
 
  // –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
  static async resetTimer() {
    try {
      gameManager.data.lastFreePack = 0;
      await gameManager.savePlayerData();
      this.log('–¢–∞–π–º–µ—Ä –ø–∞–∫–∞ —Å–±—Ä–æ—à–µ–Ω', 'success');
    } catch (error) {
      this.log(`–û—à–∏–±–∫–∞ —Å–±—Ä–æ—Å–∞ —Ç–∞–π–º–µ—Ä–∞: ${error.message}`, 'error');
    }
  }
 
  static async clearCollection() {
    try {
      gameManager.data.collection = [];
      await gameManager.savePlayerData();
      gameManager.updateUI();
      this.log('–ö–æ–ª–ª–µ–∫—Ü–∏—è –æ—á–∏—â–µ–Ω–∞', 'warning');
      gameManager.showNotification('–ö–æ–ª–ª–µ–∫—Ü–∏—è –æ—á–∏—â–µ–Ω–∞!');
    } catch (error) {
      this.log(`–û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –∫–æ–ª–ª–µ–∫—Ü–∏–∏: ${error.message}`, 'error');
    }
  }
 
  static async maxEnergy() {
    try {
      gameManager.data.energy = gameManager.constants.maxEnergy;
      await gameManager.savePlayerData();
      gameManager.updateUI();
      this.log('–≠–Ω–µ—Ä–≥–∏—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –Ω–∞ –º–∞–∫—Å–∏–º—É–º', 'success');
    } catch (error) {
      this.log(`–û—à–∏–±–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –º–∞–∫—Å —ç–Ω–µ—Ä–≥–∏–∏: ${error.message}`, 'error');
    }
  }
 
  static async giveRandomLegendary() {
    try {
      const legendaryCards = cards.filter(card => card.rarity === 'Legendary');
      if (legendaryCards.length === 0) {
        this.log('–ù–µ—Ç –ª–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã—Ö –∫–∞—Ä—Ç–æ—á–µ–∫', 'error');
        return;
      }
     
      const randomCard = legendaryCards[Math.floor(Math.random() * legendaryCards.length)];
      gameManager.data.collection.push(randomCard);
      await gameManager.savePlayerData();
      gameManager.updateUI();
      this.log(`–í—ã–¥–∞–Ω–∞ —Å–ª—É—á–∞–π–Ω–∞—è –ª–µ–≥–µ–Ω–¥–∞—Ä–∫–∞: ${randomCard.name}`, 'success');
    } catch (error) {
      this.log(`–û—à–∏–±–∫–∞ –≤—ã–¥–∞—á–∏ –ª–µ–≥–µ–Ω–¥–∞—Ä–∫–∏: ${error.message}`, 'error');
    }
  }
 
  // –û–ü–ê–°–ù–ê–Ø –ó–û–ù–ê
  static async resetAllPlayers() {
    if (!confirm('‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï: –≠—Ç–æ —Å–±—Ä–æ—Å–∏—Ç –í–°–ï –∞–∫–∫–∞—É–Ω—Ç—ã –∏–≥—Ä–æ–∫–æ–≤! –í—ã –∞–±—Å–æ–ª—é—Ç–Ω–æ —É–≤–µ—Ä–µ–Ω—ã?')) {
      return;
    }
   
    if (!confirm('–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å! –í–≤–µ–¥–∏—Ç–µ "RESET" –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è:')) {
      return;
    }
   
    const confirmation = prompt('–í–≤–µ–¥–∏—Ç–µ "RESET ALL PLAYERS" –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ–ø–∞—Å–Ω–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è:');
    if (confirmation !== 'RESET ALL PLAYERS') {
      this.log('–°–±—Ä–æ—Å –æ—Ç–º–µ–Ω–µ–Ω - –Ω–µ–≤–µ—Ä–Ω–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ', 'warning');
      return;
    }
   
    try {
      const snapshot = await db.ref('players').once('value');
      const players = snapshot.val() || {};
     
      const resetPromises = Object.keys(players).map(playerId => {
        return db.ref(`players/${playerId}`).set({
          playerName: players[playerId].playerName || '–°–±—Ä–æ—Å –ò–≥—Ä–æ–∫–∞',
          playerAvatar: gameManager.getDefaultAvatar(),
          collection: [],
          currency: 100,
          lastFreePack: 0,
          energy: 50,
          lastOnline: Date.now(),
          role: 'user'
        });
      });
     
      await Promise.all(resetPromises);
      this.log('üîÑ –í–°–ï –ê–ö–ö–ê–£–ù–¢–´ –ò–ì–†–û–ö–û–í –°–ë–†–û–®–ï–ù–´', 'warning');
     
      // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Ç–µ–∫—É—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞
      await gameManager.loadPlayerData();
      gameManager.updateUI();
     
    } catch (error) {
      this.log(`–û—à–∏–±–∫–∞ —Å–±—Ä–æ—Å–∞ –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤: ${error.message}`, 'error');
    }
  }
 
  static async clearAllData() {
    if (!confirm('üí• –≠–ö–°–¢–†–ï–ú–ê–õ–¨–ù–û–ï –ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–ï: –≠—Ç–æ –£–î–ê–õ–ò–¢ –í–°–ï –î–ê–ù–ù–´–ï –∏–∑ –±–∞–∑—ã!')) {
      return;
    }
   
    const confirmation = prompt('–í–≤–µ–¥–∏—Ç–µ "DELETE EVERYTHING" –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–æ–ª–Ω–æ–≥–æ —Å—Ç–∏—Ä–∞–Ω–∏—è –±–∞–∑—ã:');
    if (confirmation !== 'DELETE EVERYTHING') {
      this.log('–°—Ç–∏—Ä–∞–Ω–∏–µ –±–∞–∑—ã –æ—Ç–º–µ–Ω–µ–Ω–æ', 'warning');
      return;
    }
   
    try {
      await db.ref('players').remove();
      this.log('üí• –ë–ê–ó–ê –î–ê–ù–ù–´–• –°–¢–Å–†–¢–ê - –í–°–ï –î–ê–ù–ù–´–ï –£–î–ê–õ–ï–ù–´', 'error');
     
      // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É
      setTimeout(() => {
        location.reload();
      }, 2000);
     
    } catch (error) {
      this.log(`–û—à–∏–±–∫–∞ —Å—Ç–∏—Ä–∞–Ω–∏—è –±–∞–∑—ã: ${error.message}`, 'error');
    }
  }
 
  static shutdownServer() {
    this.log('üõë –†–ï–ñ–ò–ú –û–ë–°–õ–£–ñ–ò–í–ê–ù–ò–Ø –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω', 'warning');
    alert('üõë –°–µ—Ä–≤–µ—Ä –≤—Ö–æ–¥–∏—Ç –≤ —Ä–µ–∂–∏–º –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è...');
   
    // –ë–ª–æ–∫–∏—Ä—É–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
    document.body.style.pointerEvents = 'none';
    document.body.style.opacity = '0.5';
   
    const overlay = document.createElement('div');
    overlay.style.cssText = `
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(255, 0, 0, 0.8);
      display: flex;
      justify-content: center;
      align-items: center;
      color: white;
      font-size: 24px;
      font-family: 'Orbitron', sans-serif;
      z-index: 99999;
      text-align: center;
    `;
    overlay.innerHTML = 'üõë<br>–†–ï–ñ–ò–ú –û–ë–°–õ–£–ñ–ò–í–ê–ù–ò–Ø<br><small>–°–µ—Ä–≤–µ—Ä –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω</small>';
    document.body.appendChild(overlay);
  }
}
// –ú–ï–ù–ï–î–ñ–ï–† –ú–ï–ù–Æ
class MenuManager {
  static activeMenu = null;
 
  static toggle(menuType) {
    if (this.activeMenu === menuType) {
      this.close(menuType);
    } else {
      this.closeAll();
      this.open(menuType);
    }
  }
 
  static open(menuType) {
    const modal = document.getElementById(`${menuType}Modal`);
    if (modal) {
      modal.style.display = 'block';
      this.activeMenu = menuType;
     
      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–π –∫–Ω–æ–ø–∫–∏
      document.querySelectorAll('#navbar button').forEach(btn => btn.classList.remove('active'));
      const btn = document.querySelector(`#navbar button[onclick*="${menuType}"]`);
      if (btn) btn.classList.add('active');
     
      // –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –º–µ–Ω—é
      if (menuType === 'profile') {
        gameManager.displayProfileCollection();
        showCurrentProfile();
      } else if (menuType === 'leaderboard') {
        gameManager.loadLeaderboard();
      }
    }
  }
 
  static close(menuType) {
    const modal = document.getElementById(`${menuType}Modal`);
    if (modal) {
      modal.style.display = 'none';
      this.activeMenu = null;
     
      // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É
      document.querySelectorAll('#navbar button').forEach(btn => btn.classList.remove('active'));
    }
  }
 
  static closeAll() {
    document.querySelectorAll('.menu-modal').forEach(modal => {
      modal.style.display = 'none';
    });
    document.querySelectorAll('#navbar button').forEach(btn => btn.classList.remove('active'));
    this.activeMenu = null;
  }
}
// –ú–ï–ù–ï–î–ñ–ï–† –ü–ê–ö–û–í
class PackManager {
  static async buyCommonPack() {
    if (gameManager.data.currency < 30) {
      gameManager.showNotification('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç!');
      return;
    }
   
    gameManager.data.currency -= 30;
    const newCard = gameManager.generateRandomCard(0);
    gameManager.data.collection.push(newCard);
    await gameManager.savePlayerData();
    gameManager.updateUI();
    gameManager.displayNewCard(newCard);
    gameManager.showNotification(`–ü–æ–ª—É—á–µ–Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–∞: ${newCard.name}!`);
  }
 
  static async buyRarePack() {
    if (gameManager.data.currency < 100) {
      gameManager.showNotification('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç!');
      return;
    }
   
    gameManager.data.currency -= 100;
    const newCard = gameManager.generateRandomCard(20);
    gameManager.data.collection.push(newCard);
    await gameManager.savePlayerData();
    gameManager.updateUI();
    gameManager.displayNewCard(newCard);
    gameManager.showNotification(`–ü–æ–ª—É—á–µ–Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–∞: ${newCard.name}!`);
  }
 
  static async buyLegendaryPack() {
    if (gameManager.data.currency < 300) {
      gameManager.showNotification('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç!');
      return;
    }
   
    gameManager.data.currency -= 300;
    const newCard = gameManager.generateRandomCard(40);
    gameManager.data.collection.push(newCard);
    await gameManager.savePlayerData();
    gameManager.updateUI();
    gameManager.displayNewCard(newCard);
    gameManager.showNotification(`–ü–æ–ª—É—á–µ–Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–∞: ${newCard.name}!`);
  }
}
// –ú–ï–ù–ï–î–ñ–ï–† –ö–õ–ò–ö–ï–†–ê
class ClickerManager {
  static isVideoPlaying = false;
  static videoQueue = 0;
 
  static async earnClick() {
    if (gameManager.data.energy <= 0) {
      gameManager.showNotification('–≠–Ω–µ—Ä–≥–∏—è –∑–∞–∫–æ–Ω—á–∏–ª–∞—Å—å!');
      return;
    }
   
    gameManager.data.energy--;
    gameManager.data.currency += Math.floor(Math.random() * 5) + 1;
    await gameManager.savePlayerData();
    gameManager.updateUI();
   
    // –≠—Ñ—Ñ–µ–∫—Ç –∫–ª–∏–∫–∞
    const catContainer = document.querySelector('.cat-container');
    if (catContainer) {
      catContainer.classList.add('click-effect');
      setTimeout(() => catContainer.classList.remove('click-effect'), 300);
    }
   
    this.playVideo();
  }
 
  static async playVideo() {
    const video = document.getElementById('catVideo');
   
    if (!video) return;
   
    if (this.isVideoPlaying) {
      this.videoQueue++;
      return;
    }
   
    try {
      this.isVideoPlaying = true;
     
      video.currentTime = 0;
     
      const playPromise = video.play();
     
      if (playPromise !== undefined) {
        await playPromise;
       
        setTimeout(() => {
          video.pause();
          video.currentTime = 0;
          this.isVideoPlaying = false;
         
          if (this.videoQueue > 0) {
            this.videoQueue--;
            setTimeout(() => this.playVideo(), 100);
          }
        }, 1000);
      } else {
        this.isVideoPlaying = false;
      }
    } catch (error) {
      console.log('–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –≤–∏–¥–µ–æ:', error);
      this.isVideoPlaying = false;
    }
  }
}
// –§–£–ù–ö–¶–ò–ò –î–õ–Ø HTML
function openPack() {
  gameManager.openPack('free');
}
function buyPack() {
  gameManager.openPack('paid');
}
function openProfile() {
  MenuManager.toggle('profile');
}
function showNameModal() {
  const modal = document.getElementById('nameModal');
  if (modal) modal.style.display = 'flex';
  const input = document.getElementById('nameInput');
  if (input) {
    input.value = gameManager.data.playerName;
    setTimeout(() => input.focus(), 100);
  }
}
function closeNameModal() {
  const modal = document.getElementById('nameModal');
  if (modal) modal.style.display = 'none';
}
async function confirmNameChange() {
  const input = document.getElementById('nameInput');
  if (!input) return;
  const newName = input.value.trim();
 
  if (newName && newName.length > 0 && newName.length <= 20) {
    gameManager.data.playerName = newName;
    await gameManager.savePlayerData();
    gameManager.updateUI();
    gameManager.showNotification('–ò–º—è –∏–∑–º–µ–Ω–µ–Ω–æ!');
    closeNameModal();
  } else {
    gameManager.showNotification('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∏–º—è (1-20 —Å–∏–º–≤–æ–ª–æ–≤)!');
  }
}
function changeAvatar() {
  const avatarInput = document.getElementById('avatarInput');
  if (avatarInput) avatarInput.click();
}
async function handleAvatarUpload(event) {
  const file = event.target.files[0];
  if (file && file.type.startsWith('image/')) {
    const reader = new FileReader();
    reader.onload = async function(e) {
      gameManager.data.playerAvatar = e.target.result;
      await gameManager.savePlayerData();
      gameManager.updateUI();
      gameManager.showNotification('–ê–≤–∞—Ç–∞—Ä –∏–∑–º–µ–Ω–µ–Ω!');
    };
    reader.readAsDataURL(file);
  }
}
async function handleInitialAvatarUpload(event) {
  const file = event.target.files[0];
  if (file && file.type.startsWith('image/')) {
    const reader = new FileReader();
    reader.onload = function(e) {
      const preview = document.getElementById('initialAvatarPreview');
      if (preview) preview.src = e.target.result;
    };
    reader.readAsDataURL(file);
  }
}
async function completeInitialSetup() {
  const input = document.getElementById('initialNameInput');
  if (!input) return;
  const playerName = input.value.trim();
 
  if (!playerName || playerName.length < 2) {
    gameManager.showNotification('–ù–∏–∫–Ω–µ–π–º –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 2 —Å–∏–º–≤–æ–ª–∞!');
    return;
  }
 
  if (playerName.length > 12) {
    gameManager.showNotification('–ù–∏–∫–Ω–µ–π–º —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–π (–º–∞–∫—Å–∏–º—É–º 12 —Å–∏–º–≤–æ–ª–æ–≤)!');
    return;
  }
 
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–µ —Å–∏–º–≤–æ–ª—ã
  const validNameRegex = /^[a-zA-Z–∞-—è–ê-–Ø0-9_\-]+$/;
  if (!validNameRegex.test(playerName)) {
    gameManager.showNotification('–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã, _ –∏ -');
    return;
  }
 
  const initialAvatarInput = document.getElementById('initialAvatarInput');
  let avatarDataUrl = null;
  if (initialAvatarInput && initialAvatarInput.files[0]) {
    const reader = new FileReader();
    reader.onload = async function(e) {
      avatarDataUrl = e.target.result;
      await gameManager.completeInitialSetup(playerName, avatarDataUrl);
    };
    reader.readAsDataURL(initialAvatarInput.files[0]);
    return; // –ñ–¥—ë–º –∑–∞–≥—Ä—É–∑–∫–∏ –∞–≤–∞—Ç–∞—Ä–∫–∏
  }
 
  await gameManager.completeInitialSetup(playerName, avatarDataUrl);
}
// –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –Ω–∏—Ö
document.addEventListener('click', (e) => {
  if (e.target.classList.contains('menu-modal')) {
    MenuManager.closeAll();
  }
 
  if (e.target.id === 'nameModal') {
    closeNameModal();
  }
  if (e.target.id === 'adminAuthModal') {
    AdminManager.cancelAuth();
  }
});
// –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
document.addEventListener('keydown', (e) => {
  if (e.key === 'Escape') {
    MenuManager.closeAll();
    if (gameManager.isInitialized) {
      gameManager.closeCardModal();
    }
    closeNameModal();
    AdminManager.cancelAuth();
  }
});
// –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ò–ì–†–´
const gameManager = new GameManager();
// –ó–∞–ø—É—Å–∫–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', () => {
  gameManager.init();
  AdminManager.init();
});
</script>
</body>
</html>
