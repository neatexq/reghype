<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=no">
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500&family=Roboto&display=swap" rel="stylesheet">
<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<style>
/* –û–°–ù–û–í–ù–´–ï –°–¢–ò–õ–ò */
body {
  margin:0;
  font-family:'Roboto',sans-serif;
  background: linear-gradient(135deg, #4A148C, #880E4F); /* –§–∏–æ–ª–µ—Ç–æ–≤—ã–π –∫ —Ä–æ–∑–æ–≤–æ–º—É */
  color:#fff;
  text-align:center;
  overflow-x:hidden;
  animation: backgroundPulse 10s ease infinite alternate; /* –ê–Ω–∏–º–∞—Ü–∏—è —Ñ–æ–Ω–∞ */
}
@keyframes backgroundPulse {
  0% { background: linear-gradient(135deg, #4A148C, #880E4F); }
  100% { background: linear-gradient(135deg, #880E4F, #4A148C); }
}
h1 {
  font-family:'Orbitron',sans-serif;
  color:#FFEBEE; /* –°–≤–µ—Ç–ª–æ-—Ä–æ–∑–æ–≤—ã–π/–±–µ–ª—ã–π */
  margin:20px 0;
  cursor:pointer;
  text-shadow:0 0 15px #E91E63; /* –†–æ–∑–æ–≤–æ–µ —Å–≤–µ—á–µ–Ω–∏–µ */
  animation: glowText 2s ease-in-out infinite alternate;
}
@keyframes glowText {
  0% { text-shadow: 0 0 10px #E91E63; }
  100% { text-shadow: 0 0 20px #E91E63; }
}
button {
  padding:12px 25px;
  margin:10px;
  border:none;
  border-radius:12px;
  background: linear-gradient(45deg, #E91E63, #AB47BC); /* –†–æ–∑–æ–≤—ã–π –∫ —Ñ–∏–æ–ª–µ—Ç–æ–≤–æ–º—É */
  font-weight:bold;
  color:#fff;
  font-size:18px;
  cursor:pointer;
  transition:0.3s;
  box-shadow: 0 4px 15px rgba(233, 30, 99, 0.5);
}
button:hover{
  transform:scale(1.05) rotate(2deg); /* –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ä–æ—Ç–∞—Ü–∏—è –¥–ª—è –¥–∏–Ω–∞–º–∏–∫–∏ */
  box-shadow: 0 6px 20px rgba(233, 30, 99, 0.7);
}
#currency{
  font-size:22px;
  margin:10px;
  color:#FFEBEE; /* –°–≤–µ—Ç–ª—ã–π */
  font-weight:bold;
  text-shadow: 0 0 5px #AB47BC;
}
/* –ü–†–û–§–ò–õ–¨ –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø */
.profile-info {
  display: flex;
  align-items: center;
  justify-content: center;
  margin: 20px 0;
  gap: 15px;
  animation: fadeIn 1s ease-out;
}
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(-20px); }
  to { opacity: 1; transform: translateY(0); }
}
.profile-avatar {
  width: 60px;
  height: 60px;
  border-radius: 50%;
  border: 3px solid #E91E63; /* –†–æ–∑–æ–≤–∞—è –≥—Ä–∞–Ω–∏—Ü–∞ */
  object-fit: cover;
  cursor: pointer;
  transition: 0.3s;
  animation: avatarPulse 2s infinite;
}
@keyframes avatarPulse {
  0% { box-shadow: 0 0 10px #E91E63; }
  50% { box-shadow: 0 0 20px #E91E63; }
  100% { box-shadow: 0 0 10px #E91E63; }
}
.profile-avatar:hover {
  transform: scale(1.1) rotate(5deg);
  box-shadow: 0 0 20px rgba(233, 30, 99, 0.8);
}
.profile-name {
  font-size: 20px;
  color:#FFEBEE;
  font-weight: bold;
  cursor: pointer;
  transition:0.3s;
  text-shadow: 0 0 5px #AB47BC;
}
.profile-name:hover {
  color: #E91E63;
  text-shadow:0 0 15px #E91E63;
  transform: scale(1.05);
}
/* –ö–ê–†–¢–û–ß–ö–ò */
#lastCard .card {
  max-width: 150px;
  font-size: 16px;
  margin: 12px auto;
}
#lastCard .card img {
  max-width: 100%;
  height: auto;
  border-radius: 14px;
}
.card{
  display:inline-block;
  margin:10px;
  text-align:center;
  transition:0.5s;
  border-radius:12px;
  padding:5px;
  position:relative;
  animation: cardHover 1.5s infinite alternate;
}
@keyframes cardHover {
  0% { transform: translateY(0); }
  100% { transform: translateY(-5px); }
}
.card img{
  max-width:150px;
  border-radius:12px;
  transition:0.5s;
}
/* –†–ï–î–ö–û–°–¢–ò –ö–ê–†–¢–û–ß–ï–ö */
.rarity-Common{
  border:3px solid #F3E5F5; /* –°–≤–µ—Ç–ª–æ-—Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π */
  box-shadow:0 0 15px #F3E5F5;
}
.rarity-Rare{
  border:3px solid #AB47BC; /* –§–∏–æ–ª–µ—Ç–æ–≤—ã–π */
  box-shadow:0 0 15px #AB47BC;
  animation:glowPurple 2s infinite alternate;
}
.rarity-Special{
  border:3px solid #E91E63; /* –†–æ–∑–æ–≤—ã–π */
  box-shadow:0 0 20px #E91E63;
  animation:glowPink 2s infinite alternate;
}
.rarity-Legendary{
  border:3px solid #FFEBEE; /* –ë–µ–ª—ã–π/—Å–≤–µ—Ç–ª—ã–π */
  box-shadow:0 0 25px #FFEBEE;
  animation:glowWhite 2s infinite alternate;
}
@keyframes glowPurple{
  0%{box-shadow:0 0 15px #AB47BC;}
  100%{box-shadow:0 0 30px #AB47BC;}
}
@keyframes glowPink{
  0%{box-shadow:0 0 15px #E91E63;}
  100%{box-shadow:0 0 35px #E91E63;}
}
@keyframes glowWhite{
  0%{box-shadow:0 0 20px #FFEBEE;}
  100%{box-shadow:0 0 40px #FFEBEE;}
}
.animate-card{
  transform:scale(0) rotateY(0deg);
  animation:popCard 0.8s forwards;
}
@keyframes popCard{
  0%{transform:scale(0) rotateY(0deg);opacity:0;}
  50%{transform:scale(1.3) rotateY(180deg);opacity:1;}
  100%{transform:scale(1) rotateY(360deg);opacity:1;}
}
.timer{
  font-size:16px;
  color:#FFEBEE;
  margin:10px;
  text-shadow: 0 0 5px #E91E63;
}
#collection {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  margin-bottom: 80px;
  margin-top: 20px;
}
h2 {
  margin-top: 40px;
  margin-bottom: 25px;
  font-size: 24px;
  text-align: center;
  color: #FFEBEE;
  text-shadow: 0 0 10px #AB47BC;
  animation: textFade 2s ease infinite alternate;
}
@keyframes textFade {
  0% { opacity: 0.8; }
  100% { opacity: 1; }
}

#adminPanel {
  position: fixed;
  top: 0;
  right: -500px;
  width: 480px;
  height: 100vh;
  background: linear-gradient(135deg, rgba(74,20,140,0.98), rgba(136,14,79,0.98));
  border-left: 3px solid transparent;
  backdrop-filter: blur(15px);
  transition: all 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  z-index: 10000;
  overflow-y: auto;
  box-shadow: -10px 0 30px rgba(233,30,99,0.5);
}
#adminPanel.show {
  right: 0;
  border-left: 3px solid #E91E63;
}
#adminPanel::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(45deg,
    rgba(233,30,99,0.1),
    rgba(171,71,188,0.05),
    rgba(255,235,238,0.1),
    rgba(233,30,99,0.1)
  );
  background-size: 400% 400%;
  animation: adminGlow 4s ease infinite;
  z-index: -1;
}
@keyframes adminGlow {
  0%, 100% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
}
.admin-header, .admin-section, .admin-danger-zone { position:relative; }
.admin-button.danger { background: linear-gradient(45deg, #AD1457, #E91E63);}
.admin-button.success { background: linear-gradient(45deg, #AB47BC, #FFEBEE);}
.admin-button.warning { background: linear-gradient(45deg, #AB47BC, #E91E63);}
.admin-log { height: 120px; overflow-y: auto; background: rgba(0,0,0,0.3); padding: 7px; border-radius: 7px;}
.log-entry { font-size: 12px; margin-bottom:2px; }



.admin-header {
  padding: 20px;
  border-bottom: 2px solid rgba(233,30,99,0.3);
  background: linear-gradient(135deg, rgba(233,30,99,0.1), rgba(233,30,99,0.05));
}
.admin-header h2 {
  color: #E91E63;
  margin: 0;
  font-family: 'Orbitron', sans-serif;
  font-size: 24px;
  text-shadow: 0 0 10px rgba(233,30,99,0.5);
  display: flex;
  align-items: center;
  gap: 10px;
}

.admin-close-btn:hover {
  background: rgba(233,30,99,0.4);
  transform: rotate(90deg);
}
.admin-section {
  padding: 20px;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}
.admin-section h3 {
  color: #FFEBEE;
  font-family: 'Orbitron', sans-serif;
  font-size: 16px;
  margin: 0 0 15px 0;
  text-transform: uppercase;
  letter-spacing: 1px;
  text-shadow: 0 0 5px #AB47BC;
}
.admin-input-group {
  display: flex;
  gap: 10px;
  margin-bottom: 15px;
  align-items: center;
}
.admin-input {
  flex: 1;
  padding: 8px 12px;
  border: 1px solid rgba(171,71,188,0.3);
  border-radius: 6px;
  background: rgba(0, 0, 0, 0.5);
  color: white;
  font-size: 14px;
  outline: none;
  transition: 0.3s;
}
.admin-input:focus {
  border-color: #AB47BC;
  box-shadow: 0 0 10px rgba(171,71,188,0.3);
}
.admin-select {
  padding: 8px 12px;
  border: 1px solid rgba(171,71,188,0.3);
  border-radius: 6px;
  background: rgba(0, 0, 0, 0.7);
  color: white;
  font-size: 14px;
  outline: none;
  cursor: pointer;
}
.admin-button {
  padding: 10px 15px;
  border: none;
  border-radius: 8px;
  background: linear-gradient(45deg, #E91E63, #AB47BC);
  color: white;
  font-weight: bold;
  cursor: pointer;
  transition: 0.3s;
  font-size: 12px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin: 2px;
}
.admin-button:hover {
  transform: translateY(-2px) rotate(3deg);
  box-shadow: 0 5px 15px rgba(233,30,99,0.4);
}
.admin-button.danger {
  background: linear-gradient(45deg, #AD1457, #E91E63);
}
.admin-button.warning {
  background: linear-gradient(45deg, #AB47BC, #E91E63);
}
.admin-button.success {
  background: linear-gradient(45deg, #AB47BC, #FFEBEE);
}
.admin-log {
  background: rgba(0, 0, 0, 0.7);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 8px;
  padding: 10px;
  height: 150px;
  overflow-y: auto;
  font-family: monospace;
  font-size: 12px;
  color: #ccc;
  margin-top: 10px;
}
.log-entry {
  margin-bottom: 5px;
  padding: 2px 5px;
  border-radius: 3px;
}
.log-entry.success {
  background: rgba(171,71,188,0.1);
  color: #AB47BC;
}
.log-entry.error {
  background: rgba(233,30,99,0.1);
  color: #E91E63;
}
.log-entry.warning {
  background: rgba(171,71,188,0.1);
  color: #AB47BC;
}
.player-search-list {
  max-height: 200px;
  overflow-y: auto;
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 6px;
  background: rgba(0, 0, 0, 0.7);
}
.player-search-item {
  padding: 8px 12px;
  cursor: pointer;
  transition: 0.3s;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}
.player-search-item:hover {
  background: rgba(171,71,188,0.2);
}
.player-search-item:last-child {
  border-bottom: none;
}
.admin-warning {
  background: rgba(171,71,188,0.2);
  border: 1px solid #AB47BC;
  border-radius: 8px;
  padding: 15px;
  margin: 15px 0;
  color: #AB47BC;
  font-size: 14px;
  text-align: center;
}
.admin-danger-zone {
  background: rgba(233,30,99,0.1);
  border: 2px solid rgba(233,30,99,0.5);
  border-radius: 10px;
  padding: 20px;
  margin: 20px 0;
}
.admin-danger-zone h3 {
  color: #E91E63;
  text-align: center;
  margin-bottom: 15px;
}
.card-preview {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 5px;
  background: rgba(255, 255, 255, 0.05);
  border-radius: 6px;
  margin: 5px 0;
}
.card-preview img {
  width: 30px;
  height: 40px;
  object-fit: cover;
  border-radius: 3px;
}
/* –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –ö–ê–†–¢–û–ß–ö–ò */
#cardModal{
  display:none;
  position:fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  background:rgba(0,0,0,0.85);
  justify-content:center;
  align-items:center;
  z-index: 99999 !important;
  animation: modalFade 0.5s ease;
}
@keyframes modalFade {
  from { opacity: 0; }
  to { opacity: 1; }
}
#cardContent {
  background: linear-gradient(135deg, #4A148C, #880E4F);
  padding: 15px;
  border: 2px solid #E91E63;
  border-radius: 12px;
  text-align: center;
  position: relative;
  max-width: 240px;
  transform: scale(0.9);
  animation: modalPop 0.4s forwards;
}
#cardContent img{
  max-width:100%;
  border-radius:12px;
  box-shadow:0 0 20px #E91E63;
  margin-bottom:10px;
}
@keyframes modalPop{
  0%{transform:scale(0);}
  60%{transform:scale(1.2);}
  100%{transform:scale(1);}
}
#cardContent button{
  padding:8px 15px;
  margin-top:10px;
  border:none;
  border-radius:8px;
  background:#E91E63;
  color:#fff;
  cursor:pointer;
  transition:0.3s;
}
#cardContent button:hover{
  transform:scale(1.05);
}
/* –ù–ê–í–ë–ê–† */
#navbar {
  display: flex;
  justify-content: space-around;
  background: linear-gradient(135deg, #4A148C, #880E4F);
  padding: 15px 10px;
  border-top: 2px solid #E91E63;
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  z-index: 3000;
  box-shadow: 0 -4px 15px rgba(233,30,99,0.5);
}
#navbar button {
  flex: 1;
  margin: 0 5px;
  padding: 12px 10px;
  background: linear-gradient(45deg, #E91E63, #AB47BC);
  border: none;
  border-radius: 8px;
  font-weight: bold;
  cursor: pointer;
  transition: 0.3s;
}
#navbar button:hover {
  transform: scale(1.05) rotate(2deg);
}
#navbar button.active {
  background: linear-gradient(45deg, #FFEBEE, #E91E63);
  box-shadow: 0 0 15px rgba(233,30,99,0.5);
}
/* –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê –ú–ï–ù–Æ */
.menu-modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.8);
  backdrop-filter: blur(5px);
  z-index: 4000;
  animation: fadeIn 0.3s ease-out;
}
.menu-content {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: linear-gradient(135deg, #4A148C, #880E4F);
  border: 3px solid #E91E63;
  border-radius: 20px;
  padding: 30px;
  width: 90vw;
  max-width: 600px;
  max-height: 80vh;
  overflow-y: auto;
  box-shadow: 0 0 50px rgba(233,30,99,0.3);
  animation: slideIn 0.4s ease-out;
}
.menu-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 25px;
  border-bottom: 2px solid #E91E63;
  padding-bottom: 15px;
}
.menu-title {
  font-family: 'Orbitron', sans-serif;
  color: #FFEBEE;
  font-size: 28px;
  text-shadow: 0 0 10px #E91E63;
  margin: 0;
}
.close-btn {
  background: none;
  border: none;
  color: #E91E63;
  font-size: 32px;
  cursor: pointer;
  transition: 0.3s;
  padding: 5px 10px;
  border-radius: 50%;
}
.close-btn:hover {
  background: rgba(233,30,99,0.2);
  transform: rotate(90deg);
}
@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}
@keyframes slideIn {
  from {
    opacity: 0;
    transform: translate(-50%, -60%);
  }
  to {
    opacity: 1;
    transform: translate(-50%, -50%);
  }
}
/* –°–¢–ò–õ–ò –î–õ–Ø –ö–û–¢–ò–ö–ê */
.cat-container {
  display: inline-block;
  margin: 20px;
  cursor: pointer;
  transition: transform 0.2s;
}
.cat-container:hover {
  transform: scale(1.05) rotate(3deg);
}
.cat-container:active {
  transform: scale(0.95);
}
#catVideo {
  width: 200px;
  height: 200px;
  border-radius: 15px;
  border: 3px solid #E91E63;
  box-shadow: 0 0 20px rgba(233,30,99,0.5);
  object-fit: cover;
  -webkit-playsinline: true;
  playsinline: true;
  animation: videoGlow 2s infinite alternate;
}
@keyframes videoGlow {
  0% { box-shadow: 0 0 10px #E91E63; }
  100% { box-shadow: 0 0 30px #E91E63; }
}
/* –§–æ–ª–ª–±–µ–∫ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –µ—Å–ª–∏ –≤–∏–¥–µ–æ –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è */
.cat-container::after {
  content: 'üê±';
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 80px;
  display: none;
}

/* –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–º–æ–¥–∑–∏ –µ—Å–ª–∏ –≤–∏–¥–µ–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç */
.cat-container.fallback::after {
  display: block;
}


/* –ú–û–ë–ò–õ–¨–ù–ê–Ø –ê–î–ê–ü–¢–ê–¶–ò–Ø */
@media screen and (max-width: 768px) {
  /* –û—Å–Ω–æ–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã */
  body {
    font-size: 14px;
    padding-bottom: 90px; /* –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –æ—Ç—Å—Ç—É–ø –¥–ª—è –Ω–∞–≤–±–∞—Ä–∞ */
  }

  h1 {
    font-size: 24px;
    margin: 10px 0;
  }

  h2 {
    font-size: 20px;
    margin: 20px 0 15px 0;
  }

  /* –ö–Ω–æ–ø–∫–∏ */
  button {
    padding: 10px 15px;
    font-size: 14px;
    margin: 5px;
  }

  /* –ü—Ä–æ—Ñ–∏–ª—å */
  .profile-info {
    flex-direction: column;
    gap: 10px;
    margin: 15px 0;
  }

  .profile-avatar {
    width: 50px;
    height: 50px;
  }

  .profile-name {
    font-size: 18px;
  }

  #currency {
    font-size: 18px;
    margin: 15px 0;
  }

  /* –ö–∞—Ä—Ç–æ—á–∫–∏ */
  .card {
    margin: 5px;
  }

  .card img {
    max-width: 120px;
  }

  #collection {
    margin-bottom: 100px;
    padding: 0 10px;
  }

  /* –ù–∞–≤–±–∞—Ä */
  #navbar {
    padding: 10px 5px;
    flex-wrap: wrap;
    height: auto;
  }

  #navbar button {
    flex: 1;
    min-width: calc(50% - 10px);
    margin: 2px;
    padding: 8px 5px;
    font-size: 12px;
  }

  /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
  .menu-content {
    width: 95vw;
    max-width: none;
    margin: 10px;
    padding: 20px;
    max-height: 85vh;
  }

  .menu-title {
    font-size: 22px;
  }

  /* –ö–ª–∏–∫–∞–ª–∫–∞ */
  #catVideo {
    width: 150px;
    height: 150px;
  }

  .cat-container::after {
    font-size: 60px;
  }

  /* –ü—Ä–æ—Ñ–∏–ª—å */
  .profile-section {
    margin: 10px;
    padding: 15px;
  }

  .profile-header {
    flex-direction: column;
    text-align: center;
    gap: 15px;
  }

  .profile-avatar-large {
    width: 80px;
    height: 80px;
  }

  .profile-stats {
    grid-template-columns: 1fr;
    gap: 10px;
  }

  .stat-item {
    padding: 10px;
  }

  .stat-value {
    font-size: 20px;
  }

  /* –õ–∏–¥–µ—Ä–±–æ—Ä–¥ */
  .leader-item {
    padding: 10px;
    margin: 5px 0;
  }

  .leader-rank {
    font-size: 20px;
    margin-right: 8px;
  }

  .leader-name {
    font-size: 14px;
  }

  .leader-stats {
    font-size: 12px;
  }

  /* –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å */
  #adminPanel {
    width: 100vw;
    right: -100vw;
  }

  #adminPanel.show {
    right: 0;
  }

  .admin-input {
    font-size: 14px;
    padding: 6px 10px;
  }

  .admin-button {
    font-size: 10px;
    padding: 8px 12px;
  }

  /* –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ */
  .setup-content {
    width: 95%;
    padding: 30px 20px;
  }

  .setup-content h2 {
    font-size: 24px;
  }

  .nickname-input-container input {
    max-width: 280px;
    font-size: 16px;
    padding: 15px 20px;
  }

  .start-button {
    padding: 15px 30px;
    font-size: 16px;
  }

  /* –ö–æ–ª–ª–µ–∫—Ü–∏—è –≤ –ø—Ä–æ—Ñ–∏–ª–µ */
  .collection-grid {
    grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
    gap: 8px;
  }

  /* –£–ª—É—á—à–µ–Ω–∏—è */
  .upgrade-item {
    padding: 10px;
    flex-direction: column;
    text-align: center;
    gap: 10px;
  }

  .upgrade-info {
    text-align: center;
  }

  .upgrade-button {
    width: 100%;
  }
}

/* –û—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–∏–µ —ç–∫—Ä–∞–Ω—ã */
@media screen and (max-width: 480px) {
  #navbar button {
    font-size: 11px;
    padding: 6px 3px;
  }

  .menu-title {
    font-size: 18px;
  }

  .setup-content h2 {
    font-size: 20px;
  }

  .nickname-input-container input {
    max-width: 240px;
  }

  #catVideo {
    width: 120px;
    height: 120px;
  }

  .cat-container::after {
    font-size: 50px;
  }
}

.cat-container.fallback #catVideo {
  opacity: 0;
}
.click-effect {
  animation: clickPulse 0.3s ease-out;
}
@keyframes clickPulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.1); }
  100% { transform: scale(1); }
}
/* –°–¢–ò–õ–ò –ü–†–û–§–ò–õ–Ø */
.profile-section {
  background: linear-gradient(135deg, #880E4F, #4A148C);
  border: 2px solid #E91E63;
  border-radius: 15px;
  padding: 20px;
  margin: 20px;
  max-width: 500px;
  margin: 20px auto;
  box-shadow: 0 0 20px rgba(233,30,99,0.5);
  animation: profileGlow 2s infinite alternate;
}
@keyframes profileGlow {
  0% { box-shadow: 0 0 10px rgba(233,30,99,0.5); }
  100% { box-shadow: 0 0 25px rgba(233,30,99,0.5); }
}
.profile-header {
  display: flex;
  align-items: center;
  gap: 20px;
  margin-bottom: 20px;
}
.profile-avatar-large {
  width: 100px;
  height: 100px;
  border-radius: 50%;
  border: 3px solid #E91E63;
  object-fit: cover;
  cursor: pointer;
  transition: 0.3s;
}
.profile-avatar-large:hover {
  transform: scale(1.1) rotate(5deg);
  box-shadow: 0 0 20px rgba(233,30,99,0.7);
}
.profile-details h3 {
  color: #FFEBEE;
  margin: 0 0 10px 0;
  font-family: 'Orbitron', sans-serif;
  text-shadow: 0 0 5px #AB47BC;
}
.profile-stats {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 15px;
  text-align: center;
}
.stat-item {
  background: rgba(233,30,99,0.1);
  padding: 15px;
  border-radius: 10px;
  border: 1px solid rgba(233,30,99,0.3);
}
.stat-value {
  font-size: 24px;
  font-weight: bold;
  color: #FFEBEE;
  display: block;
}
.stat-label {
  color: #ccc;
  font-size: 14px;
}
.profile-actions {
  display: flex;
  gap: 10px;
  justify-content: center;
  margin-top: 20px;
}
.profile-actions button {
  padding: 10px 20px;
  font-size: 14px;
}
/* –°–∫—Ä—ã—Ç—ã–π input –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤ */
#avatarInput {
  display: none;
}
/* –ö–æ–ª–ª–µ–∫—Ü–∏—è –≤ –ø—Ä–æ—Ñ–∏–ª–µ */
.profile-collection {
  margin-top: 30px;
  border-top: 2px solid #E91E63;
  padding-top: 20px;
}
.collection-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
  gap: 10px;
  max-height: 400px;
  overflow-y: auto;
}
.collection-card {
  aspect-ratio: 1;
  border: 2px solid #AB47BC;
  border-radius: 8px;
  overflow: hidden;
  transition: 0.3s;
  cursor: pointer;
}
.collection-card:hover {
  transform: scale(1.05) rotate(2deg);
}
.collection-card img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}
/* –ö–ê–°–¢–û–ú–ù–´–ô –ú–û–î–ê–õ–¨–ù–´–ô –î–ò–ê–õ–û–ì –î–õ–Ø –°–ú–ï–ù–´ –ò–ú–ï–ù–ò */
#nameModal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.8);
  justify-content: center;
  align-items: center;
  z-index: 5000;
}
.name-content {
  background: linear-gradient(135deg, #4A148C, #880E4F);
  border: 3px solid #E91E63;
  border-radius: 15px;
  padding: 25px;
  text-align: center;
  max-width: 400px;
  animation: modalPop 0.4s forwards;
}
.name-content h3 {
  color: #FFEBEE;
  margin-bottom: 20px;
  font-family: 'Orbitron', sans-serif;
  text-shadow: 0 0 5px #AB47BC;
}
.name-content input {
  width: 100%;
  padding: 12px;
  border: 2px solid #E91E63;
  border-radius: 8px;
  background: #111;
  color: #fff;
  font-size: 16px;
  margin-bottom: 20px;
  box-sizing: border-box;
}
.name-content input:focus {
  outline: none;
  box-shadow: 0 0 10px rgba(233,30,99,0.5);
}
.name-actions {
  display: flex;
  gap: 10px;
  justify-content: center;
}
.name-actions button {
  padding: 10px 20px;
  margin: 0;
}
/* –õ–ò–î–ï–†–ë–û–†–î –° –ü–†–û–ö–†–£–¢–ö–û–ô */
.leaderboard-container {
  max-height: 400px;
  overflow-y: auto;
  padding-right: 10px;
}
.leader-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 15px;
  margin: 10px 0;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 10px;
  border: 1px solid #AB47BC;
  cursor: pointer;
  transition: 0.3s;
}
.leader-item:hover {
  background: rgba(233,30,99,0.1);
  border-color: #E91E63;
  transform: translateX(5px) scale(1.02);
}
.leader-item.current-player {
  background: rgba(233,30,99,0.2);
  border-color: #E91E63;
}
.leader-info {
  text-align: left;
  flex: 1;
}
.leader-name {
  font-weight: bold;
  color: #fff;
  margin-bottom: 5px;
  display: flex;
  align-items: center;
  gap: 10px;
}
.leader-stats {
  font-size: 14px;
  color: #ccc;
}
.leader-rank {
  font-size: 24px;
  margin-right: 10px;
}
.last-online {
  font-size: 12px;
  color: #888;
  margin-top: 3px;
}
.online-status {
  width: 12px;
  height: 12px;
  border-radius: 50%;
  display: inline-block;
  margin-left: 5px;
}
.online-status.online {
  background: #E91E63;
  box-shadow: 0 0 6px #E91E63;
}
.online-status.offline {
  background: #666;
}
.leader-avatar {
  width: 30px;
  height: 30px;
  border-radius: 50%;
  object-fit: cover;
}
/* –ü–†–û–§–ò–õ–¨ –î–†–£–ì–û–ì–û –ò–ì–†–û–ö–ê */
.other-profile-section {
  background: linear-gradient(135deg, #880E4F, #4A148C);
  border: 2px solid #E91E63;
  border-radius: 15px;
  padding: 20px;
  margin: 20px auto;
  max-width: 500px;
}

#collectionFilterBar {
  display: flex;
  gap: 13px;
  align-items: center;
  background: linear-gradient(135deg, #4A148C 60%, #880E4F 100%);
  padding: 12px 18px;
  border-radius: 16px;
  margin-bottom: 22px;
  box-shadow: 0 3px 18px #E91E6340, 0 1.5px 8px #AB47BC50;
  border: 2px solid #E91E63;
  max-width: 700px;
  margin-left: auto;
  margin-right: auto;
  flex-wrap: wrap;
}

#collectionFilterBar input,
#collectionFilterBar select {
  padding: 8px 14px;
  border-radius: 10px;
  border: 2px solid #E91E63;
  background: #1c1024;
  color: #fff;
  font-size: 1em;
  min-width: 0;
  width: 170px;
  box-sizing: border-box;
}

@media (max-width: 550px) {
  #collectionFilterBar {
    flex-direction: column;
    align-items: stretch;
    gap: 7px;
    padding: 10px 6px;
    margin-bottom: 12px;
  }
  #collectionFilterBar input,
  #collectionFilterBar select {
    width: 100%;
    min-width: 0;
    margin: 0;
    font-size: 1em;
  }
}

/* –ü–ï–†–í–û–ù–ê–ß–ê–õ–¨–ù–ê–Ø –ù–ê–°–¢–†–û–ô–ö–ê */
#initialSetup {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(135deg, #4A148C, #880E4F, #4A148C);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 9999;
  backdrop-filter: blur(10px);
}
.setup-content {
  background: linear-gradient(135deg, rgba(74,20,140,0.95), rgba(136,14,79,0.95));
  border: 2px solid transparent;
  background-clip: padding-box;
  border-radius: 25px;
  padding: 50px;
  text-align: center;
  max-width: 600px;
  width: 90%;
  position: relative;
  overflow: hidden;
  box-shadow:
    0 25px 50px rgba(233,30,99,0.5),
    0 0 0 1px rgba(233,30,99,0.2),
    inset 0 1px 0 rgba(255, 255, 255, 0.1);
  animation: setupAppear 0.8s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
}
.setup-content::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(45deg,
    rgba(233,30,99,0.1) 0%,
    rgba(171,71,188,0.05) 25%,
    rgba(255,235,238,0.05) 50%,
    rgba(233,30,99,0.1) 75%,
    rgba(233,30,99,0.1) 100%
  );
  background-size: 400% 400%;
  animation: gradientShift 6s ease infinite;
  border-radius: 25px;
  z-index: -1;
}
.setup-content::after {
  content: '';
  position: absolute;
  top: -2px;
  left: -2px;
  right: -2px;
  bottom: -2px;
  background: linear-gradient(45deg, #E91E63, #AB47BC, #FFEBEE, #E91E63);
  background-size: 400% 400%;
  animation: borderGlow 3s ease infinite;
  border-radius: 25px;
  z-index: -2;
}
@keyframes setupAppear {
  0% {
    opacity: 0;
    transform: scale(0.8) rotateY(-15deg);
    filter: blur(10px);
  }
  100% {
    opacity: 1;
    transform: scale(1) rotateY(0deg);
    filter: blur(0px);
  }
}
@keyframes gradientShift {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}
@keyframes borderGlow {
  0%, 100% {
    background-position: 0% 50%;
    opacity: 0.8;
  }
  50% {
    background-position: 100% 50%;
    opacity: 1;
  }
}
.setup-content h2 {
  color: #FFEBEE;
  font-family: 'Orbitron', sans-serif;
  font-size: 32px;
  margin-bottom: 20px;
  text-shadow:
    0 0 20px rgba(233,30,99,0.8),
    0 0 40px rgba(233,30,99,0.4);
  animation: titlePulse 2s ease-in-out infinite alternate;
  position: relative;
}
.setup-content h2::after {
  content: '‚ú®';
  position: absolute;
  right: -40px;
  top: 50%;
  transform: translateY(-50%);
  animation: sparkle 1.5s ease-in-out infinite;
}
@keyframes titlePulse {
  0% { text-shadow: 0 0 20px rgba(233,30,99,0.8), 0 0 40px rgba(233,30,99,0.4); }
  100% { text-shadow: 0 0 30px rgba(233,30,99,1), 0 0 60px rgba(233,30,99,0.6); }
}
@keyframes sparkle {
  0%, 100% {
    opacity: 0.5;
    transform: translateY(-50%) scale(1) rotate(0deg);
  }
  50% {
    opacity: 1;
    transform: translateY(-50%) scale(1.2) rotate(180deg);
  }
}
.setup-content p {
  color: rgba(255, 255, 255, 0.8);
  margin-bottom: 35px;
  line-height: 1.6;
  font-size: 16px;
  font-weight: 300;
  letter-spacing: 0.5px;
}
.nickname-input-container {
  position: relative;
  margin: 30px 0;
}
.nickname-input-container input {
  width: 100%;
  max-width: 350px;
  padding: 18px 25px;
  border: 2px solid rgba(233,30,99,0.3);
  border-radius: 15px;
  background: linear-gradient(135deg, rgba(20, 20, 20, 0.95), rgba(40, 40, 40, 0.95));
  color: #ffffff;
  font-size: 18px;
  font-weight: 500;
  text-align: center;
  transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  box-shadow:
    inset 0 3px 8px rgba(0, 0, 0, 0.4),
    0 0 0 1px rgba(233,30,99,0.2),
    0 4px 15px rgba(233,30,99,0.1);
  outline: none;
  position: relative;
  z-index: 1;
  box-sizing: border-box;
  backdrop-filter: blur(10px);
}
.nickname-input-container input::placeholder {
  color: rgba(233,30,99,0.4);
  font-weight: 300;
  letter-spacing: 1px;
}
.nickname-input-container input:focus {
  border-color: #E91E63;
  background: linear-gradient(135deg, rgba(20, 20, 20, 1), rgba(40, 40, 40, 1));
  box-shadow:
    inset 0 3px 8px rgba(0, 0, 0, 0.4),
    0 0 0 3px rgba(233,30,99,0.4),
    0 0 25px rgba(233,30,99,0.3),
    0 4px 20px rgba(233,30,99,0.2);
  transform: translateY(-3px) scale(1.02);
}
.nickname-input-container input:valid {
  border-color: #AB47BC;
  box-shadow:
    inset 0 3px 8px rgba(0, 0, 0, 0.4),
    0 0 0 2px rgba(171,71,188,0.4),
    0 0 20px rgba(171,71,188,0.2),
    0 4px 15px rgba(171,71,188,0.1);
}
.character-counter {
  position: absolute;
  bottom: -25px;
  right: 0;
  font-size: 12px;
  color: rgba(255, 255, 255, 0.5);
  transition: all 0.3s ease;
}
.character-counter.warning {
  color: #E91E63;
  font-weight: bold;
}
.start-button {
  background: linear-gradient(135deg, #E91E63, #AB47BC, #E91E63);
  background-size: 200% 200%;
  border: none;
  border-radius: 15px;
  padding: 18px 40px;
  font-size: 18px;
  font-weight: bold;
  color: #fff;
  cursor: pointer;
  transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  margin-top: 25px;
  position: relative;
  overflow: hidden;
  box-shadow:
    0 8px 25px rgba(233,30,99,0.3),
    inset 0 1px 0 rgba(255, 255, 255, 0.2);
  animation: buttonGlow 2s ease-in-out infinite alternate;
}
.start-button::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
  transition: all 0.6s;
}
.start-button:hover::before {
  left: 100%;
}
.start-button:hover {
  background-position: 100% 100%;
  transform: translateY(-3px) rotate(2deg);
  box-shadow:
    0 12px 35px rgba(233,30,99,0.4),
    inset 0 1px 0 rgba(255, 255, 255, 0.3);
}
.start-button:active {
  transform: translateY(-1px);
  box-shadow:
    0 6px 20px rgba(233,30,99,0.3),
    inset 0 1px 0 rgba(255, 255, 255, 0.2);
}
.start-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
  animation: none;
}
@keyframes buttonGlow {
  0% { box-shadow: 0 8px 25px rgba(233,30,99,0.3), inset 0 1px 0 rgba(255, 255, 255, 0.2); }
  100% { box-shadow: 0 8px 35px rgba(233,30,99,0.5), inset 0 1px 0 rgba(255, 255, 255, 0.3); }
}
#gameContainer {
  display: none;
}
.loading-screen {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(135deg, #4A148C, #880E4F);
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  z-index: 10000;
}
.loading-spinner {
  width: 60px;
  height: 60px;
  border: 4px solid #AB47BC;
  border-top: 4px solid #E91E63;
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin-bottom: 20px;
}



@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
.loading-text {
  color: #FFEBEE;
  font-family: 'Orbitron', sans-serif;
  font-size: 18px;
  text-shadow: 0 0 10px #E91E63;
}
@keyframes slideDown {
  from { transform: translateX(-50%) translateY(-100px); opacity: 0; }
  to { transform: translateX(-50%) translateY(0); opacity: 1; }
}
#adminAuthModal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.8);
  justify-content: center;
  align-items: center;
  z-index: 9998;
}
.admin-auth-content {
  background: linear-gradient(135deg, #4A148C, #880E4F);
  border: 3px solid #E91E63;
  border-radius: 15px;
  padding: 25px;
  text-align: center;
  max-width: 400px;
  animation: modalPop 0.4s forwards;
}
.admin-auth-content h3 {
  color: #E91E63;
  margin-bottom: 20px;
  font-family: 'Orbitron', sans-serif;
}
.admin-auth-content input {
  width: 100%;
  padding: 12px;
  border: 2px solid #E91E63;
  border-radius: 8px;
  background: #111;
  color: #fff;
  font-size: 16px;
  margin-bottom: 20px;
  box-sizing: border-box;
  type: password;
}
.admin-auth-content input:focus {
  outline: none;
  box-shadow: 0 0 10px rgba(233,30,99,0.5);
}
.admin-auth-actions {
  display: flex;
  gap: 10px;
  justify-content: center;
}
.admin-auth-actions button {
  padding: 10px 20px;
  margin: 0;
}
.admin-section select {
  flex: 1;
}
/* Add styles for upgrades modal */
#upgradesModal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.8);
  backdrop-filter: blur(5px);
  z-index: 4000;
  animation: fadeIn 0.3s ease-out;
}
#upgradesContent {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: linear-gradient(135deg, #4A148C, #880E4F);
  border: 3px solid #E91E63;
  border-radius: 20px;
  padding: 30px;
  width: 90vw;
  max-width: 600px;
  max-height: 80vh;
  overflow-y: auto;
  box-shadow: 0 0 50px rgba(233,30,99,0.3);
  animation: slideIn 0.4s ease-out;
}
.upgrade-item {
  background: rgba(233,30,99,0.1);
  padding: 15px;
  border-radius: 10px;
  margin-bottom: 10px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  transition: 0.3s;
}
.upgrade-item:hover {
  background: rgba(233,30,99,0.2);
  transform: translateX(5px) scale(1.02);
}
.upgrade-info {
  flex: 1;
  text-align: left;
}
.upgrade-title {
  font-weight: bold;
  color: #FFEBEE;
}
.upgrade-description {
  color: #ccc;
  font-size: 14px;
}
.upgrade-level {
  color: #AB47BC;
  font-size: 12px;
}
.upgrade-button {
  padding: 8px 15px;
  background: linear-gradient(45deg, #AB47BC, #E91E63);
  border: none;
  border-radius: 8px;
  color: #fff;
  font-weight: bold;
  cursor: pointer;
  transition: 0.3s;
}
.upgrade-button:hover {
  transform: scale(1.05) rotate(2deg);
}
.upgrade-button.disabled {
  background: linear-gradient(45deg, #666, #999);
  cursor: not-allowed;
}
/* –ë—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø –∫ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏ */
#quickAdminBtn {
  display: none;
  position: fixed;
  top: 20px;
  right: 20px;
  width: 40px;
  height: 40px;
  background: linear-gradient(45deg, #E91E63, #AB47BC);
  border-radius: 50%;
  color: white;
  font-size: 20px;
  cursor: pointer;
  transition: 0.3s;
  z-index: 9999;
  box-shadow: 0 0 10px rgba(233,30,99,0.5);
  align-items: center;
  justify-content: center;
}
#quickAdminBtn:hover {
  transform: scale(1.1) rotate(10deg);
  box-shadow: 0 0 15px rgba(233,30,99,0.7);
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ */
.settings-section {
  margin: 20px 0;
  padding: 15px;
  background: rgba(233,30,99,0.1);
  border-radius: 10px;
  border: 1px solid rgba(233,30,99,0.3);
}

.settings-section h3 {
  color: #FFEBEE;
  margin-bottom: 10px;
}

.settings-section select,
.settings-section input[type="range"] {
  width: 100%;
  padding: 8px;
  background: rgba(0,0,0,0.5);
  border: 1px solid #E91E63;
  border-radius: 5px;
  color: #fff;
  cursor: pointer;
}

.settings-section span {
  display: block;
  text-align: right;
  margin-top: 5px;
  color: #ccc;
}
</style>
</head>
<body>
<!-- –≠–ö–†–ê–ù –ó–ê–ì–†–£–ó–ö–ò -->
<div id="loadingScreen" class="loading-screen">
  <div class="loading-spinner"></div>
  <div class="loading-text" data-i18n="loading">–ó–∞–≥—Ä—É–∑–∫–∞ Reghype...</div>
</div>
<!-- –ü–ï–†–í–û–ù–ê–ß–ê–õ–¨–ù–ê–Ø –ù–ê–°–¢–†–û–ô–ö–ê -->
<div id="initialSetup" style="display: none;">
  <div class="setup-content">
    <h2 data-i18n="welcome">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Reghype!</h2>
    <p data-i18n="choose_nickname">–ü—Ä–∏–¥—É–º–∞–π—Ç–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –Ω–∏–∫–Ω–µ–π–º –¥–ª—è –Ω–∞—á–∞–ª–∞ –∏–≥—Ä—ã:</p>
    <div class="nickname-input-container">
      <input type="text" id="initialNameInput" placeholder="–í–∞—à –Ω–∏–∫–Ω–µ–π–º" maxlength="12" autocomplete="off" spellcheck="false">
      <div class="character-counter" id="characterCounter">0/12</div>
    </div>
    <p data-i18n="choose_avatar">–í—ã–±–µ—Ä–∏—Ç–µ –∞–≤–∞—Ç–∞—Ä–∫—É (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):</p>
    <input type="file" id="initialAvatarInput" accept="image/*" onchange="handleInitialAvatarUpload(event)">
    <img id="initialAvatarPreview" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMzAiIGN5PSIzMCIgcj0iMzAiIGZpbGw9IiNmZmNjMDAiLz4KPGZ0ZXh0IHg9IjMwIiB5PSI0MCIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjI0IiBmaWxsPSIjMDAwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj7wn5CCPC90ZXh0Pgo8L3N2Zz4K" alt="–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∞–≤–∞—Ç–∞—Ä–∫–∏" style="width: 100px; height: 100px; border-radius: 50%; border: 3px solid #ffcc00; margin: 10px 0;">
    <button class="start-button" id="startGameButton" disabled data-i18n="start_game">üöÄ –ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
  </div>
</div>
<!-- –û–°–ù–û–í–ù–ê–Ø –ò–ì–†–ê -->
<div id="gameContainer">
<h1 id="logo" data-i18n="title">Reghype</h1>
<div id="packOpenModal" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:8000;background:rgba(0,0,0,0.85);justify-content:center;align-items:center;">
  <div id="packOpenContent" style="background:linear-gradient(135deg,#4A148C,#880E4F);padding:32px 24px 24px 24px;border-radius:18px;box-shadow:0 0 50px #E91E63cc;text-align:center;max-width:95vw;animation:popPackOpen .7s cubic-bezier(.4,2,.3,1)">
    <div id="packOpenCardImage"></div>
    <div id="packOpenCardName" style="font-size:26px;color:#FFD700;margin-top:12px;font-weight:bold;"></div>
    <div id="packOpenCardDesc" style="font-size:18px;margin:12px 0 2px;color:#fff;text-shadow:0 0 7px #AB47BC;"></div>
    <button onclick="closePackOpenModal()" style="margin-top:20px;padding:10px 44px;background:#E91E63;border-radius:9px;color:#fff;font-size:17px;font-weight:bold;border:none;box-shadow:0 3px 25px #E91E6350;cursor:pointer;">OK</button>
  </div>
</div>
<style>
@keyframes popPackOpen {
  0% { transform: scale(0.7) rotate(-25deg); opacity: 0;}
  100% { transform: scale(1) rotate(0deg); opacity: 1;}
}
@keyframes spinPack {
  0% { transform: rotate(0deg);}
  100% { transform: rotate(360deg);}
}
#packOpenCardImage img {
  width: 120px; height: 150px;
  border-radius: 12px;
  box-shadow: 0 0 30px #FFD70090, 0 3px 30px #AB47BC50;
  margin: 12px 0 2px 0;
  animation: cardAppearFromPack .4s cubic-bezier(.4,1.6,.4,1) forwards;
  opacity: 0;
}
@keyframes cardAppearFromPack {
  0% { transform: scale(0.5) rotateY(-180deg); opacity:0; }
  70% { transform: scale(1.15) rotateY(0deg); opacity:1; }
  100% { transform: scale(1) rotateY(0deg); opacity:1; }
}

.styled-duplicates-btn {
  margin: 14px auto 22px auto;
  display: block;
  padding: 12px 28px;
  font-size: 16px;
  font-family: 'Orbitron', sans-serif;
  border: none;
  border-radius: 12px;
  background: linear-gradient(45deg, #E91E63, #AB47BC);
  color: #fff;
  font-weight: bold;
  box-shadow: 0 4px 15px rgba(233, 30, 99, 0.15);
  cursor: pointer;
  transition: 0.2s;
  letter-spacing: 0.5px;
  outline: none;
  text-shadow: 0 1px 3px #AB47BC66;
}
.styled-duplicates-btn.active,
.styled-duplicates-btn:active {
  background: linear-gradient(45deg, #43e97b, #38f9d7);
  color: #222;
  box-shadow: 0 6px 30px rgba(67,233,123,0.15);
  text-shadow: 0 1px 2px #43e97b66;
  transform: translateY(-2px) scale(1.03);
}
.styled-duplicates-btn:hover {
  filter: brightness(1.07);
  box-shadow: 0 8px 24px #ab47bc44;
}

</style>

<!-- –ö–Ω–æ–ø–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–æ–¥–∞—Ä–∫–æ–≤ -->
<button id="giftOpenBtn" onclick="GiftManager.openGlobalGiftModal()" style="
  position: fixed;
  right: 24px;
  bottom: 90px; /* —á—É—Ç—å –≤—ã—à–µ –∫–Ω–æ–ø–∫–∏ —á–∞—Ç–∞ (chatOpenBtn - 85px, giftOpenBtn - 150px) */
  z-index: 5002;
  width: 52px;
  height: 52px;
  background: linear-gradient(45deg, #43e97b, #38f9d7);
  border-radius: 50%;
  border: none;
  color: #fff;
  font-size: 28px;
  box-shadow: 0 4px 18px #43e97b88;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
">
  üéÅ
</button>




<div id="giftModal" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:9500;background:rgba(0,0,0,0.8);justify-content:center;align-items:center;">
  <div style="background:linear-gradient(135deg,#4A148C,#880E4F);padding:28px 24px 24px 24px;border-radius:18px;box-shadow:0 0 50px #E91E63cc;text-align:center;max-width:95vw;min-width:320px;">
    <h2 style="color:#FFEBEE;">üéÅ –ü–æ–¥–∞—Ä–æ–∫ –∏–≥—Ä–æ–∫—É</h2>
    <div style="margin-bottom:12px;">
      <div style="color:#ddd;font-size:16px;margin-bottom:8px;">–í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä–æ–∫–∞:</div>
      <div id="giftRecipientList" style="background:#fff1;border-radius:7px;max-height:260px;overflow-y:auto;text-align:left;min-width:250px;">
        <!-- –°—é–¥–∞ –±—É–¥–µ—Ç –ø–æ–¥–≥—Ä—É–∂–∞—Ç—å—Å—è —Å–ø–∏—Å–æ–∫ –∏–≥—Ä–æ–∫–æ–≤ -->
      </div>
    </div>
    <div id="giftOptions"></div>
    <button onclick="GiftManager.closeGiftModal()" style="margin-top:18px;padding:8px 29px;background:#E91E63;border-radius:8px;color:#fff;font-size:17px;font-weight:bold;border:none;box-shadow:0 3px 25px #E91E6350;cursor:pointer;">–û—Ç–º–µ–Ω–∞</button>
  </div>
</div>




<!-- –ü–†–û–§–ò–õ–¨ –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø -->
<div class="profile-info">
  <img id="profileAvatar" class="profile-avatar" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMzAiIGN5PSIzMCIgcj0iMzAiIGZpbGw9IiNmZmNjMDAiLz4KPGZ0ZXh0IHg9IjMwIiB5PSI0MCIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjI0IiBmaWxsPSIjMDAwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj7wn5CCPC90ZXh0Pgo8L3N2Zz4K" alt="–ê–≤–∞—Ç–∞—Ä" onclick="openProfile()">
  <div class="profile-name" id="profileName" onclick="openProfile()" data-i18n="player">–ò–≥—Ä–æ–∫</div>
</div>
<div id="currency" data-i18n="currency">üí∞ –í–∞–ª—é—Ç–∞: 100 –º–æ–Ω–µ—Ç</div>
<button onclick="openPack()" data-i18n="free_pack">üéÅ –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –ø–∞–∫</button>
<button onclick="buyPack()" data-i18n="buy_pack">üíé –ö—É–ø–∏—Ç—å –ø–∞–∫ (50 –º–æ–Ω–µ—Ç)</button>
<p class="timer" id="timer" data-i18n="timer"></p>
<div id="lastCard"></div>
<h2 data-i18n="collection">–ú–æ—è –∫–æ–ª–ª–µ–∫—Ü–∏—è</h2>
<button onclick="MenuManager.toggle('index')" style="margin-bottom:10px;">üìñ –ê–ª—å–±–æ–º</button>
<div id="collection"></div>
<!-- –°–ö–†–´–¢–´–ï –≠–õ–ï–ú–ï–ù–¢–´ -->
<input type="file" id="avatarInput" accept="image/*" onchange="handleAvatarUpload(event)">
<!-- –ù–ê–í–ë–ê–† -->
<div id="navbar">
  <button onclick="MenuManager.toggle('profile')" data-i18n="profile">üë§ –ü—Ä–æ—Ñ–∏–ª—å</button>
  <button onclick="MenuManager.toggle('clicker')" data-i18n="clicker">üñ± –ö–ª–∏–∫–∞–ª–∫–∞</button>
  <button onclick="MenuManager.toggle('packs')" data-i18n="packs">üéÅ –ü–∞–∫–∏</button>
  <button onclick="MenuManager.toggle('upgrades')" data-i18n="upgrades">üî• –£–ª—É—á—à–µ–Ω–∏—è</button>
  <button onclick="MenuManager.toggle('leaderboard')" data-i18n="leaderboard">üèÜ –¢–æ–ø</button>
</div>
<!-- –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê –ú–ï–ù–Æ -->
<div id="profileModal" class="menu-modal">
  <div class="menu-content">
    <div class="menu-header">
      <h2 class="menu-title" data-i18n="profile">üë§ –ü—Ä–æ—Ñ–∏–ª—å</h2>
      <button class="close-btn" onclick="MenuManager.close('profile')">&times;</button>
    </div>
    <div class="profile-section" id="currentPlayerProfile">
      <div class="profile-header">
        <img id="profileAvatarLarge" class="profile-avatar-large" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMzAiIGN5PSIzMCIgcj0iMzAiIGZpbGw9IiNmZmNjMDAiLz4KPGZ0ZXh0IHg9IjMwIiB5PSI0MCIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjI0IiBmaWxsPSIjMDAwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj7wn5CCPC90ZXh0Pgo8L3N2Zz4K" alt="–ê–≤–∞—Ç–∞—Ä" onclick="changeAvatar()">
        <div class="profile-details">
          <h3 id="profileNameLarge" data-i18n="player">–ò–≥—Ä–æ–∫</h3>
          <div class="profile-stats">
            <div class="stat-item">
              <span class="stat-value" id="profileCurrency">100</span>
              <span class="stat-label" data-i18n="coins">–ú–æ–Ω–µ—Ç</span>
            </div>
            <div class="stat-item">
              <span class="stat-value" id="profileCards">0</span>
              <span class="stat-label" data-i18n="cards">–ö–∞—Ä—Ç–æ—á–µ–∫</span>
            </div>
          </div>
        </div>
      </div>
   
      <div class="profile-actions">
        <button onclick="showNameModal()" data-i18n="change_name">‚úèÔ∏è –°–º–µ–Ω–∏—Ç—å –∏–º—è</button>
        <button onclick="changeAvatar()" data-i18n="change_avatar">üñºÔ∏è –°–º–µ–Ω–∏—Ç—å –∞–≤–∞—Ç–∞—Ä</button>
      </div>
   
      <div class="profile-collection">
        <h3 data-i18n="card_collection">–ö–æ–ª–ª–µ–∫—Ü–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫</h3>
        <div id="profileCollectionGrid" class="collection-grid"></div>
      </div>
    </div>
 
    <!-- –ü—Ä–æ—Ñ–∏–ª—å –¥—Ä—É–≥–æ–≥–æ –∏–≥—Ä–æ–∫–∞ -->
    <div class="other-profile-section" id="otherPlayerProfile" style="display: none;">
      <button onclick="showCurrentProfile()" data-i18n="back_to_profile" style="margin-bottom: 15px;">üîô –ù–∞–∑–∞–¥ –∫ –º–æ–µ–º—É –ø—Ä–æ—Ñ–∏–ª—é</button>
      <div class="profile-header">
        <img id="otherProfileAvatar" class="profile-avatar-large" src="" alt="–ê–≤–∞—Ç–∞—Ä">
        <div class="profile-details">
          <h3 id="otherProfileName">–ò–≥—Ä–æ–∫</h3>
          <div class="last-online" id="otherProfileLastOnline" data-i18n="last_online">–ë—ã–ª –≤ —Å–µ—Ç–∏ –Ω–µ–¥–∞–≤–Ω–æ</div>
          <div class="profile-stats">
            <div class="stat-item">
              <span class="stat-value" id="otherProfileCurrency">0</span>
              <span class="stat-label" data-i18n="coins">–ú–æ–Ω–µ—Ç</span>
            </div>
            <div class="stat-item">
              <span class="stat-value" id="otherProfileCards">0</span>
              <span class="stat-label" data-i18n="cards">–ö–∞—Ä—Ç–æ—á–µ–∫</span>
            </div>
          </div>
        </div>
      </div>
   
      <div class="profile-collection">
        <h3 data-i18n="card_collection">–ö–æ–ª–ª–µ–∫—Ü–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫</h3>
        <div id="otherProfileCollectionGrid" class="collection-grid"></div>
      </div>
    </div>
  </div>
</div>
<div id="clickerModal" class="menu-modal">
  <div class="menu-content">
    <div class="menu-header">
      <h2 class="menu-title" data-i18n="clicker">üñ± –ö–ª–∏–∫–∞–ª–∫–∞</h2>
      <button class="close-btn" onclick="MenuManager.close('clicker')">&times;</button>
    </div>
<p data-i18n="clicker_description">–ß–µ—à–∏ –∫–æ–º–∞—Ä—É –∏ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π –º–æ–Ω–µ—Ç–∫–∏!</p>
<div class="cat-container" onclick="ClickerManager.earnClick()">
  <img src="komaru.png" alt="–ö–æ—Ç–∏–∫" class="cat-img" />
</div>

<style>
  .cat-container {
    display: inline-block;
    cursor: pointer;
  }

  .cat-img {
    width: 150px;
    height: 150px;
    border: 4px solid #E91E63; /* —Ä–∞–º–∫–∞ */
    box-shadow: 0 0 15px #E91E63, 0 0 30px #AB47BC; /* —Å–≤–µ—Ç—è—â–∏–π—Å—è —ç—Ñ—Ñ–µ–∫—Ç */
    border-radius: 10px; /* –∑–∞–∫—Ä—É–≥–ª—ë–Ω–Ω—ã–µ —É–≥–ª—ã, –º–æ–∂–Ω–æ —É–±—Ä–∞—Ç—å */
    transition: transform 0.1s ease, box-shadow 0.1s ease;
  }

  .cat-img:active {
    transform: scale(0.9); /* —Å–∂–∞—Ç–∏–µ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ */
    box-shadow: 0 0 25px #E91E63, 0 0 50px #AB47BC; /* —É—Å–∏–ª–µ–Ω–∏–µ —Å–≤–µ—á–µ–Ω–∏—è –ø—Ä–∏ –∫–ª–∏–∫–µ */
  }
</style>




    <p id="energyDisplay" data-i18n="energy">‚ö° –≠–Ω–µ—Ä–≥–∏—è: 50/50</p>
  </div>
</div>
<div id="packsModal" class="menu-modal">
    <div class="menu-content">
        <div class="menu-header">
            <h2 class="menu-title" data-i18n="pack_shop">üéÅ –ú–∞–≥–∞–∑–∏–Ω –ø–∞–∫–æ–≤</h2>
            <button class="close-btn" onclick="MenuManager.close('packs')">&times;</button>
        </div>
        <button onclick="buyPackById('common')" style="width: 100%; margin: 10px 0; padding: 15px;" data-i18n="common_pack">üü¶ –û–±—ã—á–Ω—ã–π –ø–∞–∫ (30 –º–æ–Ω–µ—Ç)</button>
        <button onclick="buyPackById('rare')" style="width: 100%; margin: 10px 0; padding: 15px;" data-i18n="rare_pack">üü© –†–µ–¥–∫–∏–π –ø–∞–∫ (75 –º–æ–Ω–µ—Ç)</button>
        <button onclick="buyPackById('legendary')" style="width: 100%; margin: 10px 0; padding: 15px;" data-i18n="legendary_pack">üü® –õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π –ø–∞–∫ (300 –º–æ–Ω–µ—Ç)</button>
<button onclick="buyPackById('regcandy')" style="width: 100%; margin: 10px 0; padding: 15px; background: linear-gradient(45deg, #E91E63, #AB47BC); border: 2px solid #FFEBEE;">üíé Regcandy –ø–∞–∫ (500 –º–æ–Ω–µ—Ç)</button>
    </div>
</div>
</div>
<div id="upgradesModal" class="menu-modal">
  <div class="menu-content" id="upgradesContent">
    <div class="menu-header">
      <h2 class="menu-title" data-i18n="upgrades">üî• –£–ª—É—á—à–µ–Ω–∏—è</h2>
      <button class="close-btn" onclick="MenuManager.close('upgrades')">&times;</button>
    </div>
    <div id="upgradesList"></div>
  </div>
</div>
<div id="leaderboardModal" class="menu-modal">
  <div class="menu-content">
    <div class="menu-header">
      <h2 class="menu-title" data-i18n="leaderboard">üèÜ –¢–æ–ø –∏–≥—Ä–æ–∫–æ–≤</h2>
      <button class="close-btn" onclick="MenuManager.close('leaderboard')">&times;</button>
    </div>
    <div id="leaderboardContent" class="leaderboard-container"></div>
  </div>
</div>


<!-- ...–ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –ò–ù–î–ï–ö–°–ê -->
<div id="indexModal" class="menu-modal">
  <div class="menu-content">
    <div class="menu-header">
      <h2 class="menu-title">üìñ –ê–ª—å–±–æ–º</h2>
      <button class="close-btn" onclick="MenuManager.close('index')">&times;</button>
    </div>
    <div id="indexContent"></div>
    <div id="indexBonus" style="margin-top:18px;font-weight:bold;color:#FFEBEE;"></div>
  </div>
</div>


<!-- –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –ù–ê–°–¢–†–û–ï–ö -->
<div id="settingsModal" class="menu-modal">
  <div class="menu-content">
    <div class="menu-header">
      <h2 class="menu-title" data-i18n="settings">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
      <button class="close-btn" onclick="MenuManager.close('settings')">&times;</button>
    </div>
    <div class="settings-section">
      <h3 data-i18n="language">–Ø–∑—ã–∫</h3>
      <select id="languageSelect" onchange="SettingsManager.changeLanguage(this.value)">
        <option value="ru" data-i18n="russian">–†—É—Å—Å–∫–∏–π</option>
        <option value="en" data-i18n="english">English</option>
      </select>
    </div>
  </div>
</div>
<!-- –ö–Ω–æ–ø–∫–∞ –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏ -->
<button id="quickAdminBtn" onclick="AdminManager.openQuick()" style="display: none;">üõ°Ô∏è</button>
</div>
<script>
// FIREBASE –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø
const firebaseConfig = {
  apiKey: "AIzaSyBIPugjKSmRvbDNFS_7ClFkbjlb8zfugXM",
  authDomain: "regcandy-74da6.firebaseapp.com",
  databaseURL: "https://regcandy-74da6-default-rtdb.firebaseio.com",
  projectId: "regcandy-74da6",
  storageBucket: "regcandy-74da6.appspot.com",
  messagingSenderId: "486732872284",
  appId: "1:486732872284:web:9621ddfb253c03ccd98499"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
// –ö–ê–†–¢–û–ß–ö–ò (–æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –º–∞—Å—Å–∏–≤) —Å–ø–∏—Å–æ–∫
const cards=[
  {name:"Regcandy",rarity:"Special",type:"Twitch",image:"cards/Regcandy.png", tgLink:"https://t.me/reghypearchive/2"},
  {name:"DistrsAI",rarity:"Special",type:"Twitch",image:"cards/DistrsAI.png", tgLink:"https://t.me/reghypearchive/3"},
  {name:"Demogorgon",rarity:"Legendary",type:"Moder",image:"cards/Demogorgon.png", tgLink:"https://t.me/reghypearchive/4"},
  {name:"Apelsinka",rarity:"Legendary",type:"Moder",image:"cards/Apelsinka.png", tgLink:"https://t.me/reghypearchive/5"},
  {name:"Freddy Fuzbear",rarity:"Rare",type:"Chaters",image:"cards/Freddy.png", tgLink:"https://t.me/reghypearchive/6"},
  {name:"Bonnie",rarity:"Rare",type:"Chaters",image:"cards/Bonnie.png", tgLink:"https://t.me/reghypearchive/7"},
  {name:"Mark",rarity:"Rare",type:"Chaters",image:"cards/Mark.png", tgLink:"https://t.me/reghypearchive/8"},
  {name:"Anton Fazbear",rarity:"Common",type:"Chaters",image:"cards/Anton.png", tgLink:"https://t.me/reghypearchive/9"},
  {name:"–†–æ–Ω–∏",rarity:"Common",type:"Chaters",image:"cards/Roni.png", tgLink:"https://t.me/reghypearchive/10"},
  {name:"Neatexq",rarity:"Rare",type:"Chaters",image:"cards/Neatexq.png", tgLink:"https://t.me/reghypearchive/11"},
  {name:"Foxy",rarity:"Rare",type:"Chaters",image:"cards/Foxy.png", tgLink:"https://t.me/reghypearchive/12"},
  {name:"Andrew",rarity:"Common",type:"Chaters",image:"cards/Andrew.png", tgLink:"https://t.me/reghypearchive/13"},
  {name:"Che–±—Én–µ–ª—è",rarity:"Common",type:"Chaters",image:"cards/Chebunela.png", tgLink:"https://t.me/reghypearchive/14"},
  {name:"–ê–ª—ç—Ö",rarity:"Rare",type:"Chaters",image:"cards/Alex.png", tgLink:"https://t.me/reghypearchive/15"},
  {name:"Foxy Skin",rarity:"Special",type:"Skin",image:"cards/Foxy-Skin.png", tgLink:"https://t.me/reghypearchive/16"},
  {name:"Demogorgon Skin",rarity:"Special",type:"Skin",image:"cards/Demogorgon-Skin.png", tgLink:"https://t.me/reghypearchive/17"},
  {name:"Freddy Skin",rarity:"Special",type:"Skin",image:"cards/Freddy-Skin.png", tgLink:"https://t.me/reghypearchive/18"},
  {name:"X06R",rarity:"Common",type:"Chaters",image:"cards/X06R.png", tgLink:"https://t.me/reghypearchive/19"},
  {name:"Minion",rarity:"Special",type:"Skin",image:"cards/minion.png"},
  {name:"Bonnie",rarity:"Special",type:"Skin",image:"cards/bonnieskin.png"}

];

// –≠–ö–°–ö–õ–Æ–ó–ò–í–ù–´–ï REGCANDY –ö–ê–†–¢–û–ß–ö–ò (—Ç–æ–ª—å–∫–æ –¥–ª—è Regcandy –ø–∞–∫–∞)
const regcandyCards = [
  {name:"Regcandy & AmNyam",rarity:"Legendary",type:"Skin",image:"cards/regcandy/regcandyamnyam.jpg", exclusive: true},
  {name:"Regcandy & Freddy",rarity:"Special",type:"Skin",image:"cards/regcandy/regcandyfreddy.jpg", exclusive: true},
  {name:"Regcandy & Labubu",rarity:"Special",type:"Skin",image:"cards/regcandy/regcandylabuba.jpg", exclusive: true},
  {name:"Regcandy & Minecraft",rarity:"Special",type:"Skin",image:"cards/regcandy/regcandypickaxe.jpg", exclusive: true},
  {name:"Regcandy & Sailor Moon",rarity:"Special",type:"Skin",image:"cards/regcandy/regcandyseilor.jpg", exclusive: true},
  {name:"Regcandy & Shadow",rarity:"Legendary",type:"Skin",image:"cards/regcandy/regcandyshadow.jpg", exclusive: true},
  {name:"Regcandy & Scorpion",rarity:"Special",type:"Skin",image:"cards/regcandy/regcandyscorpion.jpg", exclusive: true},
  {name:"Regcandy & Chica",rarity:"Special",type:"Skin",image:"cards/regcandy/regcandychica.jpg", exclusive: true},
  {name:"Regcandy & Sonic",rarity:"Legendary",type:"Skin",image:"cards/regcandy/regcandysonic.jpg", exclusive: true},
  {name:"Regcandy & Foxy",rarity:"Special",type:"Skin",image:"cards/regcandy/regcandyfoxy.jpg", exclusive: true},
  {name:"Regcandy & Subzero",rarity:"Special",type:"Skin",image:"cards/regcandy/regcandysubzero.jpg", exclusive: true},
  {name:"Regcandy & Miku",rarity:"Special",type:"Skin",image:"cards/regcandy/regcandymiku.jpg", exclusive: true},
  {name:"Regcandy & Bonnie",rarity:"Special",type:"Skin",image:"cards/regcandy/regcandybonnie.jpg", exclusive: true},
  {name:"Regcandy & Melody", rarity:"Legendary", type:"Skin", image:"cards/regcandy/regcandymelody.jpg", exclusive:true},
  {name:"Regcandy & Kuromi", rarity:"Special", type:"Skin", image:"cards/regcandy/regcandykuromi.jpg", exclusive:true},
  {name:"Regcandy & Hello Kitty", rarity:"Legendary", type:"Skin", image:"cards/regcandy/regcandyhellokitty.jpg", exclusive:true},
  {name:"Regcandy & Player Squid Game", rarity:"Special", type:"Skin", image:"cards/regcandy/regcandyplayersquidgame.jpg", exclusive:true},
  {name:"Regcandy & Doll Squid Game", rarity:"Special", type:"Skin", image:"cards/regcandy/regcandydollsquidgame.jpg", exclusive:true},
  // –î–æ–±–∞–≤–ª—è–µ–º –æ—Å–Ω–æ–≤–Ω—É—é –∫–∞—Ä—Ç–æ—á–∫—É Regcandy –≤ Regcandy –ø–∞–∫ —Ç–æ–∂–µ
  {name:"Regcandy",rarity:"Special",type:"Twitch",image:"cards/Regcandy.png", tgLink:"https://t.me/reghypearchive/2", exclusive: true}
];

const secretCard = {
  name: "Regcandy & Dark Bloom",
  rarity: "Secret",
  type: "Skin",
  image: "cards/secret_regcandy_darkbloom.png" // –ø—É—Ç—å –∫ –∫–∞—Ä—Ç–∏–Ω–∫–µ, –ø–æ–º–µ–Ω—è–π –Ω–∞ —Å–≤–æ–π
};


// —Å–ø–∏—Å–æ–∫ –ø–∞–∫–æ–≤
// –¢—ã –°–ê–ú –≤—ã–±–∏—Ä–∞–µ—à—å –ª—é–±—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –∏ –ª—é–±—ã–µ —à–∞–Ω—Å—ã ‚Äî –ø—Ä—è–º–æ —Ä—É–∫–∞–º–∏!
const packs = [
  {
    id: "common",
    name: "–û–±—ã—á–Ω—ã–π –ø–∞–∫",
    cost: 30,
    drops: [
      { card: cards[7], chance: 20 },       // Andrew  
      { card: cards[8], chance: 20 },       // Andrew    
      { card: cards[11], chance: 20 },       // Andrew  
      { card: cards[12], chance: 20 },       // Andrew  
      { card: cards[17], chance: 20 },       // Andrew  
  ]
  },
  {
    id: "regcandy",
    name: "Regcandy –ø–∞–∫",
    cost: 500,
    drops: [
      { card: regcandyCards[0], chance: 5.26315789474  },
      { card: regcandyCards[1], chance: 5.26315789474  },
      { card: regcandyCards[2], chance: 5.26315789474  },
      { card: regcandyCards[3], chance: 5.26315789474  },
      { card: regcandyCards[4], chance: 5.26315789474  },
      { card: regcandyCards[5], chance: 5.26315789474  },
      { card: regcandyCards[6], chance: 5.26315789474  },
      { card: regcandyCards[7], chance: 5.26315789474  },
      { card: regcandyCards[8], chance: 5.26315789474  },
      { card: regcandyCards[9], chance: 5.26315789474  },
      { card: regcandyCards[10], chance: 5.26315789474  },
      { card: regcandyCards[11], chance: 5.26315789474  },
      { card: regcandyCards[12], chance: 5.26315789474  },
      { card: regcandyCards[13], chance: 5.26315789474  },
      { card: regcandyCards[14], chance: 5.26315789474  },
      { card: regcandyCards[15], chance: 5.26315789474  },
      { card: regcandyCards[16], chance: 5.26315789474  },
      { card: regcandyCards[17], chance: 5.26315789474  },
      { card: regcandyCards[18], chance: 5.26315789474  }
    ]
  },
  {
id: "rare",
    name: "–†–µ–¥–∫–∏–π –ø–∞–∫",
    cost: 75,
    drops: [
      { card: cards[4], chance: 16 },       // Andrew  
      { card: cards[5], chance: 16 },       // Andrew    
      { card: cards[6], chance: 16 },       // Andrew  
      { card: cards[9], chance: 16 },       // Andrew  
      { card: cards[10], chance: 16 },       // Andrew  
      { card: cards[13], chance: 16 },       // Andrew  
  ]
  },
  {
id: "legendary",
    name: "–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π –ø–∞–∫",
    cost: 300,
    drops: [
      { card: cards[2], chance: 50 },       // Andrew  
      { card: cards[3], chance: 50 },       // Andrew    
  ]
  },

];


// –°–õ–£–ß–ê–ô–ù–´–ï –ò–ú–ï–ù–ê –î–õ–Ø –ù–ü–°
const randomNames = [
  "–ö—Ä—É—Ç–æ–π–ò–≥—Ä–æ–∫", "–ú–µ–≥–∞–ì–µ–π–º–µ—Ä", "–õ–µ–≥–µ–Ω–¥–∞–ü–∞–∫–æ–≤", "–ö–∞—Ä—Ç–æ–†—ã—Ü–∞—Ä—å", "–°—É–ø–µ—Ä–ö–æ–ª–ª–µ–∫—Ç–æ—Ä",
  "–ü–∞–∫–æ–ú–∞–Ω", "–ö–∞—Ä—Ç–æ—á–Ω—ã–π–ö–æ—Ä–æ–ª—å", "–ì—Ä–æ–∑–∞–ü–∞–∫–æ–≤", "–ú–∞—Å—Ç–µ—Ä–ö–∞—Ä—Ç", "–õ—É—á—à–∏–π–ò–≥—Ä–æ–∫",
  "–§–∞–Ω—Ç–∞—Å—Ç–∏–∫–ì–µ–π–º–µ—Ä", "–ö—Ä—É—Ç–æ–π–î–∂–æ–∫–µ—Ä", "–ü—Ä–æ—Ñ–∏–ü–∞–∫–µ—Ä", "–ö–æ—Ä–æ–ª–µ–≤—Å–∫–∏–π–ò–≥—Ä–æ–∫", "–£–ª—å—Ç—Ä–∞–ö–æ–ª–ª–µ–∫—Ç–æ—Ä"
];
// –û–±—ä–µ–∫—Ç –ø–µ—Ä–µ–≤–æ–¥–æ–≤
const translations = {
  ru: {
    title: 'Reghype',
    loading: '–ó–∞–≥—Ä—É–∑–∫–∞ Reghype...',
    welcome: '–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Reghype!',
    choose_nickname: '–ü—Ä–∏–¥—É–º–∞–π—Ç–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –Ω–∏–∫–Ω–µ–π–º –¥–ª—è –Ω–∞—á–∞–ª–∞ –∏–≥—Ä—ã:',
    choose_avatar: '–í—ã–±–µ—Ä–∏—Ç–µ –∞–≤–∞—Ç–∞—Ä–∫—É (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):',
    start_game: 'üöÄ –ù–∞—á–∞—Ç—å –∏–≥—Ä—É',
    player: '–ò–≥—Ä–æ–∫',
    currency: 'üí∞ –í–∞–ª—é—Ç–∞: {amount} –º–æ–Ω–µ—Ç',
    free_pack: 'üéÅ –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –ø–∞–∫',
    buy_pack: 'üíé –ö—É–ø–∏—Ç—å –ø–∞–∫ (50 –º–æ–Ω–µ—Ç)',
    timer: '–î–æ –±–µ—Å–ø–ª–∞—Ç–Ω–æ–≥–æ –ø–∞–∫–∞: {time}',
    collection: '–ú–æ—è –∫–æ–ª–ª–µ–∫—Ü–∏—è',
    admin_panel: 'üõ°Ô∏è –ê–î–ú–ò–ù-–ü–ê–ù–ï–õ–¨',
    currency_management: 'üí∞ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∞–ª—é—Ç–æ–π',
    set: '–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å',
    add: '–î–æ–±–∞–≤–∏—Ç—å',
    card_management: 'üÉè –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏',
    choose_card: '–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ä—Ç–æ—á–∫—É...',
    give: '–í—ã–¥–∞—Ç—å',
    give_multiple: '–í—ã–¥–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ',
    player_management: 'üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞–º–∏',
    selected_player: '–í—ã–±—Ä–∞–Ω: ',
    set_currency: '–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–µ–Ω—å–≥–∏',
    give_card: '–í—ã–¥–∞—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É',
    user: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å',
    moder: '–ú–æ–¥–µ—Ä–∞—Ç–æ—Ä',
    admin: '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä',
    banned: '–ó–∞–±–∞–Ω–µ–Ω',
    set_role: '–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ä–æ–ª—å',
    ban_player: '–ó–∞–±–∞–Ω–∏—Ç—å –∏–≥—Ä–æ–∫–∞',
    server_stats: 'üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞',
    total_players: '–í—Å–µ–≥–æ –∏–≥—Ä–æ–∫–æ–≤: ',
    online_players: '–û–Ω–ª–∞–π–Ω –∏–≥—Ä–æ–∫–æ–≤: ',
    total_cards: '–í—Å–µ–≥–æ –∫–∞—Ä—Ç–æ—á–µ–∫: ',
    refresh_stats: '–û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É',
    quick_actions: 'üîß –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è',
    reset_timer: '–°–±—Ä–æ—Å–∏—Ç—å —Ç–∞–π–º–µ—Ä',
    clear_collection: '–û—á–∏—Å—Ç–∏—Ç—å –º–æ–∏ –∫–∞—Ä—Ç–æ—á–∫–∏',
    max_energy: '–ú–∞–∫—Å —ç–Ω–µ—Ä–≥–∏—è',
    give_legendary: '–í—ã–¥–∞—Ç—å –ª–µ–≥–µ–Ω–¥–∞—Ä–∫—É',
    danger_zone: '‚ö†Ô∏è –û–ü–ê–°–ù–ê–Ø –ó–û–ù–ê',
    danger_warning: '–≠—Ç–∏ –¥–µ–π—Å—Ç–≤–∏—è –Ω–µ–æ–±—Ä–∞—Ç–∏–º—ã –∏ –∑–∞—Ç—Ä–∞–≥–∏–≤–∞—é—Ç –í–°–ï–• –∏–≥—Ä–æ–∫–æ–≤!',
    reset_all: 'üîÑ –°–ë–†–û–°–ò–¢–¨ –í–°–ï –ê–ö–ö–ê–£–ù–¢–´',
    clear_data: 'üí• –°–¢–ï–†–ï–¢–¨ –ë–ê–ó–£ –î–ê–ù–ù–´–•',
    maintenance_mode: 'üõë –†–ï–ñ–ò–ú –û–ë–°–õ–£–ñ–ò–í–ê–ù–ò–Ø',
    admin_log: 'üìù –õ–æ–≥ –∞–¥–º–∏–Ω–∞',
    clear_log: '–û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥',
    admin_auth: '–ê–¥–º–∏–Ω –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è',
    login: '‚úÖ –í–æ–π—Ç–∏',
    cancel: '‚ùå –û—Ç–º–µ–Ω–∞',
    rarity: '–†–µ–¥–∫–æ—Å—Ç—å: ',
    type: '–¢–∏–ø: ',
    sell_card: 'üí∞ –ü—Ä–æ–¥–∞—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É',
    profile: 'üë§ –ü—Ä–æ—Ñ–∏–ª—å',
    clicker: 'üñ± –ö–ª–∏–∫–∞–ª–∫–∞',
    packs: 'üéÅ –ü–∞–∫–∏',
    upgrades: 'üî• –£–ª—É—á—à–µ–Ω–∏—è',
    leaderboard: 'üèÜ –¢–æ–ø',
    settings: '‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏',
    change_name_title: '–°–º–µ–Ω–∞ –∏–º–µ–Ω–∏',
    save: '‚úÖ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å',
    coins: '–ú–æ–Ω–µ—Ç',
    cards: '–ö–∞—Ä—Ç–æ—á–µ–∫',
    change_name: '‚úèÔ∏è –°–º–µ–Ω–∏—Ç—å –∏–º—è',
    change_avatar: 'üñºÔ∏è –°–º–µ–Ω–∏—Ç—å –∞–≤–∞—Ç–∞—Ä',
    card_collection: '–ö–æ–ª–ª–µ–∫—Ü–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫',
    back_to_profile: 'üîô –ù–∞–∑–∞–¥ –∫ –º–æ–µ–º—É –ø—Ä–æ—Ñ–∏–ª—é',
    last_online: '–ë—ã–ª –≤ —Å–µ—Ç–∏ –Ω–µ–¥–∞–≤–Ω–æ',
    clicker_description: '–ß–µ—à–∏ –∫–æ–º–∞—Ä—É –∏ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π –º–æ–Ω–µ—Ç–∫–∏!',
    energy: '‚ö° –≠–Ω–µ—Ä–≥–∏—è: {current}/{max}',
    pack_shop: 'üéÅ –ú–∞–≥–∞–∑–∏–Ω –ø–∞–∫–æ–≤',
    common_pack: 'üü¶ –û–±—ã—á–Ω—ã–π –ø–∞–∫ (30 –º–æ–Ω–µ—Ç)',
    rare_pack: 'üü© –†–µ–¥–∫–∏–π –ø–∞–∫ (75 –º–æ–Ω–µ—Ç)',
    legendary_pack: 'üü® –õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π –ø–∞–∫ (300 –º–æ–Ω–µ—Ç)',
    language: '–Ø–∑—ã–∫',
    russian: '–†—É—Å—Å–∫–∏–π',
    english: 'English',
    // –î–æ–±–∞–≤—å—Ç–µ –±–æ–ª—å—à–µ –ø–æ –º–µ—Ä–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
  },
  en: {
    title: 'Reghype',
    loading: 'Loading Reghype...',
    welcome: 'Welcome to Reghype!',
    choose_nickname: 'Come up with a unique nickname to start the game:',
    choose_avatar: 'Choose an avatar (optional):',
    start_game: 'üöÄ Start Game',
    player: 'Player',
    currency: 'üí∞ Currency: {amount} coins',
    free_pack: 'üéÅ Free Pack',
    buy_pack: 'üíé Buy Pack (50 coins)',
    timer: 'Time until free pack: {time}',
    collection: 'My Collection',
    admin_panel: 'üõ°Ô∏è ADMIN PANEL',
    currency_management: 'üí∞ Currency Management',
    set: 'Set',
    add: 'Add',
    card_management: 'üÉè Card Management',
    choose_card: 'Choose a card...',
    give: 'Give',
    give_multiple: 'Give multiple',
    player_management: 'üë• Player Management',
    selected_player: 'Selected: ',
    set_currency: 'Set money',
    give_card: 'Give card',
    user: 'User',
    moder: 'Moderator',
    admin: 'Administrator',
    banned: 'Banned',
    set_role: 'Set role',
    ban_player: 'Ban player',
    server_stats: 'üìä Server Statistics',
    total_players: 'Total players: ',
    online_players: 'Online players: ',
    total_cards: 'Total cards: ',
    refresh_stats: 'Refresh statistics',
    quick_actions: 'üîß Quick Actions',
    reset_timer: 'Reset timer',
    clear_collection: 'Clear my cards',
    max_energy: 'Max energy',
    give_legendary: 'Give legendary',
    danger_zone: '‚ö†Ô∏è DANGER ZONE',
    danger_warning: 'These actions are irreversible and affect ALL players!',
    reset_all: 'üîÑ RESET ALL ACCOUNTS',
    clear_data: 'üí• WIPE DATABASE',
    maintenance_mode: 'üõë MAINTENANCE MODE',
    admin_log: 'üìù Admin Log',
    clear_log: 'Clear log',
    admin_auth: 'Admin Authentication',
    login: '‚úÖ Login',
    cancel: '‚ùå Cancel',
    rarity: 'Rarity: ',
    type: 'Type: ',
    sell_card: 'üí∞ Sell card',
    profile: 'üë§ Profile',
    clicker: 'üñ± Clicker',
    packs: 'üéÅ Packs',
    upgrades: 'üî• Upgrades',
    leaderboard: 'üèÜ Top',
    settings: '‚öôÔ∏è Settings',
    change_name_title: 'Change Name',
    save: '‚úÖ Save',
    coins: 'Coins',
    cards: 'Cards',
    change_name: '‚úèÔ∏è Change Name',
    change_avatar: 'üñºÔ∏è Change Avatar',
    card_collection: 'Card Collection',
    back_to_profile: 'üîô Back to my profile',
    last_online: 'Was online recently',
    clicker_description: 'Scratch the Komaru and earn coins!',
    energy: '‚ö° Energy: {current}/{max}',
    pack_shop: 'üéÅ Pack Shop',
    common_pack: 'üü¶ Common Pack (30 coins)',
    rare_pack: 'üü© Rare Pack (100 coins)',
    legendary_pack: 'üü® Legendary Pack (300 coins)',
    language: 'Language',
    russian: 'Russian',
    english: 'English',
    sound_volume: 'Sound Volume',
    music_volume: 'Music Volume'
    // –î–æ–±–∞–≤—å—Ç–µ –±–æ–ª—å—à–µ –ø–æ –º–µ—Ä–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
  }
};
// –û–°–ù–û–í–ù–û–ô –ú–ï–ù–ï–î–ñ–ï–† –ò–ì–†–´
class GameManager {
  constructor() {
    this.playerId = null;
    this.data = {
      collection: [],
      currency: 100,
      lastFreePack: 0,
      playerName: null,
      playerAvatar: this.getDefaultAvatar(),
      energy: 50,
      lastOnline: Date.now(),
      role: 'user',
      upgrades: {
        cooldownReduction: 0,
        clickMultiplier: 0,
        maxEnergy: 0
      }
    };
 
    this.constants = {
      packCooldown: 4 * 3600 * 1000,
      maxEnergy: 50,
      regenTime: 5000
    };
    // –î–ª—è –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏
    this.adminClickSequence = [];
    this.adminSequence = ['ArrowUp', 'ArrowUp', 'ArrowDown', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'ArrowLeft', 'ArrowRight', 'KeyB', 'KeyA'];
 
    this.isInitialized = false;
    this.leaderboardCache = [];
  }
// –í –∫–ª–∞—Å—Å–µ GameManager –∑–∞–º–µ–Ω–∏—Ç–µ –º–µ—Ç–æ–¥ init –Ω–∞ —ç—Ç–æ—Ç:

async init() {
  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
  const loadingScreen = document.getElementById('loadingScreen');
  if (loadingScreen) loadingScreen.style.display = 'flex';
  try {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø–µ—Ä–≤—ã–π –ª–∏ —ç—Ç–æ –∑–∞–ø—É—Å–∫
    const savedPlayerId = localStorage.getItem('playerId');

    if (!savedPlayerId) {
      // –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫—É
      if (loadingScreen) loadingScreen.style.display = 'none';
      const initialSetup = document.getElementById('initialSetup');
      if (initialSetup) initialSetup.style.display = 'flex';
      this.setupEventListeners();
      return;
    }

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ Firebase
    this.playerId = savedPlayerId;
    const snapshot = await db.ref(`players/${this.playerId}`).once('value');
    if (!snapshot.val()) {
      // –î–∞–Ω–Ω—ã–µ –≤ Firebase –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—É—é –Ω–∞—Å—Ç—Ä–æ–π–∫—É –∑–∞–Ω–æ–≤–æ
      localStorage.clear();
      if (loadingScreen) loadingScreen.style.display = 'none';
      const initialSetup = document.getElementById('initialSetup');
      if (initialSetup) initialSetup.style.display = 'flex';
      this.setupEventListeners();
      return;
    }

    // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–≥—Ä–æ–∫–∞
    await this.loadPlayerData();

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –Ω–∏–∫–Ω–µ–π–º–∞
    if (!this.data.playerName || this.data.playerName.trim() === '' || this.data.playerName === '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∏–≥—Ä–æ–∫' || randomNames.includes(this.data.playerName)) {
      // –ï—Å–ª–∏ –Ω–∏–∫–Ω–µ–π–º–∞ –Ω–µ—Ç –∏–ª–∏ –æ–Ω –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫—É
      if (loadingScreen) loadingScreen.style.display = 'none';
      const initialSetup = document.getElementById('initialSetup');
      if (initialSetup) initialSetup.style.display = 'flex';
      this.setupEventListeners();
      return;
    }

    // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–≥—Ä—É
    this.startGame();

  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', error);
    this.showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö');
    // –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫—É
    if (loadingScreen) loadingScreen.style.display = 'none';
    const initialSetup = document.getElementById('initialSetup');
    if (initialSetup) initialSetup.style.display = 'flex';
    this.setupEventListeners();
  }
}
  cleanup() {
    // –û—á–∏—â–∞–µ–º –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏
    if (this.onlineInterval) {
      clearInterval(this.onlineInterval);
    }
  }
async completeInitialSetup(playerName, avatarDataUrl = null) {
  try {
    const loadingScreen = document.getElementById('loadingScreen');
    if (loadingScreen) loadingScreen.style.display = 'flex';
    const initialSetup = document.getElementById('initialSetup');
    if (initialSetup) initialSetup.style.display = 'none';

    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –∏–≥—Ä–æ–∫–∞
    this.playerId = 'player_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ
    this.data.playerName = playerName;
    if (avatarDataUrl) {
      this.data.playerAvatar = avatarDataUrl;
    }
    this.data.lastOnline = Date.now();

    // === –î–û–ë–ê–í–¨ createdAt –¥–ª—è —Ä–µ–π—Ç–∏–Ω–≥–∞! ===
    this.data.createdAt = Date.now();

    // –í–ê–ñ–ù–û: –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage –î–û –≤—ã–∑–æ–≤–∞ savePlayerData
    localStorage.setItem('playerId', this.playerId);
    localStorage.setItem('playerName', playerName);

    // –ü–æ–º–µ—á–∞–µ–º –∫–∞–∫ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π
    this.isInitialized = true;

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ Firebase
    await this.savePlayerData();

    // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–≥—Ä—É
    this.startGame();

  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è:', error);
    this.showNotification('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è');
  }
}

  startGame() {
    const loadingScreen = document.getElementById('loadingScreen');
    if (loadingScreen) loadingScreen.style.display = 'none';
    const gameContainer = document.getElementById('gameContainer');
    if (gameContainer) gameContainer.style.display = 'block';
 
    this.isInitialized = true;
    this.setupEventListeners();
    this.updateUI();
    this.startTimer();
    this.startEnergyRegen();
    this.startOnlineStatusUpdate();
 
db.ref(`gifts/pending/${gameManager.playerId}`).on('child_added', snapshot => {
  const gift = snapshot.val();
  handleGiftReceived(gift);
});

    // –ó–∞–≥—Ä—É–∂–∞–µ–º –ª–∏–¥–µ—Ä–±–æ—Ä–¥
    this.loadLeaderboard();
 
    console.log('üéÆ Reghype Card Game –∑–∞–≥—Ä—É–∂–µ–Ω!');
    console.log('üÜî ID –∏–≥—Ä–æ–∫–∞:', this.playerId);
    console.log('üë§ –ò–º—è –∏–≥—Ä–æ–∫–∞:', this.data.playerName);
  }
  setupEventListeners() {
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
    document.addEventListener('click', (e) => {
      if (e.target.id === 'cardModal') {
        this.closeCardModal();
      }
    });
    // –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å —á–µ—Ä–µ–∑ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É (Konami Code)
    document.addEventListener('keydown', (e) => {
      this.adminClickSequence.push(e.code);
      if (this.adminClickSequence.length > this.adminSequence.length) {
        this.adminClickSequence.shift();
      }
   
      if (JSON.stringify(this.adminClickSequence) === JSON.stringify(this.adminSequence)) {
        AdminManager.showAuthModal();
        this.adminClickSequence = [];
      }
    });
 
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è Enter –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞ –∏–º–µ–Ω–∏
    const nameInput = document.getElementById('nameInput');
    if (nameInput) {
      nameInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          confirmNameChange();
        }
      });
    }
 
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–≥–æ –≤–≤–æ–¥–∞ –Ω–∏–∫–Ω–µ–π–º–∞
    const initialNameInput = document.getElementById('initialNameInput');
    const characterCounter = document.getElementById('characterCounter');
    const startButton = document.getElementById('startGameButton');
 
    if (initialNameInput && characterCounter && startButton) {
      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤–≤–æ–¥–∞ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
      initialNameInput.addEventListener('input', (e) => {
        const value = e.target.value;
        const length = value.length;
     
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ —Å–∏–º–≤–æ–ª–æ–≤
        characterCounter.textContent = `${length}/12`;
     
        // –ú–µ–Ω—è–µ–º —Ü–≤–µ—Ç –µ—Å–ª–∏ –ø—Ä–∏–±–ª–∏–∂–∞–µ—Ç—Å—è –∫ –ª–∏–º–∏—Ç—É
        if (length >= 10) {
          characterCounter.classList.add('warning');
        } else {
          characterCounter.classList.remove('warning');
        }
     
        // –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–ª—è –∫–Ω–æ–ø–∫–∏
        const isValid = value.trim().length >= 2 && value.trim().length <= 12;
        startButton.disabled = !isValid;
     
        // –í–∏–∑—É–∞–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å
        if (isValid) {
          initialNameInput.style.borderColor = '#00ff99';
        } else if (length > 0) {
          initialNameInput.style.borderColor = '#ff6666';
        } else {
          initialNameInput.style.borderColor = 'transparent';
        }
      });
   
      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ Enter
      initialNameInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter' && !startButton.disabled) {
          completeInitialSetup();
        }
      });
   
      // –§–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –ø—Ä–∏ –ø–æ—è–≤–ª–µ–Ω–∏–∏
      setTimeout(() => {
        const initialSetup = document.getElementById('initialSetup');
        if (initialSetup && initialSetup.style.display === 'flex') {
          initialNameInput.focus();
        }
      }, 500);
   
      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏
      startButton.onclick = () => completeInitialSetup();
    }
 
    // –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞ (–∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É)
    setInterval(() => {
      if (MenuManager.activeMenu === 'leaderboard') {
        this.loadLeaderboard();
      }
    }, 60000);
  }
  async loadPlayerData() {
    try {
      const snapshot = await db.ref(`players/${this.playerId}`).once('value');
      const playerData = snapshot.val();
   
      if (playerData) {
        this.data = { ...this.data, ...playerData };
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∞–ø–≥—Ä–µ–π–¥—ã –µ—Å–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç
        if (!this.data.upgrades) {
          this.data.upgrades = {
            cooldownReduction: 0,
            clickMultiplier: 0,
            maxEnergy: 0
          };
        }
      } else {
        // –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç –≤ Firebase, –∏—Å–ø–æ–ª—å–∑—É–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∫–∞–∫ fallback
        const localData = {
          collection: JSON.parse(localStorage.getItem('collection')) || [],
          currency: parseInt(localStorage.getItem('currency')) || 100,
          lastFreePack: parseInt(localStorage.getItem('lastFreePack')) || 0,
          playerName: localStorage.getItem('playerName'),
          playerAvatar: localStorage.getItem('playerAvatar') || this.getDefaultAvatar(),
          energy: parseInt(localStorage.getItem('energy')) || 50,
          role: localStorage.getItem('role') || 'user',
          upgrades: JSON.parse(localStorage.getItem('upgrades')) || {
            cooldownReduction: 0,
            clickMultiplier: 0,
            maxEnergy: 0
          }
        };
     
        if (localData.playerName) {
          this.data = { ...this.data, ...localData };
          await this.savePlayerData();
        }
      }
      // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞ –±–∞–Ω
      if (this.data.role === 'banned') {
        this.showNotification('–í–∞—à –∞–∫–∫–∞—É–Ω—Ç –∑–∞–±–∞–Ω–µ–Ω!');
        // –ë–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∏–ª–∏ logout
      }
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏–≥—Ä–æ–∫–∞:', error);
    }
  }
async savePlayerData() {
  if (!this.playerId) return;

  try {
    this.data.lastOnline = Date.now();

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ Firebase —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã
    if (this.isInitialized) {
      await db.ref(`players/${this.playerId}`).set(this.data);
    }

    // –í–°–ï–ì–î–ê —Å–æ—Ö—Ä–∞–Ω—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ
    localStorage.setItem('playerId', this.playerId);
    Object.entries(this.data).forEach(([key, value]) => {
      localStorage.setItem(key, typeof value === 'object' ? JSON.stringify(value) : value);
    });

  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö:', error);
    // –ï—Å–ª–∏ Firebase –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, —Ö–æ—Ç—è –±—ã –ª–æ–∫–∞–ª—å–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏–º
    localStorage.setItem('playerId', this.playerId);
    Object.entries(this.data).forEach(([key, value]) => {
      localStorage.setItem(key, typeof value === 'object' ? JSON.stringify(value) : value);
    });
  }
}
  startOnlineStatusUpdate() {
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –æ–Ω–ª–∞–π–Ω –∫–∞–∂–¥—ã–µ 15 —Å–µ–∫—É–Ω–¥
    this.onlineInterval = setInterval(async () => {
      if (this.isInitialized && this.playerId) {
        try {
          await db.ref(`players/${this.playerId}/lastOnline`).set(Date.now());
        } catch (error) {
          console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –æ–Ω–ª–∞–π–Ω:', error);
        }
      }
    }, 15000);
 
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    window.addEventListener('beforeunload', async () => {
      if (this.playerId) {
        try {
          // –ò—Å–ø–æ–ª—å–∑—É–µ–º sendBeacon –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏
          const data = JSON.stringify({
            lastOnline: Date.now() - 60000 // –°—Ç–∞–≤–∏–º –≤—Ä–µ–º—è –Ω–∞ –º–∏–Ω—É—Ç—É –Ω–∞–∑–∞–¥ —á—Ç–æ–±—ã —Å—Ä–∞–∑—É –ø–æ–∫–∞–∑–∞—Ç—å –æ—Ñ–ª–∞–π–Ω
          });
       
          // –ü—ã—Ç–∞–µ–º—Å—è —á–µ—Ä–µ–∑ sendBeacon (–±–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω–æ)
          if (navigator.sendBeacon) {
            navigator.sendBeacon(`https://regcandy-74da6-default-rtdb.firebaseio.com/players/${this.playerId}/lastOnline.json`,
                                 JSON.stringify(Date.now() - 60000));
          }
       
          // –¢–∞–∫–∂–µ —á–µ—Ä–µ–∑ –æ–±—ã—á–Ω—ã–π –∑–∞–ø—Ä–æ—Å –∫–∞–∫ –∑–∞–ø–∞—Å–Ω–æ–π –≤–∞—Ä–∏–∞–Ω—Ç
          await db.ref(`players/${this.playerId}/lastOnline`).set(Date.now() - 60000);
        } catch (error) {
          console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏:', error);
        }
      }
    });
 
    // –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º –ø–æ—Ç–µ—Ä—é —Ñ–æ–∫—É—Å–∞ –æ–∫–Ω–∞ (–ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –¥—Ä—É–≥—É—é –≤–∫–ª–∞–¥–∫—É)
    document.addEventListener('visibilitychange', async () => {
      if (this.playerId) {
        try {
          if (document.hidden) {
            // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ–∫–ª—é—á–∏–ª—Å—è –Ω–∞ –¥—Ä—É–≥—É—é –≤–∫–ª–∞–¥–∫—É - —Å—á–∏—Ç–∞–µ–º –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–º
            await db.ref(`players/${this.playerId}/lastOnline`).set(Date.now() - 30000);
          } else {
            // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–µ—Ä–Ω—É–ª—Å—è - –æ–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
            await db.ref(`players/${this.playerId}/lastOnline`).set(Date.now());
          }
        } catch (error) {
          console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –≤–∏–¥–∏–º–æ—Å—Ç–∏:', error);
        }
      }
    });
 
    // –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    let lastActivity = Date.now();
    const updateActivity = () => {
      lastActivity = Date.now();
    };
 
    document.addEventListener('mousedown', updateActivity);
    document.addEventListener('mousemove', updateActivity);
    document.addEventListener('keydown', updateActivity);
    document.addEventListener('scroll', updateActivity);
    document.addEventListener('touchstart', updateActivity);
 
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
    setInterval(async () => {
      if (this.playerId && this.isInitialized) {
        const inactiveTime = Date.now() - lastActivity;
     
        // –ï—Å–ª–∏ –Ω–µ–∞–∫—Ç–∏–≤–µ–Ω –±–æ–ª–µ–µ 2 –º–∏–Ω—É—Ç, –ø–æ–º–µ—á–∞–µ–º –∫–∞–∫ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ–≥–æ
        if (inactiveTime > 2 * 60 * 1000) {
          try {
            await db.ref(`players/${this.playerId}/lastOnline`).set(Date.now() - inactiveTime);
          } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Å—Ç–∞—Ç—É—Å–∞:', error);
          }
        }
      }
    }, 30000);
  }
// –í –∫–ª–∞—Å—Å–µ GameManager –∑–∞–º–µ–Ω–∏—Ç–µ –º–µ—Ç–æ–¥ loadLeaderboard –Ω–∞ —ç—Ç–æ—Ç:

async loadLeaderboard() {
  try {
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤
    const snapshot = await db.ref('players').once('value');
    const players = snapshot.val();

    // –î–ª—è –ø–æ–∏—Å–∫–∞ index-–∫–∞—Ä—Ç (—É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∏–º–µ–Ω–∞ –≤—Å–µ—Ö –≤–æ–∑–º–æ–∂–Ω—ã—Ö –∫–∞—Ä—Ç)
    const allIndexCards = [...cards, ...regcandyCards, secretCard];
    const indexCardNames = new Set(allIndexCards.map(c => c.name));

    if (players) {
      this.leaderboardCache = Object.entries(players)
        .map(([id, data]) => {
          const collection = data.collection || [];
          const uniqueCardNames = new Set(collection.map(c => c.name));
          // –°—á—ë—Ç—á–∏–∫–∏
          const specialCards = collection.filter(c => c.rarity === 'Special').length;
          const legendaryCards = collection.filter(c => c.rarity === 'Legendary').length;
          const indexCards = [...uniqueCardNames].filter(name => indexCardNames.has(name)).length;

          // –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥ (–º–æ–∂–µ—à—å –∏–∑–º–µ–Ω–∏—Ç—å –≤–µ—Å –∫–∞–∂–¥–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞)
          const score =
            (collection.length * 5) +
            (data.currency || 0) +
            (specialCards * 30) +
            (indexCards * 20) +
            (legendaryCards * 50);

          return {
            id,
            name: data.playerName || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∏–≥—Ä–æ–∫',
            totalCards: collection.length,
            currency: data.currency || 0,
            specialCards,
            legendaryCards,
            indexCards,
            avatar: data.playerAvatar || this.getDefaultAvatar(),
            lastOnline: data.lastOnline || 0,
            role: data.role || 'user',
            isCurrentPlayer: id === this.playerId,
            score
          };
        })
        .filter(player => player.name.trim() !== '' && player.name !== '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∏–≥—Ä–æ–∫')
        .sort((a, b) => {
          // –°–Ω–∞—á–∞–ª–∞ –ø–æ –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–º—É —Ä–µ–π—Ç–∏–Ω–≥—É
          if (b.score !== a.score) return b.score - a.score;
          // –ü–æ—Ç–æ–º –ø–æ totalCards
          if (b.totalCards !== a.totalCards) return b.totalCards - a.totalCards;
          // –ü–æ—Ç–æ–º –ø–æ –º–æ–Ω–µ—Ç–∞–º
          return b.currency - a.currency;
        });
    }

    this.displayLeaderboard();

  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞:', error);
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ö–æ—Ç—è –±—ã —Ç–µ–∫—É—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞
    const collection = this.data.collection || [];
    const specialCards = collection.filter(c => c.rarity === 'Special').length;
    const legendaryCards = collection.filter(c => c.rarity === 'Legendary').length;
    const allIndexCards = [...cards, ...regcandyCards, secretCard];
    const indexCardNames = new Set(allIndexCards.map(c => c.name));
    const uniqueCardNames = new Set(collection.map(c => c.name));
    const indexCards = [...uniqueCardNames].filter(name => indexCardNames.has(name)).length;

    this.leaderboardCache = [{
      id: this.playerId,
      name: this.data.playerName || '–í—ã',
      totalCards: collection.length,
      currency: this.data.currency,
      specialCards,
      legendaryCards,
      indexCards,
      avatar: this.data.playerAvatar,
      lastOnline: Date.now(),
      role: this.data.role,
      isCurrentPlayer: true,
      score: (collection.length * 5) + (this.data.currency || 0) + (specialCards * 30) + (indexCards * 20) + (legendaryCards * 50)
    }];
    this.displayLeaderboard();
  }
}

displayLeaderboard() {
  const content = document.getElementById('leaderboardContent');
  if (!content) return;
  content.innerHTML = this.leaderboardCache.map((player, index) => {
    const rankEmoji = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : 'üéñÔ∏è';
    const isOnline = this.isPlayerOnline(player.lastOnline);
    const lastOnlineText = this.getLastOnlineText(player.lastOnline);
    const roleBadge = player.role === 'admin' ? 'üëë' : player.role === 'moder' ? 'üõ°Ô∏è' : player.role === 'banned' ? 'üö´' : '';
    const avatarHtml = player.avatar && player.avatar !== this.getDefaultAvatar() ?
      `<img src="${player.avatar}" alt="${player.name}" class="leader-avatar">` : '';
    return `
      <div class="leader-item ${player.isCurrentPlayer ? 'current-player' : ''}">
        <div class="leader-rank">${rankEmoji}</div>
        <div class="leader-info">
          <div class="leader-name">
            ${avatarHtml}
            ${index + 1}. ${player.name} ${roleBadge}
            <div class="online-status ${isOnline ? 'online' : 'offline'}" title="${isOnline ? '–í —Å–µ—Ç–∏' : lastOnlineText}"></div>
          </div>
          <div class="leader-stats">
            –ö–∞—Ä—Ç–æ—á–µ–∫: ${player.totalCards} ‚Ä¢ –ú–æ–Ω–µ—Ç: ${player.currency} <br>
            Special: ${player.specialCards} ‚Ä¢ Legendary: ${player.legendaryCards} ‚Ä¢ –ò–Ω–¥–µ–∫—Å: ${player.indexCards}
          </div>
          <div class="last-online">${lastOnlineText}</div>
        </div>
      </div>
    `;
  }).join('');
}


  isPlayerOnline(lastOnline) {
    const now = Date.now();
    const diff = now - lastOnline;
    return diff < 45 * 1000; // –û–Ω–ª–∞–π–Ω –µ—Å–ª–∏ –±—ã–ª –∞–∫—Ç–∏–≤–µ–Ω –º–µ–Ω—å—à–µ 45 —Å–µ–∫—É–Ω–¥ –Ω–∞–∑–∞–¥
  }
  getLastOnlineText(lastOnline) {
    const lang = localStorage.getItem('language') || 'ru';
    const now = Date.now();
    const diff = now - lastOnline;
 
    if (diff < 5 * 60 * 1000) return translations[lang].online || '–í —Å–µ—Ç–∏';
    if (diff < 60 * 60 * 1000) return `${Math.floor(diff / 60000)} ${translations[lang].min_ago || '–º–∏–Ω. –Ω–∞–∑–∞–¥'}`;
    if (diff < 24 * 60 * 60 * 1000) return `${Math.floor(diff / 3600000)} ${translations[lang].hours_ago || '—á. –Ω–∞–∑–∞–¥'}`;
    return `${Math.floor(diff / 86400000)} ${translations[lang].days_ago || '–¥–Ω. –Ω–∞–∑–∞–¥'}`;
  }
  getDefaultAvatar() {
    return "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMzAiIGN5PSIzMCIgcj0iMzAiIGZpbGw9IiNmZmNjMDAiLz4KPGZ0ZXh0IHg9IjMwIiB5PSI0MCIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjI0IiBmaWxsPSIjMDAwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj7wn5CCPC90ZXh0Pgo8L3N2Zz4K";
  }
  getPackCooldown() {
    const baseCooldown = this.constants.packCooldown;
    const reduction = this.data.upgrades.cooldownReduction * 1800000; // 30 –º–∏–Ω –Ω–∞ —É—Ä–æ–≤–µ–Ω—å
    return Math.max(baseCooldown - reduction, 3600000); // –ú–∏–Ω–∏–º—É–º 1 —á–∞—Å
  }
  getClickAmount() {
    return Math.floor(Math.random() * 5) + 1 + this.data.upgrades.clickMultiplier;
  }
  getMaxEnergy() {
    return this.constants.maxEnergy + this.data.upgrades.maxEnergy * 10;
  }
  updateUI() {
    if (!this.isInitialized) return;
 
    const lang = localStorage.getItem('language') || 'ru';
 
    const currency = document.getElementById('currency');
    if (currency) {
      const template = translations[lang].currency || 'üí∞ Currency: {amount} coins';
      currency.textContent = template.replace('{amount}', this.data.currency);
    }
 
    const profileName = document.getElementById('profileName');
    if (profileName) profileName.textContent = this.data.playerName;
 
    const profileNameLarge = document.getElementById('profileNameLarge');
    if (profileNameLarge) profileNameLarge.textContent = this.data.playerName;
 
    const profileCurrency = document.getElementById('profileCurrency');
    if (profileCurrency) profileCurrency.textContent = this.data.currency;
 
    const profileCards = document.getElementById('profileCards');
    if (profileCards) profileCards.textContent = this.data.collection.length;
 
    const energyDisplay = document.getElementById('energyDisplay');
    if (energyDisplay) {
      const template = translations[lang].energy || '‚ö° Energy: {current}/{max}';
      energyDisplay.textContent = template.replace('{current}', this.data.energy).replace('{max}', this.getMaxEnergy());
    }
 
    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–≤–∞—Ç–∞—Ä–æ–≤
    const profileAvatar = document.getElementById('profileAvatar');
    if (profileAvatar) profileAvatar.src = this.data.playerAvatar;
 
    const profileAvatarLarge = document.getElementById('profileAvatarLarge');
    if (profileAvatarLarge) profileAvatarLarge.src = this.data.playerAvatar;
 
    this.displayCollection();
    this.displayProfileCollection();
    if (MenuManager.activeMenu === 'upgrades') {
      UpgradeManager.displayUpgrades();
    }
  }
  displayCollection() {
    const collection = document.getElementById('collection');
    if (!collection) return;
    collection.innerHTML = '';
 
    this.data.collection.forEach((card, index) => {
      const cardDiv = document.createElement('div');
      cardDiv.className = `card rarity-${card.rarity}`;
      cardDiv.innerHTML = `
        <img src="${card.image}" alt="${card.name}" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTUwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDE1MCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxNTAiIGhlaWdodD0iMjAwIiBmaWxsPSIjMzMzIi8+Cjx0ZXh0IHg9Ijc1IiB5PSIxMDAiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxNCIgZmlsbD0iI2ZmZiIgdGV4dC1hbmNob3I9Im1pZGRsZSI+–ö–∞—Ä—Ç–æ—á–∫–∞</text+Cjwvc3ZnPgo='">
        <div>${card.name}</div>
      `;
      cardDiv.addEventListener('click', () => this.showCardModal(card, index));
      collection.appendChild(cardDiv);
    });
  }
  displayProfileCollection() {
    const grid = document.getElementById('profileCollectionGrid');
    if (!grid) return;
    grid.innerHTML = '';
 
    this.data.collection.forEach((card, index) => {
      const cardDiv = document.createElement('div');
      cardDiv.className = `collection-card rarity-${card.rarity}`;
      cardDiv.innerHTML = `<img src="${card.image}" alt="${card.name}" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiBmaWxsPSIjMzMzIi8+Cjx0ZXh0IHg9IjUwIiB5PSI1NSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjEwIiBmaWxsPSIjZmZmIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5–ö–∞—Ä—Ç–∞</text+Cjwvc3ZnPgo='">`;
   
      cardDiv.addEventListener('click', (e) => {
        e.stopPropagation();
        this.showCardModal(card, index);
      });
   
      grid.appendChild(cardDiv);
    });
  }

displayIndex() {
  const indexContent = document.getElementById('indexContent');
  if (!indexContent) return;

  // –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ –æ–±—ã—á–Ω—ã–µ –∏ regcandy –∫–∞—Ä—Ç—ã, —É–±–∏—Ä–∞–µ–º –¥—É–±–ª–∏–∫–∞—Ç—ã –ø–æ –∏–º–µ–Ω–∏
  const allCards = [...cards, ...regcandyCards, secretCard];
  const uniqueCards = allCards.filter(
    (card, idx, arr) => arr.findIndex(c => c.name === card.name) === idx
  );

  // –°–∫—Ä—ã–≤–∞–µ–º —Å–µ–∫—Ä–µ—Ç–Ω—ã–µ –∫–∞—Ä—Ç—ã –∏–∑ –∏–Ω–¥–µ–∫—Å–∞, –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç –≤ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –∏–≥—Ä–æ–∫–∞
  const filteredCards = uniqueCards.filter(card =>
    card.rarity !== "Secret" || this.data.collection.some(c => c.name === card.name)
  );

  // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ —Ä–µ–¥–∫–æ—Å—Ç–∏
  const grouped = {};
  filteredCards.forEach(card => {
    if (!grouped[card.rarity]) grouped[card.rarity] = [];
    grouped[card.rarity].push(card);
  });

  let collectedCount = 0, totalCount = filteredCards.length;

  // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —Ä–µ–¥–∫–æ—Å—Ç–µ–π: Special > Legendary > Rare > Common > –æ—Å—Ç–∞–ª—å–Ω—ã–µ
  const rarityOrder = { Special: 4, Legendary: 3, Rare: 2, Common: 1 };
  const sortedRarities = Object.keys(grouped).sort((a, b) =>
    (rarityOrder[b] || 0) - (rarityOrder[a] || 0)
  );

  indexContent.innerHTML = sortedRarities.map(rarity => {
    const group = grouped[rarity];
    return `
      <div style="margin-bottom:15px;">
        <h3 style="color:#AB47BC;">${rarity}</h3>
        <div style="display:flex;gap:7px;flex-wrap:wrap;">
          ${group.map(card => {
            const owned = this.data.collection.some(c => c.name === card.name);
            if (owned) collectedCount++;
            return `
              <div style="width:74px;text-align:center;">
                <img src="${owned ? card.image : 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNzQiIGhlaWdodD0iMTAwIiB2aWV3Qm94PSIwIDAgNzQgMTAwIiBmaWxsPSIjMzMzMzMzIi8+'}" 
                     style="width:64px;height:80px;${owned ? '' : 'filter:brightness(0.25) grayscale(1);'}border-radius:8px;border:${owned ? '2px solid #AB47BC;' : '2px solid #444;'}">
                <div style="font-size:11px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-top:2px;color:#fff;">
                  ${owned ? card.name : '???'}
                </div>
              </div>
            `;
          }).join('')}
        </div>
      </div>
    `;
  }).join('');

  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –≤—Å–µ–≥–¥–∞ (–∏ –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –±–æ–Ω—É—Å–∞)
  const percent = Math.floor(100 * collectedCount / totalCount);
  const indexBonus = document.getElementById('indexBonus');
  if (indexBonus) {
    if (percent >= 50 && !localStorage.getItem('indexBonusGiven')) {
      this.data.currency += 100; // –±–æ–Ω—É—Å (–ø—Ä–∏–º–µ—Ä)
      this.savePlayerData();
      localStorage.setItem('indexBonusGiven', '1');
      indexBonus.textContent = "–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã —Å–æ–±—Ä–∞–ª–∏ 50% –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –∏ –ø–æ–ª—É—á–∏–ª–∏ –±–æ–Ω—É—Å 100 –º–æ–Ω–µ—Ç!";
    }
    // –í—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å, –¥–∞–∂–µ –µ—Å–ª–∏ –±–æ–Ω—É—Å —É–∂–µ –ø–æ–ª—É—á–µ–Ω
    indexBonus.textContent = `–°–æ–±—Ä–∞–Ω–æ: ${collectedCount}/${totalCount} (${percent}%)`;
  }
}


  async displayOtherPlayerCollection(player) {
    const grid = document.getElementById('otherProfileCollectionGrid');
    if (!grid) return;
    grid.innerHTML = '';
 
    try {
      // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ä–µ–∞–ª—å–Ω—É—é –∫–æ–ª–ª–µ–∫—Ü–∏—é –∏–≥—Ä–æ–∫–∞ –∏–∑ Firebase
      const snapshot = await db.ref(`players/${player.id}/collection`).once('value');
      const playerCards = snapshot.val() || [];
   
      playerCards.forEach((card, index) => {
        const cardDiv = document.createElement('div');
        cardDiv.className = `collection-card rarity-${card.rarity}`;
        cardDiv.innerHTML = `<img src="${card.image}" alt="${card.name}" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiBmaWxsPSIjMzMzIi8+Cjx0ZXh0IHg9IjUwIiB5PSI1NSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjEwIiBmaWxsPSIjZmZmIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5–ö–∞—Ä—Ç–∞</text+Cjwvc3ZnPgo='">`;
     
        // –î–ª—è —á—É–∂–∏—Ö –∫–∞—Ä—Ç–æ—á–µ–∫ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é (–±–µ–∑ –ø—Ä–æ–¥–∞–∂–∏)
        cardDiv.addEventListener('click', (e) => {
          e.stopPropagation();
          this.showCardModal(card, -1, true); // -1 –æ–∑–Ω–∞—á–∞–µ—Ç —á—Ç–æ –∫–∞—Ä—Ç–æ—á–∫–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–æ–¥–∞–Ω–∞
        });
     
        grid.appendChild(cardDiv);
      });
   
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –∏–≥—Ä–æ–∫–∞:', error);
      grid.innerHTML = '<p>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–ª–ª–µ–∫—Ü–∏–∏</p>';
    }
  }
  showCardModal(card, index, isOtherPlayer = false) {
    const lang = localStorage.getItem('language') || 'ru';
    const modal = document.getElementById('cardModal');
    if (!modal) return;
    const modalImage = document.getElementById('modalImage');
    if (modalImage) modalImage.src = card.image;
    const modalName = document.getElementById('modalName');
    if (modalName) modalName.textContent = card.name;
    const modalRarity = document.getElementById('modalRarity');
    if (modalRarity) modalRarity.textContent = `${translations[lang].rarity || 'Rarity:'} ${card.rarity}`;
    const modalType = document.getElementById('modalType');
    if (modalType) modalType.textContent = `${translations[lang].type || 'Type:'} ${card.type}`;
 
const sellBtn = document.getElementById('sellCardBtn');
const price = { Common: 10, Rare: 30, Special: 150, Legendary: 100, Secret: 1500 }[card.rarity] || 10;
if (sellBtn) {
  if (isOtherPlayer || index === -1) {
    sellBtn.style.display = 'none';
  } else {
    sellBtn.style.display = 'block';
    sellBtn.innerText = `üí∞ –ü—Ä–æ–¥–∞—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É (${price} –º–æ–Ω–µ—Ç)`; // <-- –∏–∑–º–µ–Ω–∏—Ç–µ —Ç–µ–∫—Å—Ç
    sellBtn.onclick = () => this.sellCard(index);
  }
}
 
    modal.style.display = 'flex';
  }
  closeCardModal() {
    const modal = document.getElementById('cardModal');
    if (modal) modal.style.display = 'none';
  }
async sellCard(index) {
  const card = this.data.collection[index];
  const prices = { Common: 10, Rare: 30, Special: 150, Legendary: 100, Secret: 1500 };
  const price = prices[card.rarity] || 10;

  this.data.currency += price;
  this.data.collection.splice(index, 1);
  await this.savePlayerData();
  this.updateUI();
  this.closeCardModal();

  this.showNotification(`–ü—Ä–æ–¥–∞–Ω–æ –∑–∞ ${price} –º–æ–Ω–µ—Ç!`);
}

async openPack(packType = 'free') {
  if (packType === 'free') {
    const now = Date.now();
    if (now - this.data.lastFreePack < this.getPackCooldown()) {
      this.showNotification('–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –ø–∞–∫ –µ—â–µ –Ω–µ –≥–æ—Ç–æ–≤!');
      return;
    }
    this.data.lastFreePack = now;
  } else if (packType === 'paid') {
    if (this.data.currency < 50) {
      this.showNotification('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç!');
      return;
    }
    this.data.currency -= 50;

    // –í–æ—Ç —Ç—É—Ç –¥–æ–±–∞–≤—å —à–∞–Ω—Å –Ω–∞ —Å–µ–∫—Ä–µ—Ç–∫—É!
   if (Math.random() < 0.001) { // 0.1%
     this.data.collection.push(secretCard);
     await this.savePlayerData();
     this.displayNewCard(secretCard);
     this.updateUI();
     this.displayIndex(); // –í–ê–ñ–ù–û!
     this.showNotification('–¢—ã –≤—ã–±–∏–ª —Å–µ–∫—Ä–µ—Ç–Ω—É—é –∫–∞—Ä—Ç—É: Regcandy & Dark Bloom!');
     return; // –≤—ã—Ö–æ–¥–∏–º, –æ–±—ã—á–Ω–∞—è –∫–∞—Ä—Ç–∞ –Ω–µ –≤—ã–ø–∞–¥–∞–µ—Ç
   }
  }

  // –û–±—ã—á–Ω–∞—è –≤—ã–¥–∞—á–∞ –∫–∞—Ä—Ç—ã
  const newCard = this.generateRandomCard();
  this.data.collection.push(newCard);
  await this.savePlayerData();
  this.displayNewCard(newCard);
  this.updateUI();
}




generateRandomCard(rarityBonus = 0, isRegcandyPack = false) {
  // –í—ã–±–∏—Ä–∞–µ–º –º–∞—Å—Å–∏–≤ –∫–∞—Ä—Ç–æ—á–µ–∫ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ –ø–∞–∫–∞
  const cardPool = isRegcandyPack ? regcandyCards : cards;
  
  const rarityWeights = {
    Common: 70,
    Rare: 20,
    Legendary: 7,
    Special: 3
  };

  const totalWeight = Object.values(rarityWeights).reduce((a, b) => a + b, 0);
  let random = Math.random() * totalWeight;

  let selectedRarity = 'Common';
  for (const [rarity, weight] of Object.entries(rarityWeights)) {
    random -= weight;
    if (random <= 0) {
      selectedRarity = rarity;
      break;
    }
  }

  const cardsOfRarity = cardPool.filter(card => card.rarity === selectedRarity);
  return cardsOfRarity[Math.floor(Math.random() * cardsOfRarity.length)];
}
  displayNewCard(card) {
    const lastCard = document.getElementById('lastCard');
    if (!lastCard) return;
    lastCard.innerHTML = `
      <div class="card rarity-${card.rarity} animate-card">
        <img src="${card.image}" alt="${card.name}" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTUwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDE1MCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxNTAiIGhlaWdodD0iMjAwIiBmaWxsPSIjMzMzIi8+Cjx0ZXh0IHg9Ijc1IiB5PSIxMDAiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxNCIgZmlsbD0iI2ZmZiIgdGV4dC1hbmNob3I9Im1pZGRsZSI+–ö–∞—Ä—Ç–æ—á–∫–∞</text+Cjwvc3ZnPgo='">
        <div>${card.name}</div>
      </div>
    `;
  }
  startTimer() {
    setInterval(() => {
      const lang = localStorage.getItem('language') || 'ru';
      const now = Date.now();
      const timeLeft = this.getPackCooldown() - (now - this.data.lastFreePack);
   
      const timer = document.getElementById('timer');
      if (!timer) return;
      if (timeLeft <= 0) {
        timer.textContent = translations[lang].pack_ready || '–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –ø–∞–∫ –≥–æ—Ç–æ–≤!';
      } else {
        const hours = Math.floor(timeLeft / 3600000);
        const minutes = Math.floor((timeLeft % 3600000) / 60000);
        const seconds = Math.floor((timeLeft % 60000) / 1000);
        const template = translations[lang].timer || '–î–æ –±–µ—Å–ø–ª–∞—Ç–Ω–æ–≥–æ –ø–∞–∫–∞: {time}';
        timer.textContent = template.replace('{time}', `${hours}:${minutes.toString().padStart(2,'0')}:${seconds.toString().padStart(2,'0')}`);
      }
    }, 1000);
  }
  startEnergyRegen() {
    setInterval(async () => {
      if (this.data.energy < this.getMaxEnergy()) {
        this.data.energy++;
        await this.savePlayerData();
        this.updateUI();
      }
    }, this.constants.regenTime);
  }
  showNotification(text) {
    const notification = document.createElement('div');
    notification.style.cssText = `
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: linear-gradient(45deg, #E91E63, #AB47BC);
      color: #fff;
      padding: 15px 30px;
      border-radius: 10px;
      font-weight: bold;
      z-index: 5000;
      animation: slideDown 0.5s ease-out;
    `;
    notification.textContent = text;
    document.body.appendChild(notification);
 
    setTimeout(() => {
      notification.remove();
    }, 3000);
  }
}


async function buyPackById(packId) {
  const pack = packs.find(p => p.id === packId);
  if (!pack) return gameManager.showNotification('–ü–∞–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω!');
  if (gameManager.data.currency < pack.cost) return gameManager.showNotification('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç!');
  gameManager.data.currency -= pack.cost;

  // –®–∞–Ω—Å –Ω–∞ —Å–µ–∫—Ä–µ—Ç–Ω—É—é –∫–∞—Ä—Ç—É –¥–ª—è regcandy –ø–∞–∫–∞ (0.01%)
  if (packId === "regcandy" && Math.random() < 0.0001) {
    gameManager.data.collection.push(secretCard);
    await gameManager.savePlayerData();
    gameManager.updateUI();
    gameManager.displayNewCard(secretCard);
    showPackOpenModal(secretCard);
    gameManager.showNotification('–¢—ã –≤—ã–±–∏–ª —Å–µ–∫—Ä–µ—Ç–Ω—É—é –∫–∞—Ä—Ç—É: Regcandy & Dark Bloom!');
    return;
  }

  const newCard = getRandomCardFromPack(pack);
  gameManager.data.collection.push(newCard);
  await gameManager.savePlayerData();
  gameManager.updateUI();
  gameManager.displayNewCard(newCard);
  showPackOpenModal(newCard);
}

function showPackOpenModal(card) {
  const modal = document.getElementById('packOpenModal');
  const imgDiv = document.getElementById('packOpenCardImage');
  const nameDiv = document.getElementById('packOpenCardName');
  const descDiv = document.getElementById('packOpenCardDesc');
  if (!modal || !imgDiv || !nameDiv || !descDiv) return;

  imgDiv.innerHTML = `<img src="${card.image}" alt="${card.name}" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTI1IiBoZWlnaHQ9IjE1MCIgdmlld0JveD0iMCAwIDEyNSAxNTAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMjUiIGhlaWdodD0iMTUwIiBmaWxsPSIjMzMzIi8+Cjx0ZXh0IHg9IjYyIiB5PSI3NSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjE2IiBmaWxsPSIjZmZmIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5QYWNrPC90ZXh0Pgo8L3N2Zz4K'">`;
  nameDiv.textContent = `–¢–µ–±–µ –≤—ã–ø–∞–ª–∞: ${card.name}`;
  descDiv.textContent = card.rarity ? `–†–µ–¥–∫–æ—Å—Ç—å: ${card.rarity}` : '';
  modal.style.display = 'flex';
}

function closePackOpenModal() {
  const modal = document.getElementById('packOpenModal');
  if (modal) modal.style.display = 'none';
}

function getRandomCardFromPack(pack) {
  const rand = Math.random() * 100;
  let cumulative = 0;
  for (const drop of pack.drops) {
    cumulative += drop.chance;
    if (rand < cumulative) {
      return { ...drop.card };
    }
  }
  // fallback
  return { ...pack.drops[0].card };
}


// –ê–î–ú–ò–ù –ú–ï–ù–ï–î–ñ–ï–†
class AdminManager {
  static isAuthenticated = false;
  static adminPassword = "admin1337";
  static selectedPlayer = null;
  static searchNameTimer = null;

  // –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
  static showAuthModal() {
    const modal = document.getElementById("adminAuthModal");
    if (modal) modal.style.display = "flex";
    const input = document.getElementById("adminPasswordInput");
    if (input) input.focus();
  }
  static verifyPassword() {
    const input = document.getElementById("adminPasswordInput");
    if (input && input.value === this.adminPassword) {
      this.isAuthenticated = true;
      this.open();
      this.cancelAuth();
      this.log("–ê–¥–º–∏–Ω —É—Å–ø–µ—à–Ω–æ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω", "success");
    } else {
      gameManager.showNotification("–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å!");
    }
  }
  static cancelAuth() {
    const modal = document.getElementById("adminAuthModal");
    if (modal) modal.style.display = "none";
    const input = document.getElementById("adminPasswordInput");
    if (input) input.value = "";
  }
  static open() {
    const panel = document.getElementById("adminPanel");
    if (panel) panel.classList.add("show");
  }
  static close() {
    const panel = document.getElementById("adminPanel");
    if (panel) panel.classList.remove("show");
  }
  static log(msg, type="info") {
    const logDiv = document.getElementById("adminLog");
    if (!logDiv) return;
    const entry = document.createElement("div");
    entry.className = `log-entry ${type}`;
    entry.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
    logDiv.appendChild(entry);
    logDiv.scrollTop = logDiv.scrollHeight;
  }
  static clearLog() {
    const logDiv = document.getElementById("adminLog");
    if (logDiv) logDiv.innerHTML = '<div class="log-entry">–õ–æ–≥ –æ—á–∏—â–µ–Ω...</div>';
  }

  // ===== –ü–û–ò–°–ö –ü–û –ò–ú–ï–ù–ò =====
  static async searchPlayersByName(query) {
    const resultsDiv = document.getElementById('adminPlayerSearchResults');
    if (!query || query.length < 2) {
      if (resultsDiv) resultsDiv.style.display = 'none';
      return;
    }
    const snapshot = await db.ref('players').once('value');
    const players = snapshot.val() || {};
    const results = Object.entries(players)
      .filter(([id, data]) => data.playerName && data.playerName.toLowerCase().includes(query.toLowerCase()))
      .slice(0, 10);

    if (!resultsDiv) return;
    resultsDiv.innerHTML = '';
    results.forEach(([id, data]) => {
      const item = document.createElement('div');
      item.className = 'player-search-item';
      item.textContent = `${data.playerName} (${id})`;
      item.onclick = function() {
        document.getElementById('adminPlayerSearchInput').value = data.playerName;
        resultsDiv.style.display = 'none';
        // –ü–æ–¥—Å—Ç–∞–≤–∏—Ç—å ID –≤–æ –≤—Å–µ id-–ø–æ–ª—è –∞–¥–º–∏–Ω–∫–∏
        const ids = [
          'adminTargetPlayerId1','adminTargetPlayerId2','adminTargetPlayerId3',
          'adminTargetPlayerId4','adminTargetPlayerId5','adminTargetPlayerId6','adminTargetPlayerId7'
        ];
        ids.forEach(fld => {
          const inp = document.getElementById(fld);
          if(inp) inp.value = id;
        });
        AdminManager.log(`–í—ã–±—Ä–∞–Ω –∏–≥—Ä–æ–∫: ${data.playerName} (${id})`, "info");
      };
      resultsDiv.appendChild(item);
    });
    resultsDiv.style.display = results.length ? 'block' : 'none';
  }

  // –ö–æ–ª–ª–µ–∫—Ü–∏–∏ –∏–≥—Ä–æ–∫–æ–≤
  static async giveCardToPlayer() {
    const pid = document.getElementById("adminTargetPlayerId1").value.trim();
    const cardSel = document.getElementById("adminCardToGive");
    if (!pid || !cardSel.value) return this.log("–£–∫–∞–∂–∏—Ç–µ ID –∏ –∫–∞—Ä—Ç—É", "error");
    let card = [...cards, ...regcandyCards, secretCard].find(c => c.name === cardSel.value);
    if (!card) return this.log("–ù–µ—Ç —Ç–∞–∫–æ–π –∫–∞—Ä—Ç—ã", "error");
    const snap = await db.ref(`players/${pid}/collection`).once("value");
    const arr = snap.val() || [];
    arr.push(card);
    await db.ref(`players/${pid}/collection`).set(arr);
    this.log(`–ö–∞—Ä—Ç–æ—á–∫–∞ ${card.name} –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∏–≥—Ä–æ–∫—É ${pid}`, "success");
  }
  static async removeCardFromPlayer() {
    const pid = document.getElementById("adminTargetPlayerId1").value.trim();
    const cardSel = document.getElementById("adminCardToGive");
    if (!pid || !cardSel.value) return this.log("–£–∫–∞–∂–∏—Ç–µ ID –∏ –∫–∞—Ä—Ç—É", "error");
    const snap = await db.ref(`players/${pid}/collection`).once("value");
    let arr = snap.val() || [];
    arr = arr.filter(c => c.name !== cardSel.value);
    await db.ref(`players/${pid}/collection`).set(arr);
    this.log(`–£–¥–∞–ª–µ–Ω–∞ –∫–∞—Ä—Ç–∞ ${cardSel.value} —É –∏–≥—Ä–æ–∫–∞ ${pid}`, "success");
  }
  static async clearPlayerCollection() {
    const pid = document.getElementById("adminTargetPlayerId2").value.trim();
    if (!pid) return this.log("–£–∫–∞–∂–∏—Ç–µ ID", "error");
    await db.ref(`players/${pid}/collection`).set([]);
    this.log(`–ö–æ–ª–ª–µ–∫—Ü–∏—è –æ—á–∏—â–µ–Ω–∞ —É –∏–≥—Ä–æ–∫–∞ ${pid}`, "warning");
  }
  static async giveFullCollection() {
    const pid = document.getElementById("adminTargetPlayerId2").value.trim();
    if (!pid) return this.log("–£–∫–∞–∂–∏—Ç–µ ID", "error");
    const all = [...cards, ...regcandyCards, secretCard];
    await db.ref(`players/${pid}/collection`).set(all);
    this.log(`–í—ã–¥–∞–Ω–∞ –ø–æ–ª–Ω–∞—è –∫–æ–ª–ª–µ–∫—Ü–∏—è –∏–≥—Ä–æ–∫—É ${pid}`, "success");
  }

  // –í–∞–ª—é—Ç–∞ –∏–≥—Ä–æ–∫–æ–≤
  static async setPlayerCurrency() {
    const pid = document.getElementById("adminTargetPlayerId3").value.trim();
    const amount = parseInt(document.getElementById("adminCurrencyAmount").value);
    if (!pid || isNaN(amount)) return this.log("–£–∫–∞–∂–∏—Ç–µ ID –∏ —Å—É–º–º—É", "error");
    await db.ref(`players/${pid}/currency`).set(amount);
    this.log(`–í–∞–ª—é—Ç–∞ –∏–≥—Ä–æ–∫–∞ ${pid} —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞: ${amount}`, "success");
  }
  static async addPlayerCurrency() {
    const pid = document.getElementById("adminTargetPlayerId3").value.trim();
    const amount = parseInt(document.getElementById("adminCurrencyAmount").value);
    if (!pid || isNaN(amount)) return this.log("–£–∫–∞–∂–∏—Ç–µ ID –∏ —Å—É–º–º—É", "error");
    const snap = await db.ref(`players/${pid}/currency`).once("value");
    const old = snap.val() || 0;
    await db.ref(`players/${pid}/currency`).set(old + amount);
    this.log(`–î–æ–±–∞–≤–ª–µ–Ω–æ ${amount} –≤–∞–ª—é—Ç—ã –∏–≥—Ä–æ–∫—É ${pid}`, "success");
  }
  static async subtractPlayerCurrency() {
    const pid = document.getElementById("adminTargetPlayerId3").value.trim();
    const amount = parseInt(document.getElementById("adminCurrencyAmount").value);
    if (!pid || isNaN(amount)) return this.log("–£–∫–∞–∂–∏—Ç–µ ID –∏ —Å—É–º–º—É", "error");
    const snap = await db.ref(`players/${pid}/currency`).once("value");
    const old = snap.val() || 0;
    await db.ref(`players/${pid}/currency`).set(Math.max(0, old - amount));
    this.log(`–û—Ç–Ω—è—Ç–æ ${amount} –≤–∞–ª—é—Ç—ã —É –∏–≥—Ä–æ–∫–∞ ${pid}`, "success");
  }
  static async makePlayerMillionaire() {
    const pid = document.getElementById("adminTargetPlayerId3").value.trim();
    if (!pid) return this.log("–£–∫–∞–∂–∏—Ç–µ ID", "error");
    await db.ref(`players/${pid}/currency`).set(1000000);
    this.log(`–ò–≥—Ä–æ–∫ ${pid} —Å—Ç–∞–ª –º–∏–ª–ª–∏–æ–Ω–µ—Ä–æ–º!`, "success");
  }

  // –ò–≥—Ä–æ–∫–∏
  static async changePlayerName() {
    const pid = document.getElementById("adminTargetPlayerId4").value.trim();
    const newName = document.getElementById("adminNewPlayerName").value.trim();
    if (!pid || !newName) return this.log("–£–∫–∞–∂–∏—Ç–µ ID –∏ –Ω–æ–≤—ã–π –Ω–∏–∫", "error");
    await db.ref(`players/${pid}/playerName`).set(newName);
    this.log(`–ò–º—è –∏–≥—Ä–æ–∫–∞ ${pid} –∏–∑–º–µ–Ω–µ–Ω–æ –Ω–∞ ${newName}`, "success");
  }
  static async changePlayerAvatar() {
    const pid = document.getElementById("adminTargetPlayerId4").value.trim();
    const newAvatar = document.getElementById("adminNewPlayerAvatar").value.trim();
    if (!pid || !newAvatar) return this.log("–£–∫–∞–∂–∏—Ç–µ ID –∏ —Å—Å—ã–ª–∫—É –Ω–∞ –∞–≤–∞—Ç–∞—Ä", "error");
    await db.ref(`players/${pid}/playerAvatar`).set(newAvatar);
    this.log(`–ê–≤–∞—Ç–∞—Ä –∏–≥—Ä–æ–∫–∞ ${pid} –∏–∑–º–µ–Ω—ë–Ω`, "success");
  }
  static async banPlayer() {
    const pid = document.getElementById("adminTargetPlayerId4").value.trim();
    if (!pid) return this.log("–£–∫–∞–∂–∏—Ç–µ ID", "error");
    await db.ref(`players/${pid}/role`).set("banned");
    this.log(`–ò–≥—Ä–æ–∫ ${pid} –∑–∞–±–∞–Ω–µ–Ω`, "warning");
  }
  static async unbanPlayer() {
    const pid = document.getElementById("adminTargetPlayerId4").value.trim();
    if (!pid) return this.log("–£–∫–∞–∂–∏—Ç–µ ID", "error");
    await db.ref(`players/${pid}/role`).set("user");
    this.log(`–ò–≥—Ä–æ–∫ ${pid} —Ä–∞–∑–±–∞–Ω–µ–Ω`, "success");
  }
  static async resetPlayer() {
    const pid = document.getElementById("adminTargetPlayerId4").value.trim();
    if (!pid) return this.log("–£–∫–∞–∂–∏—Ç–µ ID", "error");
    await db.ref(`players/${pid}`).set({
      playerName: "–°–±—Ä–æ—à–µ–Ω–Ω—ã–π –∏–≥—Ä–æ–∫",
      playerAvatar: gameManager.getDefaultAvatar(),
      collection: [],
      currency: 100,
      lastFreePack: 0,
      energy: 50,
      lastOnline: Date.now(),
      role: "user",
      upgrades: { cooldownReduction: 0, clickMultiplier: 0, maxEnergy: 0 }
    });
    this.log(`–ê–∫–∫–∞—É–Ω—Ç –∏–≥—Ä–æ–∫–∞ ${pid} —Å–±—Ä–æ—à–µ–Ω`, "warning");
  }
  static async deletePlayer() {
    const pid = document.getElementById("adminTargetPlayerId4").value.trim();
    if (!pid) return this.log("–£–∫–∞–∂–∏—Ç–µ ID", "error");
    await db.ref(`players/${pid}`).remove();
    this.log(`–ê–∫–∫–∞—É–Ω—Ç –∏–≥—Ä–æ–∫–∞ ${pid} —É–¥–∞–ª—ë–Ω`, "danger");
  }

  // –®–∞–Ω—Å—ã –≤—ã–ø–∞–¥–µ–Ω–∏—è –∫–∞—Ä—Ç (–∑–∞–≥–ª—É—à–∫–∞)
  static async setRarityChances() {
    this.log("–®–∞–Ω—Å—ã –≤—ã–ø–∞–¥–µ–Ω–∏—è –∫–∞—Ä—Ç –∏–∑–º–µ–Ω–µ–Ω—ã (–¥–µ–º–æ)", "success");
  }

  // –ê–ø–≥—Ä–µ–π–¥—ã –∏–≥—Ä–æ–∫–æ–≤
  static async setPlayerUpgrade() {
    const pid = document.getElementById("adminTargetPlayerId6").value.trim();
    const type = document.getElementById("adminUpgradeType").value;
    let level = parseInt(document.getElementById("adminUpgradeLevel").value);
    if (!pid || !type || isNaN(level)) return this.log("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è", "error");
    if (level < 0) level = 0;
    if (level > 10) level = 10;
    const upgradesRef = db.ref(`players/${pid}/upgrades`);
    const snap = await upgradesRef.once("value");
    const upgrades = snap.val() || { cooldownReduction: 0, clickMultiplier: 0, maxEnergy: 0 };
    upgrades[type] = level;
    await upgradesRef.set(upgrades);
    this.log(`–ê–ø–≥—Ä–µ–π–¥ ${type} –∏–≥—Ä–æ–∫–∞ ${pid} —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –Ω–∞ ${level}`, "success");
  }
  static async maxAllUpgrades() {
    const pid = document.getElementById("adminTargetPlayerId6").value.trim();
    if (!pid) return this.log("–£–∫–∞–∂–∏—Ç–µ ID", "error");
    await db.ref(`players/${pid}/upgrades`).set({ cooldownReduction: 5, clickMultiplier: 10, maxEnergy: 5 });
    this.log(`–í—Å–µ –∞–ø–≥—Ä–µ–π–¥—ã –∏–≥—Ä–æ–∫–∞ ${pid} –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã`, "success");
  }
  static async resetAllUpgrades() {
    const pid = document.getElementById("adminTargetPlayerId6").value.trim();
    if (!pid) return this.log("–£–∫–∞–∂–∏—Ç–µ ID", "error");
    await db.ref(`players/${pid}/upgrades`).set({ cooldownReduction: 0, clickMultiplier: 0, maxEnergy: 0 });
    this.log(`–ê–ø–≥—Ä–µ–π–¥—ã –∏–≥—Ä–æ–∫–∞ ${pid} —Å–±—Ä–æ—à–µ–Ω—ã`, "warning");
  }

  // –ú–∞—Å—Å–æ–≤—ã–µ –¥–µ–π—Å—Ç–≤–∏—è (–∑–∞–≥–ª—É—à–∫–∏)
  static async notifyAllPlayers() {
    const text = document.getElementById("adminNotificationText").value.trim();
    if (!text) return this.log("–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è", "error");
    // TODO: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–∞—Å—Å–æ–≤—É—é —Ä–∞—Å—Å—ã–ª–∫—É
    this.log(`–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤—Å–µ–º: ${text}`, "success");
  }
  static async giveGiftToAll() {
    // TODO: —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–∞—Å—Å–æ–≤—É—é —Ä–∞–∑–¥–∞—á—É –ø–æ–¥–∞—Ä–∫–æ–≤
    this.log("–ü–æ–¥–∞—Ä–æ–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤—Å–µ–º –æ–Ω–ª–∞–π–Ω", "success");
  }

  // –ö–æ–Ω—Ç—Ä–æ–ª—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (–ø—Ä–∏–º–µ—Ä)
  static async showPlayerStats() {
    const pid = document.getElementById("adminTargetPlayerId7").value.trim();
    if (!pid) return this.log("–£–∫–∞–∂–∏—Ç–µ ID", "error");
    const snap = await db.ref(`players/${pid}`).once("value");
    const data = snap.val();
    if (data) {
      alert(JSON.stringify(data, null, 2));
      this.log("–ü–æ–∫–∞–∑–∞–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–≥—Ä–æ–∫–∞ " + pid, "info");
    } else {
      this.log("–ò–≥—Ä–æ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω", "error");
    }
  }
  static async showPlayerLog() {
    // TODO: —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–∞ –∏–≥—Ä–æ–∫–∞
    this.log("–õ–æ–≥ –∏–≥—Ä–æ–∫–∞ –æ—Ç–æ–±—Ä–∞–∂—ë–Ω (–∑–∞–≥–ª—É—à–∫–∞)", "info");
  }

  // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞
  static async refreshStats() {
    try {
      const snapshot = await db.ref("players").once("value");
      const players = snapshot.val() || {};
      const playerCount = Object.keys(players).length;
      const onlineCount = Object.values(players)
        .filter(player => gameManager.isPlayerOnline(player.lastOnline || 0)).length;
      const totalCards = Object.values(players)
        .reduce((sum, player) => sum + (player.collection?.length || 0), 0);
      const totalPlayers = document.getElementById("totalPlayers");
      if (totalPlayers) totalPlayers.textContent = playerCount;
      const onlinePlayers = document.getElementById("onlinePlayers");
      if (onlinePlayers) onlinePlayers.textContent = onlineCount;
      const totalCardsElem = document.getElementById("totalCards");
      if (totalCardsElem) totalCardsElem.textContent = totalCards;
      this.log("–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞", "info");
    } catch (error) {
      this.log(`–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏: ${error.message}`, "error");
    }
  }

  // –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è (—Ä–∞–±–æ—Ç–∞—é—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–µ–±—è)
  static async resetTimer() {
    try {
      gameManager.data.lastFreePack = 0;
      await gameManager.savePlayerData();
      this.log("–¢–∞–π–º–µ—Ä —Å–±—Ä–æ—à–µ–Ω", "success");
    } catch (error) {
      this.log(`–û—à–∏–±–∫–∞ —Å–±—Ä–æ—Å–∞ —Ç–∞–π–º–µ—Ä–∞: ${error.message}`, "error");
    }
  }
  static async clearCollection() {
    try {
      gameManager.data.collection = [];
      await gameManager.savePlayerData();
      gameManager.updateUI();
      this.log("–ö–æ–ª–ª–µ–∫—Ü–∏—è –æ—á–∏—â–µ–Ω–∞!", "warning");
      gameManager.showNotification("–ö–æ–ª–ª–µ–∫—Ü–∏—è –æ—á–∏—â–µ–Ω–∞!");
    } catch (error) {
      this.log(`–û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –∫–æ–ª–ª–µ–∫—Ü–∏–∏: ${error.message}`, "error");
    }
  }
  static async maxEnergy() {
    try {
      gameManager.data.energy = gameManager.getMaxEnergy();
      await gameManager.savePlayerData();
      gameManager.updateUI();
      this.log("–≠–Ω–µ—Ä–≥–∏—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –Ω–∞ –º–∞–∫—Å–∏–º—É–º", "success");
    } catch (error) {
      this.log(`–û—à–∏–±–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –º–∞–∫—Å —ç–Ω–µ—Ä–≥–∏–∏: ${error.message}`, "error");
    }
  }
  static async giveRandomLegendary() {
    try {
      const legendaryCards = cards.filter(card => card.rarity === "Legendary");
      if (legendaryCards.length === 0) {
        this.log("–ù–µ—Ç –ª–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã—Ö –∫–∞—Ä—Ç–æ—á–µ–∫", "error");
        return;
      }
      const randomCard = legendaryCards[Math.floor(Math.random() * legendaryCards.length)];
      gameManager.data.collection.push(randomCard);
      await gameManager.savePlayerData();
      gameManager.updateUI();
      this.log(`–í—ã–¥–∞–Ω–∞ —Å–ª—É—á–∞–π–Ω–∞—è –ª–µ–≥–µ–Ω–¥–∞—Ä–∫–∞: ${randomCard.name}`, "success");
    } catch (error) {
      this.log(`–û—à–∏–±–∫–∞ –≤—ã–¥–∞—á–∏ –ª–µ–≥–µ–Ω–¥–∞—Ä–∫–∏: ${error.message}`, "error");
    }
  }
  static async resetGiftTimer() {
    try {
      gameManager.data.lastGiftTimestamp = 0;
      await gameManager.savePlayerData();
      this.log("–¢–∞–π–º–µ—Ä –ø–æ–¥–∞—Ä–∫–∞ —Å–±—Ä–æ—à–µ–Ω", "success");
      gameManager.showNotification("–¢–∞–π–º–µ—Ä –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–æ–¥–∞—Ä–∫–∞ —Å–±—Ä–æ—à–µ–Ω!");
    } catch (error) {
      this.log(`–û—à–∏–±–∫–∞ —Å–±—Ä–æ—Å–∞ —Ç–∞–π–º–µ—Ä–∞ –ø–æ–¥–∞—Ä–∫–∞: ${error.message}`, "error");
    }
  }

  // –û–ø–∞—Å–Ω–∞—è –∑–æ–Ω–∞
  static async resetAllPlayers() {
    if (!confirm("‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï: –≠—Ç–æ —Å–±—Ä–æ—Å–∏—Ç –í–°–ï –∞–∫–∫–∞—É–Ω—Ç—ã –∏–≥—Ä–æ–∫–æ–≤! –í—ã –∞–±—Å–æ–ª—é—Ç–Ω–æ —É–≤–µ—Ä–µ–Ω—ã?")) {
      return;
    }
    if (!confirm("–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å! –í–≤–µ–¥–∏—Ç–µ 'RESET' –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è:")) {
      return;
    }
    const confirmation = prompt("–í–≤–µ–¥–∏—Ç–µ 'RESET ALL PLAYERS' –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ–ø–∞—Å–Ω–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è:");
    if (confirmation !== "RESET ALL PLAYERS") {
      this.log("–°–±—Ä–æ—Å –æ—Ç–º–µ–Ω–µ–Ω - –Ω–µ–≤–µ—Ä–Ω–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ", "warning");
      return;
    }
    try {
      const snapshot = await db.ref("players").once("value");
      const players = snapshot.val() || {};
      const resetPromises = Object.keys(players).map(playerId =>
        db.ref(`players/${playerId}`).set({
          playerName: players[playerId].playerName || "–°–±—Ä–æ—Å –ò–≥—Ä–æ–∫–∞",
          playerAvatar: gameManager.getDefaultAvatar(),
          collection: [],
          currency: 100,
          lastFreePack: 0,
          energy: 50,
          lastOnline: Date.now(),
          role: "user",
          upgrades: { cooldownReduction: 0, clickMultiplier: 0, maxEnergy: 0 }
        })
      );
      await Promise.all(resetPromises);
      this.log("üîÑ –í–°–ï –ê–ö–ö–ê–£–ù–¢–´ –ò–ì–†–û–ö–û–í –°–ë–†–û–®–ï–ù–´", "warning");
      await gameManager.loadPlayerData();
      gameManager.updateUI();
    } catch (error) {
      this.log(`–û—à–∏–±–∫–∞ —Å–±—Ä–æ—Å–∞ –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤: ${error.message}`, "error");
    }
  }
  static async clearAllData() {
    if (!confirm("üí• –≠–ö–°–¢–†–ï–ú–ê–õ–¨–ù–û–ï –ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–ï: –≠—Ç–æ –£–î–ê–õ–ò–¢ –í–°–ï –î–ê–ù–ù–´–ï –∏–∑ –±–∞–∑—ã!")) {
      return;
    }
    const confirmation = prompt("–í–≤–µ–¥–∏—Ç–µ 'DELETE EVERYTHING' –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–æ–ª–Ω–æ–≥–æ —Å—Ç–∏—Ä–∞–Ω–∏—è –±–∞–∑—ã:");
    if (confirmation !== "DELETE EVERYTHING") {
      this.log("–°—Ç–∏—Ä–∞–Ω–∏–µ –±–∞–∑—ã –æ—Ç–º–µ–Ω–µ–Ω–æ", "warning");
      return;
    }
    try {
      await db.ref("players").remove();
      this.log("üí• –ë–ê–ó–ê –î–ê–ù–ù–´–• –°–¢–Å–†–¢–ê - –í–°–ï –î–ê–ù–ù–´–ï –£–î–ê–õ–ï–ù–´", "danger");
      setTimeout(() => location.reload(), 2000);
    } catch (error) {
      this.log(`–û—à–∏–±–∫–∞ —Å—Ç–∏—Ä–∞–Ω–∏—è –±–∞–∑—ã: ${error.message}`, "error");
    }
  }
  static shutdownServer() {
    this.log("üõë –†–ï–ñ–ò–ú –û–ë–°–õ–£–ñ–ò–í–ê–ù–ò–Ø –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω", "warning");
    alert("üõë –°–µ—Ä–≤–µ—Ä –≤—Ö–æ–¥–∏—Ç –≤ —Ä–µ–∂–∏–º –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è...");
    document.body.style.pointerEvents = "none";
    document.body.style.opacity = "0.5";
    const overlay = document.createElement("div");
    overlay.style.cssText = `
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(255, 0, 0, 0.8);
      display: flex; justify-content: center; align-items: center;
      color: white; font-size: 24px; font-family: 'Orbitron', sans-serif;
      z-index: 99999; text-align: center;
    `;
    overlay.innerHTML = "üõë<br>–†–ï–ñ–ò–ú –û–ë–°–õ–£–ñ–ò–í–ê–ù–ò–Ø<br><small>–°–µ—Ä–≤–µ—Ä –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω</small>";
    document.body.appendChild(overlay);
  }

  // –£–¥–∞–ª–∏—Ç—å —Å–≤–æ–π –∞–∫–∫–∞—É–Ω—Ç
  static async deleteSelf() {
    try {
      const pid = gameManager.playerId;
      await db.ref(`players/${pid}`).remove();
      localStorage.clear();
      document.getElementById("deleteSelfStatus").textContent = "–í–∞—à –∞–∫–∫–∞—É–Ω—Ç —É–¥–∞–ª—ë–Ω!";
      setTimeout(() => location.reload(), 2000);
    } catch (e) {
      document.getElementById("deleteSelfStatus").textContent = "–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è: " + e.message;
    }
  }
}

// –ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–µ–ª–µ–∫—Ç–æ—Ä–∞ –∫–∞—Ä—Ç –¥–ª—è –∞–¥–º–∏–Ω–∫–∏
function populateAdminCardSelect() {
  const sel = document.getElementById("adminCardToGive");
  if (!sel) return;
  sel.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ä—Ç—É...</option>';
  [...cards, ...regcandyCards, secretCard].forEach(card => {
    const opt = document.createElement("option");
    opt.value = card.name;
    opt.textContent = `${card.name} (${card.rarity})`;
    sel.appendChild(opt);
  });
}
document.addEventListener("DOMContentLoaded", () => {
  populateAdminCardSelect();

  // –ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏
  const searchInput = document.getElementById('adminPlayerSearchInput');
  if (searchInput) {
    searchInput.addEventListener('input', function() {
      clearTimeout(AdminManager.searchNameTimer);
      const query = searchInput.value.trim();
      AdminManager.searchNameTimer = setTimeout(() => {
        AdminManager.searchPlayersByName(query);
      }, 250);
    });
    document.addEventListener('click', function(e){
      const resultsDiv = document.getElementById('adminPlayerSearchResults');
      if (!resultsDiv) return;
      if (!resultsDiv.contains(e.target) && e.target !== searchInput) {
        resultsDiv.style.display = 'none';
      }
    });
  }
});

// –ú–ï–ù–ï–î–ñ–ï–† –ú–ï–ù–Æ
class MenuManager {
  static activeMenu = null;
  static toggle(menuType) {
    if (this.activeMenu === menuType) {
      this.close(menuType);
    } else {
      this.closeAll();
      this.open(menuType);
    }
  }
static open(menuType) {
  const modal = document.getElementById(`${menuType}Modal`);
  if (modal) {
    // –°–∫—Ä—ã—Ç—å –∫–Ω–æ–ø–∫—É –ø–æ–¥–∞—Ä–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –ª—é–±–æ–≥–æ –º–µ–Ω—é
    const giftBtn = document.getElementById('giftOpenBtn');
    if (giftBtn) giftBtn.style.display = 'none';

    modal.style.display = 'block';
    this.activeMenu = menuType;

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–π –∫–Ω–æ–ø–∫–∏
    document.querySelectorAll('#navbar button').forEach(btn => btn.classList.remove('active'));
    const btn = document.querySelector(`#navbar button[onclick*="${menuType}"]`);
    if (btn) btn.classList.add('active');

    // –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –º–µ–Ω—é
    if (menuType === 'index') {
      gameManager.displayIndex();
    }
    if (menuType === 'profile') {
      gameManager.displayProfileCollection();
      showCurrentProfile();
    } else if (menuType === 'leaderboard') {
      gameManager.loadLeaderboard();
    } else if (menuType === 'upgrades') {
      UpgradeManager.displayUpgrades();
    }
  }
}
static close(menuType) {
  const modal = document.getElementById(`${menuType}Modal`);
  if (modal) {
    modal.style.display = 'none';
    this.activeMenu = null;

    // –ï—Å–ª–∏ –Ω–µ –æ—Å—Ç–∞–ª–æ—Å—å –Ω–∏ –æ–¥–Ω–æ–≥–æ –æ—Ç–∫—Ä—ã—Ç–æ–≥–æ –º–µ–Ω—é ‚Äî –≤–µ—Ä–Ω—É—Ç—å –∫–Ω–æ–ø–∫—É –ø–æ–¥–∞—Ä–∫–∞
    const anyOpen = Array.from(document.querySelectorAll('.menu-modal')).some(m => m.style.display === 'block');
    const giftBtn = document.getElementById('giftOpenBtn');
    if (!anyOpen && giftBtn) giftBtn.style.display = 'flex';

    // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É
    document.querySelectorAll('#navbar button').forEach(btn => btn.classList.remove('active'));
  }
}
static closeAll() {
  document.querySelectorAll('.menu-modal').forEach(modal => {
    modal.style.display = 'none';
  });
  document.querySelectorAll('#navbar button').forEach(btn => btn.classList.remove('active'));
  this.activeMenu = null;

  // –í—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∑–∞—Ç—å –∫–Ω–æ–ø–∫—É –ø–æ–¥–∞—Ä–∫–∞, –∫–æ–≥–¥–∞ –≤—Å–µ –º–µ–Ω—é –∑–∞–∫—Ä—ã—Ç—ã
  const giftBtn = document.getElementById('giftOpenBtn');
  if (giftBtn) giftBtn.style.display = 'flex';
 }
}

// –ú–ï–ù–ï–î–ñ–ï–† –£–õ–£–ß–®–ï–ù–ò–ô
class UpgradeManager {
  static upgrades = [
    {
      id: 'cooldownReduction',
      title: '–°–æ–∫—Ä–∞—â–µ–Ω–∏–µ –∫—É–ª–¥–∞—É–Ω–∞',
      description: '–£–º–µ–Ω—å—à–∞–µ—Ç –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –±–µ—Å–ø–ª–∞—Ç–Ω–æ–≥–æ –ø–∞–∫–∞ –Ω–∞ 30 –º–∏–Ω',
      baseCost: 100,
      maxLevel: 5
    },
    {
      id: 'clickMultiplier',
      title: '–ú–Ω–æ–∂–∏—Ç–µ–ª—å –∫–ª–∏–∫–æ–≤',
      description: '–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –∑–∞—Ä–∞–±–æ—Ç–æ–∫ —Å –∫–ª–∏–∫–æ–≤ –Ω–∞ +1 –º–æ–Ω–µ—Ç—É',
      baseCost: 150,
      maxLevel: 10
    },
    {
      id: 'maxEnergy',
      title: '–ú–∞–∫—Å —ç–Ω–µ—Ä–≥–∏—è',
      description: '–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –º–∞–∫—Å–∏–º—É–º —ç–Ω–µ—Ä–≥–∏–∏ –Ω–∞ +10',
      baseCost: 200,
      maxLevel: 5
    }
  ];
  static getCost(upgrade, level) {
    return Math.floor(upgrade.baseCost * Math.pow(1.5, level));
  }
  static async buyUpgrade(id) {
    const upgrade = this.upgrades.find(u => u.id === id);
    if (!upgrade) return;
 
    const currentLevel = gameManager.data.upgrades[id] || 0;
    if (currentLevel >= upgrade.maxLevel) {
      gameManager.showNotification('–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å!');
      return;
    }
 
    const cost = this.getCost(upgrade, currentLevel);
    if (gameManager.data.currency < cost) {
      gameManager.showNotification('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç!');
      return;
    }
 
    gameManager.data.currency -= cost;
    gameManager.data.upgrades[id] = currentLevel + 1;
    await gameManager.savePlayerData();
    gameManager.updateUI();
    gameManager.showNotification(`${upgrade.title} —É–ª—É—á—à–µ–Ω–æ –¥–æ —É—Ä–æ–≤–Ω—è ${currentLevel + 1}!`);
  }
  static displayUpgrades() {
    const list = document.getElementById('upgradesList');
    if (!list) return;
    list.innerHTML = '';
 
    this.upgrades.forEach(upgrade => {
      const currentLevel = gameManager.data.upgrades[upgrade.id] || 0;
      const cost = this.getCost(upgrade, currentLevel);
      const isMax = currentLevel >= upgrade.maxLevel;
 
      const item = document.createElement('div');
      item.className = 'upgrade-item';
      item.innerHTML = `
        <div class="upgrade-info">
          <div class="upgrade-title">${upgrade.title}</div>
          <div class="upgrade-description">${upgrade.description}</div>
          <div class="upgrade-level">–£—Ä–æ–≤–µ–Ω—å: ${currentLevel}/${upgrade.maxLevel}</div>
        </div>
        <button class="upgrade-button ${isMax ? 'disabled' : ''}" ${isMax ? 'disabled' : ''} onclick="UpgradeManager.buyUpgrade('${upgrade.id}')">
          –ö—É–ø–∏—Ç—å (${cost} –º–æ–Ω–µ—Ç)
        </button>
      `;
      list.appendChild(item);
    });
  }
}
// –ú–ï–ù–ï–î–ñ–ï–† –ü–ê–ö–û–í
class PackManager {
  static async buyCommonPack() {
    if (gameManager.data.currency < 30) {
      gameManager.showNotification('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç!');
      return;
    }
 
    gameManager.data.currency -= 30;
    const newCard = gameManager.generateRandomCard(0);
    gameManager.data.collection.push(newCard);
    await gameManager.savePlayerData();
    gameManager.updateUI();
    gameManager.displayNewCard(newCard);
    gameManager.showNotification(`–ü–æ–ª—É—á–µ–Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–∞: ${newCard.name}!`);
  }
  static async buyRarePack() {
    if (gameManager.data.currency < 100) {
      gameManager.showNotification('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç!');
      return;
    }
 
    gameManager.data.currency -= 100;
    const newCard = gameManager.generateRandomCard(20);
    gameManager.data.collection.push(newCard);
    await gameManager.savePlayerData();
    gameManager.updateUI();
    gameManager.displayNewCard(newCard);
    gameManager.showNotification(`–ü–æ–ª—É—á–µ–Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–∞: ${newCard.name}!`);
  }
  static async buyLegendaryPack() {
    if (gameManager.data.currency < 300) {
      gameManager.showNotification('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç!');
      return;
    }
 
    gameManager.data.currency -= 300;
    const newCard = gameManager.generateRandomCard(40);
    gameManager.data.collection.push(newCard);
    await gameManager.savePlayerData();
    gameManager.updateUI();
    gameManager.displayNewCard(newCard);
    gameManager.showNotification(`–ü–æ–ª—É—á–µ–Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–∞: ${newCard.name}!`);
  }
static async buyRegcandyPack() {
  if (gameManager.data.currency < 500) {
    gameManager.showNotification('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç!');
    return;
  }

  gameManager.data.currency -= 500;
  const newCard = gameManager.generateRandomCard(50, true); // true –æ–∑–Ω–∞—á–∞–µ—Ç Regcandy –ø–∞–∫
  gameManager.data.collection.push(newCard);
  await gameManager.savePlayerData();
  gameManager.updateUI();
  gameManager.displayNewCard(newCard);
  gameManager.showNotification(`–ü–æ–ª—É—á–µ–Ω–∞ —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞: ${newCard.name}!`);
 }
}
// –ú–ï–ù–ï–î–ñ–ï–† –ö–õ–ò–ö–ï–†–ê
class ClickerManager {
  static isVideoPlaying = false;
  static videoQueue = 0;
  
  static async earnClick() {
    if (gameManager.data.energy <= 0) {
      gameManager.showNotification('–≠–Ω–µ—Ä–≥–∏—è –∑–∞–∫–æ–Ω—á–∏–ª–∞—Å—å!');
      return;
    }
 
    gameManager.data.energy--;
    gameManager.data.currency += gameManager.getClickAmount();
    await gameManager.savePlayerData();
    gameManager.updateUI();
 
    // –≠—Ñ—Ñ–µ–∫—Ç –∫–ª–∏–∫–∞
    const catContainer = document.querySelector('.cat-container');
    if (catContainer) {
      catContainer.classList.add('click-effect');
      setTimeout(() => catContainer.classList.remove('click-effect'), 300);
    }
 
    this.playVideo();
  }
  
  static async playVideo() {
    const video = document.getElementById('catVideo');
    const catContainer = document.querySelector('.cat-container');

    if (!video) return;

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–≥—Ä—É–∑–∏–ª–æ—Å—å –ª–∏ –≤–∏–¥–µ–æ
    if (video.readyState === 0) {
      // –í–∏–¥–µ–æ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–æ—Å—å - –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ñ–æ–ª–ª–±–µ–∫
      if (catContainer) {
        catContainer.classList.add('fallback');
      }
      return;
    }

    if (this.isVideoPlaying) {
      this.videoQueue++;
      return;
    }

    try {
      this.isVideoPlaying = true;
      
      // –£–±–∏—Ä–∞–µ–º —Ñ–æ–ª–ª–±–µ–∫ –µ—Å–ª–∏ –≤–∏–¥–µ–æ —Ä–∞–±–æ—Ç–∞–µ—Ç
      if (catContainer) {
        catContainer.classList.remove('fallback');
      }

      video.currentTime = 0;

      const playPromise = video.play();

      if (playPromise !== undefined) {
        await playPromise;

        setTimeout(() => {
          video.pause();
          video.currentTime = 0;
          this.isVideoPlaying = false;

          if (this.videoQueue > 0) {
            this.videoQueue--;
            setTimeout(() => this.playVideo(), 100);
          }
        }, 1000);
      } else {
        this.isVideoPlaying = false;
      }
    } catch (error) {
      console.log('–í–∏–¥–µ–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ñ–æ–ª–ª–±–µ–∫');
      this.isVideoPlaying = false;
      // –í–∫–ª—é—á–∞–µ–º —Ñ–æ–ª–ª–±–µ–∫ —Å —ç–º–æ–¥–∑–∏
      if (catContainer) {
        catContainer.classList.add('fallback');
      }
    }
  }
}
// –ú–ï–ù–ï–î–ñ–ï–† –ù–ê–°–¢–†–û–ï–ö
class SettingsManager {
  static init() {
    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    const savedLang = localStorage.getItem('language') || 'ru';
    const savedSound = localStorage.getItem('soundVolume') || 100;
    const savedMusic = localStorage.getItem('musicVolume') || 100;
    
    // –ü—Ä–∏–º–µ–Ω—è–µ–º
    this.changeLanguage(savedLang);
    this.changeSoundVolume(savedSound);
    this.changeMusicVolume(savedMusic);
    
    // –û–±–Ω–æ–≤–ª—è–µ–º UI
    const langSelect = document.getElementById('languageSelect');
    if (langSelect) langSelect.value = savedLang;
    
    const soundSlider = document.getElementById('soundVolume');
    if (soundSlider) soundSlider.value = savedSound;
    const soundValue = document.getElementById('soundVolumeValue');
    if (soundValue) soundValue.textContent = `${savedSound}%`;
    
    const musicSlider = document.getElementById('musicVolume');
    if (musicSlider) musicSlider.value = savedMusic;
    const musicValue = document.getElementById('musicVolumeValue');
    if (musicValue) musicValue.textContent = `${savedMusic}%`;
  }
  
  static changeLanguage(lang) {
    localStorage.setItem('language', lang);
    document.documentElement.lang = lang;
  
    // –ü–µ—Ä–µ–≤–æ–¥–∏–º –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã
    document.querySelectorAll('[data-i18n]').forEach(el => {
      let key = el.getAttribute('data-i18n');
      let text = translations[lang][key] || key;
    
      // –ï—Å–ª–∏ –µ—Å—Ç—å –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã –≤—Ä–æ–¥–µ {amount}, –Ω–µ —Ç—Ä–æ–≥–∞–µ–º, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤ updateUI
      if (!text.includes('{')) {
        el.textContent = text;
      }
    });
  
    // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã
    gameManager.updateUI();
    gameManager.startTimer(); // –ß—Ç–æ–±—ã –æ–±–Ω–æ–≤–∏—Ç—å —Ç–∞–π–º–µ—Ä —Å –Ω–æ–≤—ã–º —è–∑—ã–∫–æ–º
  }
  
  static changeSoundVolume(value) {
    localStorage.setItem('soundVolume', value);
    const soundValue = document.getElementById('soundVolumeValue');
    if (soundValue) soundValue.textContent = `${value}%`;
    // TODO: –ü—Ä–∏–º–µ–Ω–∏—Ç—å –≥—Ä–æ–º–∫–æ—Å—Ç—å –∫ –∑–≤—É–∫–∞–º (–µ—Å–ª–∏ –µ—Å—Ç—å audio —ç–ª–µ–º–µ–Ω—Ç—ã)
  }
  
  static changeMusicVolume(value) {
    localStorage.setItem('musicVolume', value);
    const musicValue = document.getElementById('musicVolumeValue');
    if (musicValue) musicValue.textContent = `${value}%`;
    // TODO: –ü—Ä–∏–º–µ–Ω–∏—Ç—å –≥—Ä–æ–º–∫–æ—Å—Ç—å –∫ –º—É–∑—ã–∫–µ
  }
}
// –§–£–ù–ö–¶–ò–ò –î–õ–Ø HTML
function openPack() {
  gameManager.openPack('free');
}
function buyPack() {
  gameManager.openPack('paid');
}
function openProfile() {
  MenuManager.toggle('profile');
}
function showNameModal() {
  const modal = document.getElementById('nameModal');
  if (modal) modal.style.display = 'flex';
  const input = document.getElementById('nameInput');
  if (input) {
    input.value = gameManager.data.playerName;
    setTimeout(() => input.focus(), 100);
  }
}
function closeNameModal() {
  const modal = document.getElementById('nameModal');
  if (modal) modal.style.display = 'none';
}
async function confirmNameChange() {
  const input = document.getElementById('nameInput');
  if (!input) return;
  const newName = input.value.trim();
  if (newName && newName.length > 0 && newName.length <= 20) {
    gameManager.data.playerName = newName;
    await gameManager.savePlayerData();
    gameManager.updateUI();
    gameManager.showNotification('–ò–º—è –∏–∑–º–µ–Ω–µ–Ω–æ!');
    closeNameModal();
  } else {
    gameManager.showNotification('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∏–º—è (1-20 —Å–∏–º–≤–æ–ª–æ–≤)!');
  }
}
function changeAvatar() {
  const avatarInput = document.getElementById('avatarInput');
  if (avatarInput) avatarInput.click();
}
async function handleAvatarUpload(event) {
  const file = event.target.files[0];
  if (file && file.type.startsWith('image/')) {
    const reader = new FileReader();
    reader.onload = async function(e) {
      gameManager.data.playerAvatar = e.target.result;
      await gameManager.savePlayerData();
      gameManager.updateUI();
      gameManager.showNotification('–ê–≤–∞—Ç–∞—Ä –∏–∑–º–µ–Ω–µ–Ω!');
    };
    reader.readAsDataURL(file);
  }
}
async function handleInitialAvatarUpload(event) {
  const file = event.target.files[0];
  if (file && file.type.startsWith('image/')) {
    const reader = new FileReader();
    reader.onload = function(e) {
      const preview = document.getElementById('initialAvatarPreview');
      if (preview) preview.src = e.target.result;
    };
    reader.readAsDataURL(file);
  }
}
async function completeInitialSetup() {
  const input = document.getElementById('initialNameInput');
  if (!input) return;
  const playerName = input.value.trim();
  if (!playerName || playerName.length < 2) {
    gameManager.showNotification('–ù–∏–∫–Ω–µ–π–º –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 2 —Å–∏–º–≤–æ–ª–∞!');
    return;
  }
  if (playerName.length > 12) {
    gameManager.showNotification('–ù–∏–∫–Ω–µ–π–º —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–π (–º–∞–∫—Å–∏–º—É–º 12 —Å–∏–º–≤–æ–ª–æ–≤)!');
    return;
  }
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–µ —Å–∏–º–≤–æ–ª—ã
  const validNameRegex = /^[a-zA-Z–∞-—è–ê-–Ø0-9_\-]+$/;
  if (!validNameRegex.test(playerName)) {
    gameManager.showNotification('–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã, _ –∏ -');
    return;
  }
  const initialAvatarInput = document.getElementById('initialAvatarInput');
  let avatarDataUrl = null;
  if (initialAvatarInput && initialAvatarInput.files[0]) {
    const reader = new FileReader();
    reader.onload = async function(e) {
      avatarDataUrl = e.target.result;
      await gameManager.completeInitialSetup(playerName, avatarDataUrl);
    };
    reader.readAsDataURL(initialAvatarInput.files[0]);
    return; // –ñ–¥—ë–º –∑–∞–≥—Ä—É–∑–∫–∏ –∞–≤–∞—Ç–∞—Ä–∫–∏
  }
  await gameManager.completeInitialSetup(playerName, avatarDataUrl);
}
// –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –Ω–∏—Ö
document.addEventListener('click', (e) => {
  if (e.target.classList.contains('menu-modal')) {
    MenuManager.closeAll();
  }
  if (e.target.id === 'nameModal') {
    closeNameModal();
  }
  if (e.target.id === 'adminAuthModal') {
    AdminManager.cancelAuth();
  }
});
// –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
document.addEventListener('keydown', (e) => {
  if (e.key === 'Escape') {
    MenuManager.closeAll();
    if (gameManager.isInitialized) {
      gameManager.closeCardModal();
    }
    closeNameModal();
    AdminManager.cancelAuth();
  }
});
// –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ò–ì–†–´
const gameManager = new GameManager();
// –ó–∞–ø—É—Å–∫–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', () => {
  gameManager.init();
  AdminManager.init();
  SettingsManager.init();
});

let fPressCount = 0;
let fPressTimer = null;

document.addEventListener('keydown', (e) => {
  if (e.code === 'KeyF') {
    fPressCount++;
    if (fPressTimer) clearTimeout(fPressTimer);
    fPressTimer = setTimeout(() => {
      fPressCount = 0;
    }, 1000); // 1 second window

    if (fPressCount >= 3) {
      const quickBtn = document.getElementById('quickAdminBtn');
      if (quickBtn) {
        quickBtn.style.display = 'flex';
      }
      
      // –°—Ä–∞–∑—É –ø—Ä–æ–≤–µ—Ä—è–µ–º –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é –ø—Ä–∏ –ø–æ—è–≤–ª–µ–Ω–∏–∏ –∫–Ω–æ–ø–∫–∏
      if (!AdminManager.isAuthenticated) {
        AdminManager.showAuthModal();
      }
      
      fPressCount = 0;
    }
  } else {
    fPressCount = 0;
  }
});


// –û–ø—Ä–µ–¥–µ–ª—è–µ–º —à–∞–Ω—Å—ã –¥–ª—è –∫–∞–∂–¥–æ–π —Ä–µ–¥–∫–æ—Å—Ç–∏
const rarityChances = {
  'common': 70,      // 70% —à–∞–Ω—Å –Ω–∞ –≤—ã–ø–∞–¥–µ–Ω–∏–µ
  'rare': 20,        // 20% —à–∞–Ω—Å
  'legendary': 7,    // 7% —à–∞–Ω—Å
  'special': 3       // 3% —à–∞–Ω—Å (—Å–∞–º–∞—è —Ä–µ–¥–∫–∞—è)
};

// –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –æ–±—â–∞—è —Å—É–º–º–∞ —à–∞–Ω—Å–æ–≤ —Ä–∞–≤–Ω–∞ 100
const totalChance = Object.values(rarityChances).reduce((sum, chance) => sum + chance, 0);
if (totalChance !== 100) {
  console.error('–°—É–º–º–∞ —à–∞–Ω—Å–æ–≤ –Ω–µ —Ä–∞–≤–Ω–∞ 100%. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–Ω–∞—á–µ–Ω–∏—è.');
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–ª—É—á–∞–π–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞ —Ä–µ–¥–∫–æ—Å—Ç–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ —à–∞–Ω—Å–æ–≤
function getRandomRarity() {
  const rand = Math.random() * 100; // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª—É—á–∞–π–Ω–æ–µ —á–∏—Å–ª–æ –æ—Ç 0 –¥–æ 100
  let cumulativeChance = 0;

  // –ò—â–µ–º —Ä–µ–¥–∫–æ—Å—Ç—å, –∫–æ—Ç–æ—Ä–∞—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–º—É —á–∏—Å–ª—É
  for (const rarity in rarityChances) {
    cumulativeChance += rarityChances[rarity];
    if (rand < cumulativeChance) {
      return rarity;
    }
  }

  // –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫, –≤–µ—Ä–Ω–µ–º common
  return 'common';
}



// ===== –°–¢–ò–õ–¨–ù–´–ô –§–ò–õ–¨–¢–†/–°–û–†–¢–ò–†–û–í–ö–ê –ö–û–õ–õ–ï–ö–¶–ò–ò: –∫–Ω–æ–ø–∫–∞ "–°–∫—Ä—ã–≤–∞—Ç—å –¥—É–±–ª–∏–∫–∞—Ç—ã" –°–¢–ò–õ–¨–ù–ê–Ø –∏ –ó–ê –ü–†–ï–î–ï–õ–ê–ú–ò filterBar =====
(function(){
  if(document.getElementById('collectionFilterBar')) return;
  let f = document.createElement('div');
  f.id = 'collectionFilterBar';
  f.innerHTML = `
    <input id="filterName" placeholder="–ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏...">
    <select id="filterRarity">
      <option value="">–í—Å–µ —Ä–µ–¥–∫–æ—Å—Ç–∏</option>
      <option>Common</option>
      <option>Rare</option>
      <option>Special</option>
      <option>Legendary</option>
    </select>
    <select id="filterSort">
      <option value="dateDesc">–°–Ω–∞—á–∞–ª–∞ –Ω–æ–≤—ã–µ</option>
      <option value="dateAsc">–°–Ω–∞—á–∞–ª–∞ —Å—Ç–∞—Ä—ã–µ</option>
      <option value="az">–ê-–Ø</option>
      <option value="za">–Ø-–ê</option>
      <option value="rarityDesc">–ü–æ —Ä–µ–¥–∫–æ—Å—Ç–∏ ‚Üì</option>
      <option value="rarityAsc">–ü–æ —Ä–µ–¥–∫–æ—Å—Ç–∏ ‚Üë</option>
    </select>
  `;
  let coll = document.getElementById('collection');
  if (coll) {
    coll.parentNode.insertBefore(f, coll);

    // –°–¢–ò–õ–¨–ù–ê–Ø –∫–Ω–æ–ø–∫–∞ –≤–Ω–µ —Ä–∞–º–∫–∏ —Ñ–∏–ª—å—Ç—Ä–∞
    let dBtn = document.createElement('button');
    dBtn.id = "hideDuplicatesBtn";
    dBtn.type = "button";
    dBtn.innerHTML = "–°–∫—Ä—ã–≤–∞—Ç—å –¥—É–±–ª–∏–∫–∞—Ç—ã";
    dBtn.title = "–ü–æ–∫–∞–∑–∞—Ç—å —Ç–æ–ª—å–∫–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏";
    dBtn.className = "styled-duplicates-btn";
    // –°—Ç–∞–≤–∏–º –∫–Ω–æ–ø–∫—É –ø—Ä—è–º–æ –ø–æ–¥ —Ñ–∏–ª—å—Ç—Ä–æ–º
    f.insertAdjacentElement('afterend', dBtn);


    window.hideDuplicates = false;
    dBtn.onclick = function() {
      hideDuplicates = !hideDuplicates;
      this.classList.toggle("active", hideDuplicates);
      this.innerHTML = hideDuplicates ? "–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤—Å–µ" : "–°–∫—Ä—ã–≤–∞—Ç—å –¥—É–±–ª–∏–∫–∞—Ç—ã";
      this.title = hideDuplicates ? "–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤—Å–µ –∫–∞—Ä—Ç–æ—á–∫–∏" : "–ü–æ–∫–∞–∑–∞—Ç—å —Ç–æ–ª—å–∫–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏";
      filterCollection();
    };
  }

  ['filterName','filterRarity','filterSort'].forEach(id=>{
    document.getElementById(id).addEventListener('input', filterCollection);
    document.getElementById(id).addEventListener('change', filterCollection);
  });
})();

// –°–¢–ò–õ–¨ –¥–ª—è –∫–Ω–æ–ø–∫–∏ (–≤—Å—Ç–∞–≤—å—Ç–µ –≤ <style> –∏–ª–∏ –≤ –∫–æ–Ω–µ—Ü —Å—Ç–∏–ª–µ–π, –µ—Å–ª–∏ –µ—â—ë –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω)
if (!document.getElementById('styled-duplicates-btn-style')) {
  let s = document.createElement('style');
  s.id = 'styled-duplicates-btn-style';
  s.innerHTML = `
    .styled-duplicates-btn {
      margin: 14px auto 22px auto;
      display: block;
      padding: 12px 28px;
      font-size: 16px;
      font-family: 'Orbitron', sans-serif;
      border: none;
      border-radius: 12px;
      background: linear-gradient(45deg, #E91E63, #AB47BC);
      color: #fff;
      font-weight: bold;
      box-shadow: 0 4px 15px rgba(233, 30, 99, 0.15);
      cursor: pointer;
      transition: 0.2s;
      letter-spacing: 0.5px;
      outline: none;
      text-shadow: 0 1px 3px #AB47BC66;
    }
    .styled-duplicates-btn.active,
    .styled-duplicates-btn:active {
      background: linear-gradient(45deg, #43e97b, #38f9d7);
      color: #222;
      box-shadow: 0 6px 30px rgba(67,233,123,0.15);
      text-shadow: 0 1px 2px #43e97b66;
      transform: translateY(-2px) scale(1.03);
    }
    .styled-duplicates-btn:hover {
      filter: brightness(1.07);
      box-shadow: 0 8px 24px #ab47bc44;
    }
  `;
  document.head.appendChild(s);
}

function rarityToNum(r) {
  return { Common: 0, Rare: 1, Legendary: 2, Special: 3 }[r] || 0;
}

function filterCollection() {
  if(!gameManager||!gameManager.data||!gameManager.data.collection) return;
  let name = (document.getElementById('filterName')||{}).value?.toLowerCase()||"";
  let rarity = (document.getElementById('filterRarity')||{}).value;
  let sort = (document.getElementById('filterSort')||{}).value || "dateDesc";
  let arr = gameManager.data.collection
    .filter(c=>(!rarity||c.rarity===rarity)&&(!name||c.name.toLowerCase().includes(name)));

  // –°–∫—Ä—ã–≤–∞—Ç—å –¥—É–±–ª–∏–∫–∞—Ç—ã
  if(window.hideDuplicates) {
    const seen = new Set();
    arr = arr.filter(card => {
      if(seen.has(card.name)) return false;
      seen.add(card.name);
      return true;
    });
  }

  arr = [...arr];
  if(sort==="az") arr.sort((a,b)=>a.name.localeCompare(b.name));
  else if(sort==="za") arr.sort((a,b)=>b.name.localeCompare(a.name));
  else if(sort==="rarityDesc") arr.sort((a,b)=>rarityToNum(b.rarity)-rarityToNum(a.rarity));
  else if(sort==="rarityAsc") arr.sort((a,b)=>rarityToNum(a.rarity)-rarityToNum(b.rarity));
  else if(sort==="dateAsc") arr.reverse();

  let collection = document.getElementById('collection');
  collection.innerHTML = '';
  arr.forEach((card, index) => {
    let cardDiv = document.createElement('div');
    cardDiv.className = `card rarity-${card.rarity}`;
    cardDiv.style = 'display:inline-block;margin:7px;cursor:pointer;background:#fff1;border-radius:10px;box-shadow:0 2px 10px #0001;padding:5px 8px 2px 8px;transition:.16s;';
    cardDiv.innerHTML = `<img src="${card.image}" alt="${card.name}" style="width:94px;border-radius:7px;"><div style="font-size:1em;font-weight:bold">${card.name}</div>`;
    cardDiv.onclick = () => gameManager.showCardModal(card, gameManager.data.collection.indexOf(card));
    collection.appendChild(cardDiv);
  });
}

// –ß—Ç–æ–±—ã –≤—Å–µ–≥–¥–∞ –ø–æ—Å–ª–µ –ª—é–±–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–ª–ª–µ–∫—Ü–∏–∏ —Ñ–∏–ª—å—Ç—Ä —Ä–∞–±–æ—Ç–∞–ª:
(function(){
  let origUpdateUI = gameManager.updateUI.bind(gameManager);
  gameManager.updateUI = function() {
    origUpdateUI();
    filterCollection();
  };
})();



// ========== –í—ã–±–æ—Ä –∫–∞—Ä—Ç (–º—É–ª—å—Ç–∏–≤—ã–±–æ—Ä, –±–µ–∑ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤) ===========
function selectCardsFromCollection({title, collection, already=[], max=10}) {
  return new Promise(resolve => {
    let modal = document.createElement('div');
    modal.id = 'cardSelectModal';
    modal.style.cssText = `
      position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:99999;
      background:rgba(0,0,0,0.85);display:flex;justify-content:center;align-items:center;
    `;
    let selected = [...already];
    function updateList() {
      modal.querySelector('.picked-list').innerHTML = selected.map((card,i)=>`
        <div style="display:inline-block;position:relative;margin:2px;">
          <img src="${card.image}" title="${card.name}" style="width:48px;height:60px;border-radius:7px;border:2px solid #E91E63;">
          <span onclick="this.parentNode.remove();window._pickCardRemove(${i})" style="position:absolute;top:-8px;right:-8px;font-size:18px;color:#f77a77;cursor:pointer;">&times;</span>
        </div>
      `).join('');
      modal.querySelector('.confirm-btn').disabled = selected.length===0;
      modal.querySelector('.confirm-btn').style.opacity = selected.length?1:0.6;
    }
    window._pickCardRemove = (i) => {selected.splice(i,1);updateList()};
    modal.innerHTML = `
      <div style="background:#23182d;color:#fff;border-radius:20px;min-width:340px;max-width:97vw;padding:28px 20px;box-shadow:0 12px 60px #000c">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;">
          <h3 style="margin:0;">${title}</h3>
          <button onclick="document.getElementById('cardSelectModal').remove()" style="background:none;border:none;font-size:1.5em;color:#E91E63;cursor:pointer;">&times;</button>
        </div>
        <div class="picked-list" style="display:flex;gap:5px;margin-bottom:10px;flex-wrap:wrap;min-height:44px;"></div>
        <div style="display:flex;flex-wrap:wrap;gap:11px;max-height:38vh;overflow:auto;justify-content:center;">
          ${collection.filter(c=>!selected.some(ac=>ac.name===c.name)).map((card,i)=>`
            <div class="card rarity-${card.rarity}" 
                 style="cursor:pointer;min-width:60px;padding:6px 3px 2px;box-shadow:0 2px 8px #0002;background:#fff1;border-radius:7px;position:relative"
                 onclick="window._selectCardAdd(${i})">
              <img src="${card.image}" alt="${card.name}" style="width:48px;height:60px;object-fit:cover;border-radius:7px;">
              <div style="font-size:11px;margin-top:2px;white-space:nowrap;text-overflow:ellipsis;overflow:hidden;max-width:60px;color:#fff;">${card.name}</div>
            </div>
          `).join('')}
        </div>
        <button class="confirm-btn" style="margin-top:12px;width:100%;padding:10px 0;background:#43e97b;color:#fff;font-weight:bold;font-size:1.05em;border:none;border-radius:8px;opacity:0.6;transition:.13s;cursor:pointer;" disabled>–î–æ–±–∞–≤–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ</button>
      </div>
    `;
    document.body.appendChild(modal);
    window._selectCardAdd = (i)=>{
      let c = collection.filter(c=>!selected.some(ac=>ac.name===c.name))[i];
      if(selected.length<max && !selected.some(card=>card.name===c.name)) {selected.push(c);updateList();}
    };
    modal.querySelector('.confirm-btn').onclick = ()=>{
      document.getElementById('cardSelectModal').remove();
      resolve(selected);
    };
    updateList();
  });
}




class GiftManager {
  // –û—Ç–∫—Ä—ã—Ç—å –æ–∫–Ω–æ –ø–æ–¥–∞—Ä–∫–∞ ‚Äî –≤—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ø–∏—Å–æ–∫ –∏–≥—Ä–æ–∫–æ–≤
  static async openGlobalGiftModal() {
    this.selectedRecipient = null;
    const giftModal = document.getElementById('giftModal');
    const giftRecipientList = document.getElementById('giftRecipientList');
    if (giftRecipientList) {
      giftRecipientList.style.display = 'block';
      giftRecipientList.innerHTML = '';
    }
    if (giftModal) giftModal.style.display = 'flex';
    await this.showRecipientList();
    this.renderGiftOptions();
  }

  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤ (–≤—ã–±–æ—Ä –ø–æ–ª—É—á–∞—Ç–µ–ª—è)
  static async showRecipientList() {
    const listDiv = document.getElementById('giftRecipientList');

    // –ï—Å–ª–∏ —É–∂–µ –≤—ã–±—Ä–∞–Ω –ø–æ–ª—É—á–∞—Ç–µ–ª—å ‚Äî —Å–∫—Ä—ã–≤–∞–µ–º —Å–ø–∏—Å–æ–∫ –ø–æ–ª–Ω–æ—Å—Ç—å—é
    if (GiftManager.selectedRecipient) {
      listDiv.innerHTML = '';
      listDiv.style.display = 'none';
      return;
    }

    listDiv.innerHTML = '<div style="color:#999;padding:15px;">–ó–∞–≥—Ä—É–∑–∫–∞ –∏–≥—Ä–æ–∫–æ–≤...</div>';

    const snap = await db.ref('players').once('value');
    const players = snap.val() || {};
    const arr = Object.entries(players)
      .filter(([id, data]) =>
        id !== gameManager.playerId &&
        data.playerName && data.playerName.trim() !== ""
      )
      .sort((a, b) => (b[1].currency || 0) - (a[1].currency || 0));

    // –ï—Å–ª–∏ –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –∏–≥—Ä–æ–∫–æ–≤ –Ω–µ—Ç ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
    if (!arr.length) {
      listDiv.innerHTML = '<div style="color:#999;padding:15px;">–ù–µ—Ç –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –∏–≥—Ä–æ–∫–æ–≤</div>';
      listDiv.style.display = 'block';
      return;
    }

    // –†–∏—Å—É–µ–º —Å–ø–∏—Å–æ–∫ –∏–≥—Ä–æ–∫–æ–≤ –¥–ª—è –≤—ã–±–æ—Ä–∞
    listDiv.innerHTML = arr.map(([id, data]) => {
      const avatar = data.playerAvatar;
      let showBorder = false;
      if (avatar && avatar !== "" && avatar !== gameManager.getDefaultAvatar()) showBorder = true;

      return `
        <div onclick="GiftManager.selectRecipient('${id}','${(data.playerName||'').replace(/'/g,'')}')" 
          style="display:flex;align-items:center;gap:12px;cursor:pointer;padding:8px 10px;border-bottom:1px solid #ab47bc11;transition:.15s;">
          <img src="${avatar ? avatar : 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzgiIGhlaWdodD0iMzgiIHZpZXdCb3g9IjAgMCAzOCAzOCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48Y2lyY2xlIGN4PSIxOSIgY3k9IjE5IiByPSIxOSIgZmlsbD0iIzNjMzMzMyIvPjwvc3ZnPg=='}"
            style="width:38px;height:38px;object-fit:cover;border-radius:50%;${showBorder ? 'border:2px solid #AB47BC;' : ''}">
          <div style="flex:1;">
            <div style="color:#fff;font-weight:bold;font-size:16px;">${data.playerName}</div>
            <div style="color:#AB47BC;font-size:13px;">${data.currency||0} –º–æ–Ω–µ—Ç, ${data.collection?.length||0} –∫–∞—Ä—Ç</div>
          </div>
        </div>
      `;
    }).join('');
    listDiv.style.display = 'block';
  }

  // –í—ã–±–æ—Ä –∏–≥—Ä–æ–∫–∞ –∏–∑ —Å–ø–∏—Å–∫–∞
  static selectRecipient(id, name) {
    this.selectedRecipient = { id, name };
    const giftRecipientList = document.getElementById('giftRecipientList');
    if (giftRecipientList) {
      giftRecipientList.innerHTML = '';
      giftRecipientList.style.display = 'none';
    }
    this.renderGiftOptions();
  }

  // –ó–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª–∫—É –ø–æ–¥–∞—Ä–∫–∞
  static closeGiftModal() {
    const giftModal = document.getElementById('giftModal');
    if (giftModal) giftModal.style.display = 'none';
    this.selectedRecipient = null;
    const giftRecipientList = document.getElementById('giftRecipientList');
    if (giftRecipientList) {
      giftRecipientList.innerHTML = '';
      giftRecipientList.style.display = 'block';
    }
    this.renderGiftOptions();
  }

  // –†–µ–Ω–¥–µ—Ä –æ–ø—Ü–∏–π –ø–æ–¥–∞—Ä–∫–∞ (–≤—ã–±—Ä–∞—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É)
  static renderGiftOptions() {
    const wrap = document.getElementById('giftOptions');
    if (!wrap) return;

    // –ï—Å–ª–∏ –Ω–µ –≤—ã–±—Ä–∞–Ω –ø–æ–ª—É—á–∞—Ç–µ–ª—å:
    if (!this.selectedRecipient) {
      wrap.innerHTML = '<div style="color:#ccc;">–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—É—á–∞—Ç–µ–ª—è</div>';
      return;
    }

    // –õ–∏–º–∏—Ç 1 —á–∞—Å –º–µ–∂–¥—É –ø–æ–¥–∞—Ä–∫–∞–º–∏
    const now = Date.now();
    const lastGift = gameManager.data.lastGiftTimestamp || 0;
    if (now - lastGift < 3600_000) {
      const mins = Math.ceil((3600_000 - (now - lastGift)) / 60000);
      wrap.innerHTML = `<div style="color:#FFEBEE;margin-bottom:14px;">–ü–æ–¥–∞—Ä–æ–∫ –º–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —á–µ—Ä–µ–∑ ${mins} –º–∏–Ω.</div>`;
      return;
    }

    // –°–ø–∏—Å–æ–∫ –∫–∞—Ä—Ç–æ—á–µ–∫ –¥–ª—è –ø–æ–¥–∞—Ä–∫–∞
    let html = `<div style="margin:10px 0 7px 0;color:#FFD700;">–í—ã–±–µ—Ä–∏ –∫–∞—Ä—Ç–æ—á–∫—É:</div>
      <div style="display:flex;gap:7px;flex-wrap:wrap;justify-content:center;max-height:170px;overflow:auto;">`;
    gameManager.data.collection.forEach((card, idx) => {
      html += `<div style="text-align:center;">
        <img src="${card.image}" title="${card.name}" style="width:48px;height:60px;object-fit:cover;border-radius:7px;border:2px solid #AB47BC;cursor:pointer;" onclick="GiftManager.sendCardGift(${idx})">
        <div style="font-size:12px;color:#fff;">${card.name}</div>
      </div>`;
    });
    html += `</div>`;
    wrap.innerHTML = html;
  }

  // –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–∞—Ä—Ç–æ—á–∫–∏
  static async sendCardGift(idx) {
    if (!this.selectedRecipient) return;
    const card = gameManager.data.collection[idx];
    if (!card) return;
    const snap = await db.ref(`players/${this.selectedRecipient.id}/collection`).once('value');
    let hisCards = snap.val() || [];
    hisCards.push(card);
    await db.ref(`players/${this.selectedRecipient.id}/collection`).set(hisCards);
    gameManager.data.collection.splice(idx, 1);
    gameManager.data.lastGiftTimestamp = Date.now();
    await gameManager.savePlayerData();
    GiftManager.closeGiftModal();
    gameManager.showNotification(`üéÅ –ö–∞—Ä—Ç–æ—á–∫–∞ ${card.name} –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –∏–≥—Ä–æ–∫—É ${this.selectedRecipient.name}!`);
  }
}

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–¥–∞—Ä–∫–∞ (–∫–∞—Ä—Ç–æ—á–∫–∏)
function handleGiftReceived(gift) {
  if (gift.type === 'card') {
    gameManager.data.collection.push(gift.value);
  }
  gameManager.savePlayerData();
  gameManager.updateUI();

  // –£–¥–∞–ª–∏—Ç—å –ø–æ–ª—É—á–µ–Ω–Ω—ã–π –ø–æ–¥–∞—Ä–æ–∫ –∏–∑ pending
  db.ref(`gifts/pending/${gameManager.playerId}/${gift.giftId}`).remove();

  // –ü–æ–∫–∞–∑–∞—Ç—å –æ–∫–Ω–æ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –ø–æ–¥–∞—Ä–∫–µ
  const oldModal = document.getElementById('giftSimpleModal');
  if (oldModal) oldModal.remove();

  const modal = document.createElement('div');
  modal.id = 'giftSimpleModal';
  modal.style = 'position:fixed;left:0;top:0;width:100vw;height:100vh;z-index:9999;background:rgba(0,0,0,0.75);display:flex;align-items:center;justify-content:center;';
  modal.innerHTML = `
    <div style="background:#fff;border-radius:15px;padding:32px 20px;max-width:320px;text-align:center;">
      <h3>–í–∞–º –ø—Ä–∏—à—ë–ª –ø–æ–¥–∞—Ä–æ–∫!</h3>
      <p>–û—Ç: <b>${gift.from}</b></p>
      <p>–ö–∞—Ä—Ç–æ—á–∫–∞: <b>${gift.value.name}</b></p>
      <button id="closeGiftSimpleModal" style="margin-top:18px;padding:10px 28px;font-size:1.1em;background:#E91E63;color:#fff;border:none;border-radius:10px;">OK</button>
    </div>
  `;
  document.body.appendChild(modal);
  document.getElementById('closeGiftSimpleModal').onclick = () => modal.remove();
}


</script>

<!-- –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –ö–ê–†–¢–û–ß–ö–ò –î–õ–Ø –ü–†–û–î–ê–ñ–ò -->
<div id="cardModal">
  <div id="cardContent">
    <img id="modalImage" src="" alt="–ö–∞—Ä—Ç–æ—á–∫–∞" />
    <h2 id="modalName"></h2>
    <p id="modalRarity"></p>
    <p id="modalType"></p>
    <button id="sellCardBtn" style="margin-top:14px;">üí∞ –ü—Ä–æ–¥–∞—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É</button>
  </div>
</div>


<!-- –°–ß–ï–¢–ß–ò–ö –ö–õ–ò–ö–û–í –î–õ–Ø –ê–î–ú–ò–ù –ü–ê–ù–ï–õ–ò (—Å–∫—Ä—ã—Ç—ã–π) -->
<div id="adminClickCounter" style="display: none;"></div>
<!-- –ê–î–ú–ò–ù-–ü–ê–ù–ï–õ–¨ "–ë–û–ì" -->
<div id="adminPanel">
  <div class="admin-header">
    <h2 data-i18n="admin_panel">üõ° –ê–î–ú–ò–ù-–ü–ê–ù–ï–õ–¨ –ë–û–ì–ê</h2>
    <button class="admin-close-btn" onclick="AdminManager.close()">&times;</button>
  </div>

  <!-- 0. –ü–æ–∏—Å–∫ –∏–≥—Ä–æ–∫–∞ –ø–æ –∏–º–µ–Ω–∏ -->
  <div class="admin-section">
    <h3>üîé –ü–æ–∏—Å–∫ –∏–≥—Ä–æ–∫–∞ –ø–æ –∏–º–µ–Ω–∏</h3>
    <div class="admin-input-group" style="position:relative;">
      <input type="text" class="admin-input" id="adminPlayerSearchInput" placeholder="–ò–º—è –∏–≥—Ä–æ–∫–∞...">
      <div id="adminPlayerSearchResults" class="player-search-list" style="display:none; position:absolute; top:40px; left:0; right:0; z-index:9999;"></div>
    </div>
    <div style="font-size:12px;color:#bbb;margin-top:3px;">
      –ö–ª–∏–∫–Ω–∏ –ø–æ –∏–º–µ–Ω–∏ ‚Äî ID –ø–æ–¥—Å—Ç–∞–≤–∏—Ç—Å—è –≤–æ –≤—Å–µ –ø–æ–ª—è –Ω–∏–∂–µ.
    </div>
  </div>

  <!-- 1. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–ª–ª–µ–∫—Ü–∏—è–º–∏ -->
  <div class="admin-section">
    <h3>üÉè –ö–æ–ª–ª–µ–∫—Ü–∏–∏ –∏–≥—Ä–æ–∫–æ–≤</h3>
    <div class="admin-input-group">
      <input type="text" class="admin-input" id="adminTargetPlayerId1" placeholder="ID –∏–≥—Ä–æ–∫–∞">
      <select class="admin-select" id="adminCardToGive">
        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ä—Ç—É...</option>
      </select>
      <button class="admin-button success" onclick="AdminManager.giveCardToPlayer()">–î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ä—Ç—É</button>
      <button class="admin-button danger" onclick="AdminManager.removeCardFromPlayer()">–£–¥–∞–ª–∏—Ç—å –∫–∞—Ä—Ç—É</button>
    </div>
    <div class="admin-input-group">
      <input type="text" class="admin-input" id="adminTargetPlayerId2" placeholder="ID –∏–≥—Ä–æ–∫–∞">
      <button class="admin-button warning" onclick="AdminManager.clearPlayerCollection()">–ó–∞–±—Ä–∞—Ç—å –≤—Å–µ –∫–∞—Ä—Ç—ã</button>
      <button class="admin-button success" onclick="AdminManager.giveFullCollection()">–í—ã–¥–∞—Ç—å –≤—Å–µ –∫–∞—Ä—Ç—ã</button>
    </div>
  </div>

  <!-- 2. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∞–ª—é—Ç–æ–π -->
  <div class="admin-section">
    <h3>üí∞ –í–∞–ª—é—Ç–∞ –∏–≥—Ä–æ–∫–æ–≤</h3>
    <div class="admin-input-group">
      <input type="text" class="admin-input" id="adminTargetPlayerId3" placeholder="ID –∏–≥—Ä–æ–∫–∞">
      <input type="number" class="admin-input" id="adminCurrencyAmount" placeholder="–°—É–º–º–∞">
      <button class="admin-button" onclick="AdminManager.setPlayerCurrency()">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
      <button class="admin-button" onclick="AdminManager.addPlayerCurrency()">–î–æ–±–∞–≤–∏—Ç—å</button>
      <button class="admin-button danger" onclick="AdminManager.subtractPlayerCurrency()">–û—Ç–Ω—è—Ç—å</button>
      <button class="admin-button success" onclick="AdminManager.makePlayerMillionaire()">üí∏ –ú–∏–ª–ª–∏–æ–Ω–µ—Ä</button>
    </div>
  </div>

  <!-- 3. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞–º–∏ -->
  <div class="admin-section">
    <h3>üë§ –ò–≥—Ä–æ–∫–∏</h3>
    <div class="admin-input-group">
      <input type="text" class="admin-input" id="adminTargetPlayerId4" placeholder="ID –∏–≥—Ä–æ–∫–∞">
      <input type="text" class="admin-input" id="adminNewPlayerName" placeholder="–ù–æ–≤—ã–π –Ω–∏–∫">
      <button class="admin-button" onclick="AdminManager.changePlayerName()">–°–º–µ–Ω–∏—Ç—å –Ω–∏–∫</button>
      <input type="text" class="admin-input" id="adminNewPlayerAvatar" placeholder="–°—Å—ã–ª–∫–∞ –Ω–∞ –∞–≤–∞—Ç–∞—Ä">
      <button class="admin-button" onclick="AdminManager.changePlayerAvatar()">–°–º–µ–Ω–∏—Ç—å –∞–≤–∞—Ç–∞—Ä</button>
      <button class="admin-button danger" onclick="AdminManager.banPlayer()">–ó–∞–±–∞–Ω–∏—Ç—å</button>
      <button class="admin-button success" onclick="AdminManager.unbanPlayer()">–†–∞–∑–±–∞–Ω–∏—Ç—å</button>
      <button class="admin-button warning" onclick="AdminManager.resetPlayer()">–°–±—Ä–æ—Å–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç</button>
      <button class="admin-button danger" onclick="AdminManager.deletePlayer()">–£–¥–∞–ª–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç</button>
    </div>
  </div>

  <!-- 4. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —à–∞–Ω—Å–∞–º–∏ -->
  <div class="admin-section">
    <h3>üé≤ –®–∞–Ω—Å—ã –≤—ã–ø–∞–¥–µ–Ω–∏—è –∫–∞—Ä—Ç</h3>
    <div class="admin-input-group">
      <input type="text" class="admin-input" id="adminTargetPlayerId5" placeholder="ID –∏–≥—Ä–æ–∫–∞ (–ø—É—Å—Ç–æ = –≤—Å–µ–º)">
      <input type="text" class="admin-input" id="adminRarityChances" placeholder="Common=70,Rare=20,...">
      <button class="admin-button" onclick="AdminManager.setRarityChances()">–ò–∑–º–µ–Ω–∏—Ç—å —à–∞–Ω—Å—ã</button>
    </div>
  </div>

  <!-- 5. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–ø–≥—Ä–µ–π–¥–∞–º–∏ -->
  <div class="admin-section">
    <h3>üî• –ê–ø–≥—Ä–µ–π–¥—ã –∏–≥—Ä–æ–∫–æ–≤</h3>
    <div class="admin-input-group">
      <input type="text" class="admin-input" id="adminTargetPlayerId6" placeholder="ID –∏–≥—Ä–æ–∫–∞">
      <select class="admin-select" id="adminUpgradeType">
        <option value="cooldownReduction">–ö—É–ª–¥–∞—É–Ω</option>
        <option value="clickMultiplier">–ú–Ω–æ–∂–∏—Ç–µ–ª—å</option>
        <option value="maxEnergy">–≠–Ω–µ—Ä–≥–∏—è</option>
      </select>
      <input type="number" class="admin-input" id="adminUpgradeLevel" placeholder="–£—Ä–æ–≤–µ–Ω—å (0-10)">
      <button class="admin-button" onclick="AdminManager.setPlayerUpgrade()">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
      <button class="admin-button" onclick="AdminManager.maxAllUpgrades()">–ú–∞–∫—Å–∏–º—É–º –∞–ø–≥—Ä–µ–π–¥–æ–≤</button>
      <button class="admin-button warning" onclick="AdminManager.resetAllUpgrades()">–°–±—Ä–æ—Å–∏—Ç—å –∞–ø–≥—Ä–µ–π–¥—ã</button>
    </div>
  </div>

  <!-- 6. –ú–∞—Å—Å–æ–≤—ã–µ —Ä–∞—Å—Å—ã–ª–∫–∏ -->
  <div class="admin-section">
    <h3>üì¢ –ú–∞—Å—Å–æ–≤—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h3>
    <div class="admin-input-group">
      <input type="text" class="admin-input" id="adminNotificationText" placeholder="–¢–µ–∫—Å—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è">
      <button class="admin-button" onclick="AdminManager.notifyAllPlayers()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤—Å–µ–º</button>
      <button class="admin-button success" onclick="AdminManager.giveGiftToAll()">–ü–æ–¥–∞—Ä–æ–∫ –≤—Å–µ–º –æ–Ω–ª–∞–π–Ω</button>
    </div>
  </div>

  <!-- 7. –ö–æ–Ω—Ç—Ä–æ–ª—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ -->
  <div class="admin-section">
    <h3>üïµÔ∏è –ö–æ–Ω—Ç—Ä–æ–ª—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</h3>
    <div class="admin-input-group">
      <input type="text" class="admin-input" id="adminTargetPlayerId7" placeholder="ID –∏–≥—Ä–æ–∫–∞">
      <button class="admin-button" onclick="AdminManager.showPlayerStats()">–ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É</button>
      <button class="admin-button" onclick="AdminManager.showPlayerLog()">–ü–æ–∫–∞–∑–∞—Ç—å –ª–æ–≥ –∏–≥—Ä–æ–∫–∞</button>
    </div>
  </div>

  <!-- 8. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ -->
  <div class="admin-section">
    <h3 data-i18n="server_stats">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞</h3>
    <div id="serverStats">
      <p data-i18n="total_players">–í—Å–µ–≥–æ –∏–≥—Ä–æ–∫–æ–≤: <span id="totalPlayers">–ó–∞–≥—Ä—É–∑–∫–∞...</span></p>
      <p data-i18n="online_players">–û–Ω–ª–∞–π–Ω –∏–≥—Ä–æ–∫–æ–≤: <span id="onlinePlayers">–ó–∞–≥—Ä—É–∑–∫–∞...</span></p>
      <p data-i18n="total_cards">–í—Å–µ–≥–æ –∫–∞—Ä—Ç–æ—á–µ–∫: <span id="totalCards">–ó–∞–≥—Ä—É–∑–∫–∞...</span></p>
    </div>
    <button class="admin-button" onclick="AdminManager.refreshStats()" data-i18n="refresh_stats">–û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É</button>
  </div>

  <!-- 9. –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
  <div class="admin-section">
    <h3 data-i18n="quick_actions">üîß –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h3>
    <button class="admin-button" onclick="AdminManager.resetTimer()" data-i18n="reset_timer">–°–±—Ä–æ—Å–∏—Ç—å —Ç–∞–π–º–µ—Ä</button>
    <button class="admin-button warning" onclick="AdminManager.clearCollection()" data-i18n="clear_collection">–û—á–∏—Å—Ç–∏—Ç—å –º–æ–∏ –∫–∞—Ä—Ç–æ—á–∫–∏</button>
    <button class="admin-button" onclick="AdminManager.maxEnergy()" data-i18n="max_energy">–ú–∞–∫—Å —ç–Ω–µ—Ä–≥–∏—è</button>
    <button class="admin-button success" onclick="AdminManager.giveRandomLegendary()" data-i18n="give_legendary">–í—ã–¥–∞—Ç—å –ª–µ–≥–µ–Ω–¥–∞—Ä–∫—É</button>
    <button class="admin-button" onclick="AdminManager.resetGiftTimer()" data-i18n="reset_gift_timer">–°–±—Ä–æ—Å–∏—Ç—å —Ç–∞–π–º–µ—Ä –ø–æ–¥–∞—Ä–∫–∞</button>
  </div>

  <!-- 10. –û–ø–∞—Å–Ω–∞—è –∑–æ–Ω–∞ -->
  <div class="admin-danger-zone">
    <h3 data-i18n="danger_zone">‚ö†Ô∏è –û–ü–ê–°–ù–ê–Ø –ó–û–ù–ê</h3>
    <div class="admin-warning" data-i18n="danger_warning">
      –≠—Ç–∏ –¥–µ–π—Å—Ç–≤–∏—è –Ω–µ–æ–±—Ä–∞—Ç–∏–º—ã –∏ –∑–∞—Ç—Ä–∞–≥–∏–≤–∞—é—Ç –í–°–ï–• –∏–≥—Ä–æ–∫–æ–≤!
    </div>
    <button class="admin-button danger" onclick="AdminManager.resetAllPlayers()" data-i18n="reset_all">üîÑ –°–ë–†–û–°–ò–¢–¨ –í–°–ï –ê–ö–ö–ê–£–ù–¢–´</button>
    <button class="admin-button danger" onclick="AdminManager.clearAllData()" data-i18n="clear_data">üí• –°–¢–ï–†–ï–¢–¨ –ë–ê–ó–£ –î–ê–ù–ù–´–•</button>
    <button class="admin-button danger" onclick="AdminManager.shutdownServer()" data-i18n="maintenance_mode">üõë –†–ï–ñ–ò–ú –û–ë–°–õ–£–ñ–ò–í–ê–ù–ò–Ø</button>
    <div class="admin-section">
      <h3>üóë –£–¥–∞–ª–∏—Ç—å —Å–≤–æ–π –∞–∫–∫–∞—É–Ω—Ç</h3>
      <button class="admin-button danger" onclick="AdminManager.deleteSelf()">–£–¥–∞–ª–∏—Ç—å –º–æ–π –∞–∫–∫–∞—É–Ω—Ç –∏–∑ –±–∞–∑—ã</button>
      <div id="deleteSelfStatus" style="margin-top:10px;color:#E91E63;"></div>
    </div>
  </div>

  <!-- 11. –õ–æ–≥ –∞–¥–º–∏–Ω–∞ -->
  <div class="admin-section">
    <h3 data-i18n="admin_log">üìù –õ–æ–≥ –∞–¥–º–∏–Ω–∞</h3>
    <div id="adminLog" class="admin-log">
      <div class="log-entry">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞...</div>
    </div>
    <button class="admin-button" onclick="AdminManager.clearLog()" data-i18n="clear_log">–û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥</button>
  </div>
</div>
<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∞–¥–º–∏–Ω–∞ -->
<div id="adminAuthModal" style="display:none;">
  <div class="admin-auth-content">
    <h3 data-i18n="admin_auth">–ê–¥–º–∏–Ω –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è</h3>
    <input type="password" id="adminPasswordInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å">
    <div class="admin-auth-actions">
      <button onclick="AdminManager.verifyPassword()" data-i18n="login">‚úÖ –í–æ–π—Ç–∏</button>
      <button onclick="AdminManager.cancelAuth()" style="background: linear-gradient(45deg,#ff3333,#ff6666);" data-i18n="cancel">‚ùå –û—Ç–º–µ–Ω–∞</button>
    </div>
  </div>
</div>

<label style="margin-left:10px;cursor:pointer;">
  <input type="checkbox" id="autoSellDuplicatesToggle" style="vertical-align:middle;">
  <span style="vertical-align:middle;">–ê–≤—Ç–æ–ø—Ä–æ–¥–∞–∂–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤</span>
</label>

</body>
</html>

